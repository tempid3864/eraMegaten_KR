;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:SYSYTEM_BATTLE.ERB
;	Facility	:ダメージ計算や스테이터스算出などといった전투システムに関わる処理群
;
;	Licence		:ライセンスフリー。
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20XX/XX/XX								新規作成
;	002		2011/01/30		P						진ㆍ전문내성の処理を추가
;	003		2011/02/06		Rsp暇人					CFLAG:아이템사용능력および아이템사용강화の処理を추가
;	004		2011/03/06		Rsp暇人					CFLAG:아이템사용능력および아이템사용강화の処理を修正。仲魔作成時に초기衣装を설정するように。
;	005		2011/03/28		P						초기호감도の処理を추가。전투員による영매체질によってMAG移動が増加するように변경
;	006		2011/08/31		P						인간がLv80を超えている場合、추가でステ보정が入るように
;	007		2011/11/09		旅人					統合整備
;													ファイルが肥大化している為、ダメージ処理を分離
;	008		2011/05/20		P						반마인がバステ내성を장비からとっていたのを修正
;	009		2012/10/00		(ﾟдﾟ)					푸린키피아に関する記述を추가
;	010		2012/12/02		ネトリス				瀕死になった場合にCFLAG:던전内発情用욕정치が半分になり、発情상태が해제されるように
;	011		2012/12/26		P						식노(데빌시프터)が主人の場合、악마변신時に최대MAGが減ってしまうのを修正
;	012		2013/11/25		ひみつ					NEXT経験値の설정を@GET_NEXT_EXPで行うように(@CHECK_LEVEL_UPの動きに合わせる)
;													現在経験値が1つ下のLVのNEXT経験値より低い場合、その値まで引き上げる(主に加入時の為)
;	013		2013/12/11		ひみつ					NEXT経験値の설정を@GET_NEXT_EXPで行うように(@CHECK_LEVEL_UPの動きに合わせる)
;													現在経験値が1つ下のLVのNEXT経験値より低い場合、その値まで引き上げる(主に加入時の為)
;	014		2015/01/27		Iz						달인강화パッチとして、「무도의마음가짐」「마술의소양」に対応調整
;	015		2015/12/11		JK好き					이능자用の스킬수を確保
;	016		2016/12/11		Jガン					特定のバステで공격が必ず명중するように
;	017		2017/09/23		名無					ガチャモード추가(ガチャ縛り時、非ガチャ産스테이터스반감)
;	018		2018/09/05		sil						相性関係の処理を相性변경複数化用に변경
;	019		2018/10/23		しぐれみそ				장비추가스킬の処理に마정장비用の処理を추가
;	020		2019/03/17		名無					엑스링케이지に伴うムフフでCOOP時 욕정増加
;	021		2019/03/29		名無					ハーモナイザーの処理を추가
;	022		2019/04/12		オレンジスコーン		素質건슬링거がある場合の計算式を추가
;	023		2019/04/27		名無					CSVに특수우정を추가し、특수우정があるとアライメント関係なくCOOP최대になるように
;	024		2019/08/27		空気					장비지식Lv5の보정が重複していた部分を削除、장비지식持ち악마の마법효과ㆍ마법위력が장비で上がらないように변경
;	025		2019/08/28		空気					デビルチェンバー사용時の挙動を修正。また、DDMがONなら容量いっぱいでも仲魔になって自動的にストレージに送られるように
;	026		2019/08/30		空気					악마合体時に容量を超えていないのにストレージに送られてしまう問題を修正
;	027		2019/11/27		Jガン					熱り弱点処理を추가
;	028		2019/12/20		Jガン					FLYの스테이터스변경추가
;	029		2020/01/31		131						세대数を스테이터스にボーナス
;	030		2020/02/11		名無し					페르소나구사자の전투스테이터스に페르소나の전투스테이터스に応じた加算
;	031		2020/03/XX		Jガン					무기素質仕様の변경、추가
;	032		2020/04/XX		Jガン					맹우取得時能力値が上がるように
;	033		2020/05/19		がめら					NTR호감도処理をCDFLAGに변경。キャラ上限増加に対応
;	034		2020/06/24		名無し					半魔の추가相性변경が기능するように
;	035		2020/07/06		Jガン					COOP被데미지制限추가
;	036		2020/07/18		木綿豆腐				ADD_NEW_COMPANIONにARG:4추가。악마を인간にして加入させたい際に사용する。
;	037		2020/08/02		Jガン					1モアを減らす関数削除(その代わり他に1モア増減する処理추가)、JUDG_HITの処理の변경、修正
;	038		2020/08/13		春眠					バッド스테이터스명중판정時に가드브레이크が기능するように修正、能力差ㆍカジャンダㆍ스킬素質による보정後の値に성공率上限値が適用されるように
;	039		2020/08/12		kamedakeisuke(ﾟдﾟ)		片キンフラグ増設
;	040		2020/08/19		Jガン					バステ내성のブロック판정を移動、他変なところ修正、壁系を소비しやすいように処理を下の方に
;													FLY상태のパラメータ調整の修正
;	041		2020/08/27		Jガン					장비스킬변경時の스킬게이지処理を추가
;	042		2020/08/26		MkjX					함락履歴により내성강화を更に추가で可能に
;	043		2020/08/28		Jガン					VAR_HPに이악물기のフラグを自動選出できるように、ネバーギブアップでデビルトリガーできるように、잠재능력발동횟수修正
;	044		2020/09/02		Jガン					エアトリックの処理추가
;	045		2020/09/05		Jガン					특수우정の仕様변경、仲間になるとき素のバステ내성が全て通常になるように
;	046		2020/09/17		SUIHOU					에어하이크の処理추가
;	047		2020/09/25		kamedakeisuke(ﾟдﾟ)		ハーモナイザーの仕様をパーティの서머너레벨합계から出힘を算出する形に변경
;	048		2020/09/17		마리ーちゃんの中の人	ADD_NEW_COMPANIONの処理の際にARG:5にLVを指定するだけでLVUPする様に改良
;	049		2020/09/18		JK好き					@ADD_NEW_COMPANIONを増加した랜덤キャラ枠に対応
;	050		2020/09/18		Jガン					ATTACK_BADSTATEを改行しないように(SKILL TEMPの方で改行するように)
;	051		2020/12/16		Jガン					ATTACK_BADSTATEにRECEIVE_BADSTATEを추가、BS무효플래그が기능するように
;	052		2021/01/05		Jガン					VAR_HPに이악물기時に구상を出せるように、ATTACK_BADSTATEにバステ부여時に구상が出てくるように
;													バステの優先度の関数を作ってATTACK_BADSTATEに組み込み、COOP강화Cが正しく行われなかったので新しい関数を入れて正しくなるように
;													GET_SUMMONER_LV2→GET_SUMMONER_MLV　に名前を변경、ハーモナイザーを서머너레벨3以上の아군がいないと発動しないように
;	053		2021/01/07		JK好き					@ATTACK_BADSTATEで３回もバステ부여확률上限計算していたのをBS부여率計算後に１回だけ行うように변경
;	054		2021/01/29		Rsp暇人					아이템숙련の効果量をTALENT:+40% SKILL:+20%(최대3枠まで累積)に변경。옵션で切り替えられる도구명중/道具威힘を新設
;	055		2021/02/22		亜人いいよね			@SYNC_STATUSに악마강화스킬（함락의악마, 내츄럴본, 오토퍼지）の適用
;	056		2021/03/02		亜人いいよね			강화옵션の필터適用
;	057		2021/03/05		JK好き					@SYNC_STATUSでMASTERの스테이터스計算に이번주회신뢰인수を加算するように변경
;	058		2021/03/21		木綿豆腐				SONG OF DIVAに関する処理を추가
;	059		2021/04/07		Jガン					4行、仲間に入るときに特殊な스킬にロックがかかるように(「스킬ロック」で検索すると변경場所がわかります)
;	060		2021/04/13		NEO						ふたごちゃんパッチで多胎임신している場合、임신の스테이터스上昇を보정無しにしたりステが下がるようにしたり
;	061		2021/04/24		JK好き					@ADD_NEW_COMPANIONにCFLAG子宮최대容量を설정する処理を추가
;	062		2021/04/25		SUIHOU					Fate専用技実装に伴い、効果を追記(회피、クリティカル、ダメージ보정、이악물기処理)
;	063		2021/04/30		しゃけ					라그나로크（ＡＮ）、劫火の余燼の処理を추가
;	064		2021/04/13		Jガン					HP処理を簡略化、이악물기処理忘れ修正
;	065		2021/06/24		しゃけ					謎のヒロインX'sの処理を추가
;	066		2021/08/19		SUIHOU					ゲッシュとサーヴァント各クラス스킬の効果を추가
;	067		2021/09/27		軽木					ハーモナイザーの총性能보정部分の計算式も변경
;	068		2021/10/23		Collared				ダッジの処理を추가。총関連の能力を건슬링거と非건슬링거で統一
;	069		2021/11/28		JK好き					식노の변신中스테이터스分配結果で기본스테이터스が0以下になってしまう場合があるのを応急処置的修正
;													本当はそもそも0以下にならないようにすべき
;	070		2021/12/19		SUIHOU					ダークネストリガー、ゲッシュ、矢避けの加護の대상が逆転していたのを修正
;	071		2022/01/03		しゃけ					잠재특수の処理を변경、ついでに劫火の余燼の処理改修
;	072		2022/01/04		kamedakeisuke(ﾟдﾟ)		ハーモナイザーの効果が인간による何らかの변신体（シフターなど）にも乗るように修正
;													倍率は인간体時の半分。やりこみ期において변신体の性能が변신前より見劣りする問題の応急処置（もっと良いやり方があればそっちに변경）
;													および、ハーモナイザーの発動可能서머너Lvを仕様に合わせLv1に修正（ハーモナイザーに関わる2か所の GET_SUMMONER_MLV > 2 を GET_SUMMONER_MLV > 0 に置き換え）
;	073		2022/01/27		しゃけ					バイㆍバイㆍライジングの회피率上昇の効果を追記
;	074		2022/04/14		takaya					마인学園キャラの固有스킬の処理を追記
;	075		2022/01/27		しゃけ					@SYNC_STATUSにて、사용者の사거리と공격범위が0の時は1に설정しなおすように변경
;	076		2022/06/10		Collared				UI整理プロジェクトにより参照番号をSHOP番号に변경
;	077		2021/08/25		しゃけ					전술영창γ、키메라의 효과를 추가, 겁화의 여진 소지분기가 같은 곳에 두 개나 있던 걸 수정, 「아빠이름걸고」가 통상의 치유ㆍ마맥보다 우선시되도록 수정, 라그나로크（ＡＮ）의 처리 일부 개수
;	078		2022/09/17		kamedakeisuke(ﾟдﾟ)		Aion식 소환술 쪽 사양을 추가
;
;	KR_01	2023/05/12		Moscode					장비추가스킬 12개까지 적용 가능하도록 수정
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;===============================
;＊重要＊
;能力ㆍ相性などの数を指定する
;===============================
@CONFIG_ELEMENT_NUM
;相性の数を指定します
FLAG:상성수 = 18
;기본能力値の数を指定します
FLAG:기본능력수 = 7
;전투能力値の数を指定します
FLAG:전투능력수 = 6
;습득できる스킬の数を指定します
FLAG:스킬수 = 8
;습득できる스킬の数を指定します(이능자달인用)
FLAG:이능자스킬수 = 12
;장비から取得できる추가스킬の数を指定します
FLAG:추가스킬수 = 21
;バッド스테이터스の数を指定します
FLAG:상태이상수 = 21




@SYNC_STATUS,ARG
;todo:どう考えてもLCOUNTでやる仕事じゃないのが混じってる　後できちんと変数を변경できたらいいなぁㆍㆍㆍ
#DIM LCOUNT,2
#DIM LSKILL_COUNT
;fixme:したの4つの変数、より説明的な変数名にしようとしたが処理が理解できていないため雑な名づけになっている　いっそTEMP,3とかにしてよかったかもしれないしあるいは処理の内容を再考するべき
#DIM LEQUIP_FIXED_VALUE
#DIM LFIXED_VALUE
#DIM LSUM_OF_BASE
#DIM LMANTRA_FIXED_VALUE
#DIM LFIXED_SUM_OF_BASE
;---- EDIT 041 MOD START -------------------------
#DIM 前장비스킬 , 21
;引数の番号のキャラクターの전투能力等を現在の能力値と同期化
;作業しながら考えてたけど전투能力値弄る人はここも弄るからここ修正する意味薄かった気がする。
;LOCAL:6まで使われていたので、7と8を최대HPㆍMP記録用として利用

;BASEからMAXBASEを計算しなおす
;조교結果をどう絡めるか思案中
FOR LCOUNT,0,FLAG:기본능력수
	LEQUIP_FIXED_VALUE = 0
	IF CFLAG:ARG:악마변신 == 0
		FOR LCOUNT:1,0,7
			IF 마정장비(EQUIP:ARG:(GET_EQUIP(LCOUNT:1)))
				CALLFORM 기본능력수정_마정장비,LCOUNT,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
			ELSE
				CALLFORM 기본능력수정_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))}, LCOUNT, ARG
			ENDIF
			LEQUIP_FIXED_VALUE += RESULT
		NEXT
	ENDIF
	MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = BASE:ARG:(GET_BASESTATUS(LCOUNT)) + LEQUIP_FIXED_VALUE + CFLAG:ARG:((GET_BASESTATUS(LCOUNT)) + "강화횟수")
	;변신済みの데빌시프터ㆍ식노、リンク済みのAion식소환술は此方	
	IF (CFLAG:ARG:악마변신 || (TALENT:ARG:Aion식소환술 && CFLAG:ARG:링크악마 > 0)) && LCOUNT > 0
		IF TALENT:ARG:데빌시프터
			SIF LCOUNT == 0
				CONTINUE
			LSUM_OF_BASE = BASE:ARG:힘 + BASE:ARG:지혜 + BASE:ARG:마력 + BASE:ARG:인내력 + BASE:ARG:속도 + BASE:ARG:운
			IF FLAG:데빌시프터스탯설정 == 0
				IF FINDCHARA_ID(CFLAG:ARG:링크악마) > 0
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = LSUM_OF_BASE * BASE:(FINDCHARA_ID(CFLAG:ARG:링크악마)):GET_BASESTATUS(LCOUNT)
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) /= 18 + BASE:(FINDCHARA_ID(CFLAG:ARG:링크악마)):LV * 3 / 2
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += LEQUIP_FIXED_VALUE + CFLAG:ARG:((GET_BASESTATUS(LCOUNT)) + "강화횟수")
				ELSE
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = LSUM_OF_BASE * CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , GET_BASESTATUS(LCOUNT)) , 0)
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) /= 18 + CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , "LV") , 0) * 3 / 2
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += LEQUIP_FIXED_VALUE + CFLAG:ARG:((GET_BASESTATUS(LCOUNT)) + "강화횟수")
				ENDIF
			ELSE
				IF FINDCHARA_ID(CFLAG:ARG:링크악마) > 0
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = BASE:ARG:(GET_BASESTATUS(LCOUNT)) + LEQUIP_FIXED_VALUE + CFLAG:ARG:((GET_BASESTATUS(LCOUNT)) + "강화횟수")
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += BASE:(FINDCHARA_ID(CFLAG:ARG:링크악마)):GET_BASESTATUS(LCOUNT) / 10
				ELSE
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = BASE:ARG:(GET_BASESTATUS(LCOUNT)) + LEQUIP_FIXED_VALUE + CFLAG:ARG:((GET_BASESTATUS(LCOUNT)) + "강화횟수")
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += CSVBASE(CFLAG:ARG:초기링크악마, GETNUM(BASE , GET_BASESTATUS(LCOUNT)) , 0) / 5
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += BASE:ARG:LV / 30
				ENDIF
			ENDIF
		;데빌시프터（ステ설정변경版）と同じ計算式で
		ELSEIF TALENT:ARG:Aion식소환술
			SIF LCOUNT == 0
				CONTINUE
			LSUM_OF_BASE = BASE:ARG:힘 + BASE:ARG:지혜 + BASE:ARG:마력 + BASE:ARG:인내력 + BASE:ARG:속도 + BASE:ARG:운
			MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = BASE:ARG:(GET_BASESTATUS(LCOUNT)) + LEQUIP_FIXED_VALUE + CFLAG:ARG:((GET_BASESTATUS(LCOUNT)) + "강화횟수")
			MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += BASE:(FINDCHARA_ID(CFLAG:ARG:링크악마)):GET_BASESTATUS(LCOUNT) / 10
			
		;식노 식노は純粋に초기링크악마＋만트라보정の比率に강화込みで振りなおす
		ELSE
			IF LCOUNT == 1
				LMANTRA_FIXED_VALUE = 0
				LFIXED_SUM_OF_BASE = 0
				FOR LOCAL, 1, 7
					LMANTRA_FIXED_VALUE += CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , GET_BASESTATUS(LOCAL)) , 0)
					LMANTRA_FIXED_VALUE += CFLAG:ARG:((GET_BASESTATUS(LOCAL)) + "만트라보정")
					LFIXED_SUM_OF_BASE += BASE:ARG:(GET_BASESTATUS(LOCAL)) + LEQUIP_FIXED_VALUE + CFLAG:ARG:((GET_BASESTATUS(LOCAL)) + "강화횟수")
				NEXT
			ENDIF
			MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = LFIXED_SUM_OF_BASE * (CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , GET_BASESTATUS(LCOUNT)) , 0) + CFLAG:ARG:(GET_BASESTATUS(LCOUNT) + "만트라보정")) / LMANTRA_FIXED_VALUE
			IF LCOUNT == 6
				;分配した스테이터스を無駄なくする
				LMANTRA_FIXED_VALUE = 0
				FOR LOCAL, 1, FLAG:기본능력수
					LOCAL:LOCAL = LOCAL
					LMANTRA_FIXED_VALUE += MAXBASE:ARG:(GET_BASESTATUS(LOCAL))
				NEXT
				;少ないと스테이터스の高い順から増やす
				IF LFIXED_SUM_OF_BASE > LMANTRA_FIXED_VALUE
					FOR LOCAL,1,7
						FOR LCOUNT,LOCAL+1,7
							IF CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , GET_BASESTATUS(LOCAL:LOCAL)) , 0) + CFLAG:ARG:(GET_BASESTATUS(LOCAL:LOCAL) + "만트라보정") < CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , GET_BASESTATUS(LCOUNT)) , 0) + CFLAG:ARG:(GET_BASESTATUS(LCOUNT) + "만트라보정")
								FOR LCOUNT:1,LCOUNT,LOCAL,-1
									SWAP LOCAL:(LCOUNT:1),LOCAL:(LCOUNT:1 - 1)
								NEXT
							ENDIF
						NEXT
					NEXT
					FOR LOCAL,0,LFIXED_SUM_OF_BASE - LMANTRA_FIXED_VALUE
						MAXBASE:ARG:(GET_BASESTATUS(LOCAL:(LOCAL % 6 + 1))) ++
					NEXT
				;多いと스테이터스の低い順から減らす
				ELSEIF LFIXED_SUM_OF_BASE < LMANTRA_FIXED_VALUE
					FOR LOCAL, 1, FLAG:기본능력수
						LOCAL:LOCAL = 7 - LOCAL
					NEXT
					FOR LOCAL,1,7
						FOR LCOUNT,LOCAL+1,7
							IF CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , GET_BASESTATUS(LOCAL:LOCAL)) , 0) + CFLAG:ARG:(GET_BASESTATUS(LOCAL:LOCAL) + "만트라보정") > CSVBASE(CFLAG:ARG:초기링크악마 , GETNUM(BASE , GET_BASESTATUS(LCOUNT)) , 0) + CFLAG:ARG:(GET_BASESTATUS(LCOUNT) + "만트라보정")
								FOR LCOUNT:1,LCOUNT,LOCAL,-1
									SWAP LOCAL:(LCOUNT:1),LOCAL:(LCOUNT:1 - 1)
								NEXT
							ENDIF
						NEXT
					NEXT
					FOR LOCAL,0,LMANTRA_FIXED_VALUE - LFIXED_SUM_OF_BASE
						MAXBASE:ARG:(GET_BASESTATUS(LOCAL:(LOCAL % 6 + 1))) --
					NEXT
				ENDIF
				LCOUNT = 6
			ENDIF
		ENDIF
	ENDIF
	;---- EDIT 056 MOD START -------------------------
	IF ARG == MASTER && EXTRA강화(0)
		SELECTCASE LCOUNT
			CASE 1,3
				MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += FLAG:이번주회음란인수 + (FLAG:이번주회신뢰인수 / 3 )
			CASE 2,5
				MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += FLAG:이번주회복종인수 + (FLAG:이번주회신뢰인수 / 3 )
			CASE 4,6
				MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += FLAG:이번주회연모인수 + (FLAG:이번주회신뢰인수 / 3 )
		ENDSELECT
	ELSEIF EXTRA강화(0)
		IF 함락(ARG) > 0
			SELECTCASE LCOUNT
				CASE 1,3
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += TALENT:ARG:음란 + TALENT:ARG:창부*2 + 함락(ARG)/2 + TALENT:ARG:음마
				CASE 2,5
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += TALENT:ARG:복종 + TALENT:ARG:예속*2 + 함락(ARG)/2 + TALENT:ARG:노리개
				CASE 4,6
					MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += TALENT:ARG:연모 + TALENT:ARG:친애*2 + 함락(ARG)/2 + (TALENT:ARG:아내 || TALENT:ARG:남편)
			ENDSELECT
		ENDIF
		;허니문&디보스보정
		SIF ABL:ARG:종족 > 0 && LCOUNT > 0
			MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += (EQUIP:MASTER:허니문 && NUM_SUMMONER()) * 함락(ARG) + (EQUIP:MASTER:디보스 && NUM_SUMMONER()) * MARK:ARG:반발각인
	ENDIF
	;바ㆍ벨修正
	IF ARG == MASTER && EQUIP:ARG:바ㆍ벨
		IF FLAG:벨신격파 & 64
			MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += 5
		ELSE
			SIF LCOUNT && GETBIT(FLAG:벨신격파, LCOUNT-1)
				MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += 3
		ENDIF
	ENDIF
	;---- EDIT 056 MOD END ---------------------------

	SIF TALENT:ARG:붕괴 && LCOUNT > 0
		TIMES MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) , 0.80
	SIF TALENT:ARG:임신
		MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) += 1
	;ふたごちゃんパッチオンの場合：5人以上のわりとヤバい임신数だとさすがに스테이터스が下がる
	;2以上でプラ마이ゼロ、5以上で마이ナス１
	SIF FLAG:쌍둥이플래그 > 0 && CFLAG:ARG:이번수태인수 > 1
		MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) -= 1
	SIF FLAG:쌍둥이플래그 > 0 && CFLAG:ARG:이번수태인수 > 4
		MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) -= 1


	;もろもろ計算で0以下になった場合は1に修正
	SIF MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) < 1
		MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = 1
NEXT
;페르소나修正
IF TALENT:ARG:페르소나구사자 && !CFLAG:ARG:악마변신
	LOCAL:7 = MAXBASE:ARG:ＨＰ
	LOCAL:8 = MAXBASE:ARG:ＭＰ
	CALL SYNC_STATUS_P(ARG)
	;ARG = RESULT
ENDIF

;조교効果をここに記述ㆍ기본能力
;---- EDIT 056 MOD START -------------------------
IF EXTRA강화(0) && ARG != MASTER && CFLAG:ARG:PT플래그 > 0
;---- EDIT 056 MOD END ---------------------------
	MAXBASE:ARG:LV += (MIN(ABL:ARG:순종,10) + MIN(ABL:ARG:욕망,10) + MIN(ABL:ARG:기교,10) +3)/6
;---- EDIT 032 MOD START -------------------------
	IF TALENT:ARG:맹우
		MAXBASE:ARG:힘 += 7
		MAXBASE:ARG:마력 += 7
		MAXBASE:ARG:운 += 7
		MAXBASE:ARG:인내력 += 7
		MAXBASE:ARG:지혜 += 7
		MAXBASE:ARG:속도 += 7
	ELSE
;---- EDIT 032 MOD END ---------------------------
		MAXBASE:ARG:힘 += (MIN(ABL:ARG:욕망,10)+1)/2
		MAXBASE:ARG:마력 += (MIN(ABL:ARG:욕망,10)+1)/2
		MAXBASE:ARG:운 += (MIN(ABL:ARG:순종,10)+1)/2
		MAXBASE:ARG:인내력 += (MIN(ABL:ARG:순종,10)+1)/2
		MAXBASE:ARG:지혜 += (MIN(ABL:ARG:기교,10)+1)/2
		MAXBASE:ARG:속도 += (MIN(ABL:ARG:기교,10)+1)/2
	ENDIF
ENDIF

;세대数を스테이터스にボーナス
IF EXTRA강화(1) && ARG != MASTER && CFLAG:ARG:PT플래그 > 0
	MAXBASE:ARG:LV += (MIN(TALENT:ARG:세대,10))/1
	MAXBASE:ARG:힘 += (MIN(TALENT:ARG:세대,10))/1
	MAXBASE:ARG:마력 += (MIN(TALENT:ARG:세대,10))/1
	MAXBASE:ARG:운 += (MIN(TALENT:ARG:세대,10))/1
	MAXBASE:ARG:인내력 += (MIN(TALENT:ARG:세대,10))/1
	MAXBASE:ARG:지혜 += (MIN(TALENT:ARG:세대,10))/1
	MAXBASE:ARG:속도 += (MIN(TALENT:ARG:세대,10))/1
ENDIF

;장비추가스킬、현재３개까지 설정가능
;XCOM2 WAR OF THE CHOSEN 모드팩 적용으로 12개까지 가능!
FOR LCOUNT,1,22
	LOCALS = 장비스킬{LCOUNT}
	;---- EDIT 041 MOD -------------------------
	前장비스킬:(LCOUNT - 1) = ABL:ARG:LOCALS
	ABL:ARG:LOCALS = 0
NEXT
LSKILL_COUNT = 0
FOR LCOUNT:1,0,7
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},0,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},1,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},2,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	;---- EDIT KR_01 ADD START -------------------------------
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},3,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},4,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},5,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},6,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},7,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},8,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},9,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	RESULT = 0
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},10,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	TRYCALLFORM 장비추가스킬_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},11,ARG
	LOCALS = 장비스킬{LSKILL_COUNT+1}
	LOCAL:9 = RESULT
	IF LOCAL:9 > 0
		ABL:ARG:LOCALS = LOCAL:9
		LSKILL_COUNT += 1
	ENDIF
	;---- EDIT KR_01 ADD END -------------------------------
	;-----------마정장비추가스킬ここから-----------
	IF 마정장비(EQUIP:ARG:(GET_EQUIP(LCOUNT:1)))
		RESULT = 0
		TRYCALLFORM 장비추가스킬_마정장비,0,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
		LOCALS = 장비스킬{LSKILL_COUNT+1}
		LOCAL:9 = RESULT
		IF LOCAL:9 > 0
			ABL:ARG:LOCALS = LOCAL:9
			LSKILL_COUNT += 1
		ENDIF
		RESULT = 0
		TRYCALLFORM 장비추가스킬_마정장비,1,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
		LOCALS = 장비스킬{LSKILL_COUNT+1}
		LOCAL:9 = RESULT
		IF LOCAL:9 > 0
			ABL:ARG:LOCALS = LOCAL:9
			LSKILL_COUNT += 1
		ENDIF
		RESULT = 0
		TRYCALLFORM 장비추가스킬_마정장비,2,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
		LOCALS = 장비스킬{LSKILL_COUNT+1}
		LOCAL:9 = RESULT
		IF LOCAL:9 > 0
			ABL:ARG:LOCALS = LOCAL:9
			LSKILL_COUNT += 1
		ENDIF
	ENDIF
	;-----------마정장비추가스킬ここまで-----------
NEXT

;---- EDIT 041 ADD START -------------------------
FOR LCOUNT , 0 , 21
	LOCALS = 장비스킬{LCOUNT+1}
	SIF 前장비스킬:LCOUNT != ABL:ARG:LOCALS
		CALL SKILLGAGE_DIRECT_CLEAR,ARG,LCOUNT + 30
NEXT
;---- EDIT 041 ADD END   -------------------------
;인수라のみ、습득스킬추가
IF TALENT:ARG:인수라
	LSKILL_COUNT = 0
	FOR LCOUNT:1,0,20
		RESULT = 0
		TRYCALLFORM P습득스킬_{EQUIP:ARG:(GET_EQUIP(6))},LCOUNT:1
		LOCAL:9 = RESULT
		LOCAL:10 = RESULT:1
		LOCALS = 습득스킬{LSKILL_COUNT+1}
		LOCALS:2 = 습득LV{LSKILL_COUNT+1}
		;장비品に습득스킬&LVが存在してて、かつ습득経験が無いことが조건
		IF LOCAL:9 > 0 && LOCAL:10 > 0 && !(CDFLAG:ARG:((EQUIP:ARG:(GET_EQUIP(6)))%5+1):((EQUIP:ARG:(GET_EQUIP(6))-8000)/5) & POWER(2,LCOUNT:1))
			ABL:ARG:LOCALS = LOCAL:9
			ABL:ARG:(LOCALS:2) = LOCAL:10
			LSKILL_COUNT += 1
		ELSE
			ABL:ARG:LOCALS = 0
			ABL:ARG:(LOCALS:2) = 0
			LSKILL_COUNT += 1
		ENDIF
	NEXT
ENDIF

;---- EDIT 029 MOD START -------------------------
;무기素質　一ノ型パラメータ보정
CALL MATCHING_WEAPON_CHECK(ARG)
LCOUNT = RESULT
CALL WEAPON_STYLE_CHECK(ARG,LCOUNT)
IF RESULT == 1
	RESULT = 0
	TRYCALLFORM 필요레벨_{EQUIP:ARG:검}
	RESULT = MIN(RESULT , 100)
	RESULT = RESULT/2 + MIN(RESULT%2 , 1)
	SELECTCASE LCOUNT
		CASE 1
			MAXBASE:ARG:힘 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:속도 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:운 += RESULT/3 + MIN(RESULT%3 , 1)
		CASE 2
			MAXBASE:ARG:지혜 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:속도 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:운 += RESULT/3 + MIN(RESULT%3 , 1)
		CASE 3
			MAXBASE:ARG:힘 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:마력 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:속도 += RESULT/3 + MIN(RESULT%3 , 1)
		CASE 4
			MAXBASE:ARG:힘 += RESULT/4 + MIN(RESULT%4 , 1)
			MAXBASE:ARG:인내력 += RESULT/4 + MIN(RESULT%4 , 1)
			MAXBASE:ARG:속도 += RESULT/4 + MIN(RESULT%4 , 1)
			MAXBASE:ARG:운 += RESULT/4 + MIN(RESULT%4 , 1)
		CASE 5
			MAXBASE:ARG:힘 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:인내력 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:운 += RESULT/3 + MIN(RESULT%3 , 1)
		CASE 6
			MAXBASE:ARG:힘 += RESULT/2 + MIN(RESULT%2 , 1)
			MAXBASE:ARG:인내력 += RESULT/2 + MIN(RESULT%2 , 1)
		CASE 7
			MAXBASE:ARG:지혜 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:마력 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:인내력 += RESULT/3 + MIN(RESULT%3 , 1)
		CASE 8
			MAXBASE:ARG:지혜 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:마력 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:속도 += RESULT/3 + MIN(RESULT%3 , 1)
		CASE 9
			MAXBASE:ARG:지혜 += RESULT/2 + MIN(RESULT%2 , 1)
			MAXBASE:ARG:마력 += RESULT/2 + MIN(RESULT%2 , 1)
		CASE 10
			MAXBASE:ARG:지혜 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:인내력 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:속도 += RESULT/3 + MIN(RESULT%3 , 1)
		CASE 11
			MAXBASE:ARG:힘 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:인내력 += RESULT/3 + MIN(RESULT%3 , 1)
			MAXBASE:ARG:속도 += RESULT/3 + MIN(RESULT%3 , 1)
	ENDSELECT
ENDIF
;---- EDIT 029 MOD END ---------------------------
;MAXBASEをそれぞれのLOCALに代入
FOR LCOUNT,0,FLAG:기본능력수
	LOCAL:(LCOUNT) = MAXBASE:ARG:(GET_BASESTATUS(LCOUNT))
;---- EDIT 028 MOD START -------------------------
;---- EDIT 040 MOD ---------------------------
;FLY상태で속도、레벨이외パラメータ1
	SIF GET_STATE(CFLAG:ARG:상태이상) == "FLY" && LCOUNT != 0 && LCOUNT != 5
		LOCAL:(LCOUNT) = 1
;---- EDIT 028 MOD END ---------------------------
NEXT


IF (ABL:ARG:종족 == 0 || ABL:ARG:종족 == 36) && CFLAG:ARG:악마변신 == 0
	;HP
	MAXBASE:ARG:ＨＰ = (LOCAL+LOCAL:1*2+LOCAL:4*7+5)*(100+LOCAL*3)/100
	SIF CFLAG:ARG:PT플래그 == 0 && ! CFLAG:ARG:보스플래그
		MAXBASE:ARG:ＨＰ = (LOCAL*3+LOCAL:1*2+LOCAL:4*9/2+5)*(100+LOCAL*3)/100
	SIF CFLAG:ARG:보스플래그
		MAXBASE:ARG:ＨＰ *= 4+(CFLAG:ARG:보스플래그)
	SIF CFLAG:ARG:PT플래그 == 0 && FLAG:전투난이도 > 3
		TIMES MAXBASE:ARG:ＨＰ , 1.50
	IF HAVE_SKILL(ARG,[[스킬:무도의마음가짐]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.60
	ELSEIF (HAVE_SKILL(ARG,[[스킬:삼할의활천]]) > 0 || HAVE_SKILL(ARG,[[스킬:네버기브업]]) > 0)
		TIMES MAXBASE:ARG:ＨＰ,1.30
	ELSEIF HAVE_SKILL(ARG,[[스킬:이할의활천]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.20
	ELSEIF HAVE_SKILL(ARG,[[스킬:일할의활천]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.10
	ENDIF
	MAXBASE:ARG:ＨＰ += CFLAG:ARG:ＨＰ보정

	;MP
	MAXBASE:ARG:ＭＰ = 0
	SIF TALENT:ARG:이능자 || TALENT:ARG:달인 || TALENT:ARG:페르소나구사자 || TALENT:ARG:데빌시프터 || TALENT:ARG:Aion식소환술 || TALENT:ARG:식노 || TALENT:ARG:악마빙의자 || ABL:ARG:종족 == 36 
		MAXBASE:ARG:ＭＰ = ((LOCAL+LOCAL:2/2+(LOCAL:3*3/2))*2 + 5) * (100+LOCAL)/100
	SIF CFLAG:ARG:보스플래그
		MAXBASE:ARG:ＭＰ *= 4+(CFLAG:ARG:보스플래그)
	IF HAVE_SKILL(ARG,[[스킬:마술의소양]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.60
	ELSEIF (HAVE_SKILL(ARG,[[스킬:삼할의마맥]]) > 0 || HAVE_SKILL(ARG,[[스킬:네버기브업]]) > 0)
		TIMES MAXBASE:ARG:ＭＰ,1.30
	ELSEIF HAVE_SKILL(ARG,[[스킬:이할의마맥]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.20
	ELSEIF HAVE_SKILL(ARG,[[스킬:일할의마맥]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.10
	ENDIF
	MAXBASE:ARG:ＭＰ += CFLAG:ARG:ＭＰ보정
	IF FLAG:인간전투스텟설정 == 2
		;공격
		BASE:ARG:(GET_BATTLESTATUS(0)) = (LOCAL/2+LOCAL:1*5/2+LOCAL:4) + CFLAG:ARG:공격보정
		;명중
		BASE:ARG:(GET_BATTLESTATUS(1)) = (LOCAL+LOCAL:5*5/2+LOCAL:6) + CFLAG:ARG:명중보정
		;방어
		BASE:ARG:(GET_BATTLESTATUS(2)) = (LOCAL+LOCAL:4*3+(LOCAL:1)/2) + CFLAG:ARG:방어보정
		;회피
		BASE:ARG:(GET_BATTLESTATUS(3)) = (LOCAL+LOCAL:5*5/2+LOCAL:6) + CFLAG:ARG:회피보정
		;마법위력
		BASE:ARG:(GET_BATTLESTATUS(4)) = (LOCAL/2+LOCAL:3*5/2+LOCAL:2) + CFLAG:ARG:마법위력보정
		;마법효과
		BASE:ARG:(GET_BATTLESTATUS(5)) = (LOCAL+LOCAL:2*2+LOCAL:6+LOCAL:3/2) + CFLAG:ARG:마법효과보정
	ELSE
		;공격
		BASE:ARG:(GET_BATTLESTATUS(0)) = (LOCAL/2+LOCAL:1+LOCAL:4/2) + CFLAG:ARG:공격보정
		;명중
		BASE:ARG:(GET_BATTLESTATUS(1)) = (LOCAL+LOCAL:5+LOCAL:6/2) + CFLAG:ARG:명중보정
		;방어
		BASE:ARG:(GET_BATTLESTATUS(2)) = (LOCAL+LOCAL:4) + CFLAG:ARG:방어보정
		;회피
		BASE:ARG:(GET_BATTLESTATUS(3)) = (LOCAL+LOCAL:5+LOCAL:6/2) + CFLAG:ARG:회피보정
		;마법위력
		BASE:ARG:(GET_BATTLESTATUS(4)) = (LOCAL/2+LOCAL:3+LOCAL:2/2) + CFLAG:ARG:마법위력보정
		;마법효과
		BASE:ARG:(GET_BATTLESTATUS(5)) = (LOCAL+LOCAL:2+LOCAL:6/2) + CFLAG:ARG:마법효과보정
		IF FLAG:인간전투스텟설정 == 1
			;명중
			BASE:ARG:(GET_BATTLESTATUS(1)) = (LOCAL+LOCAL:5*5/2+LOCAL:6) + CFLAG:ARG:명중보정
			;마법효과
			BASE:ARG:(GET_BATTLESTATUS(5)) = (LOCAL+LOCAL:2*2+LOCAL:6+LOCAL:3/2) + CFLAG:ARG:마법효과보정
		ENDIF
	ENDIF
	;---- EDIT 067 ADD START -------------------------
	;---- EDIT 068 ADD START -------------------------
	;총명중
;	IF TALENT:ARG:건슬링거 == 1
		BASE:ARG:총명중 = (LOCAL+LOCAL:5+LOCAL:6+LOCAL:2) + CFLAG:ARG:총명중보정
;	ELSE
;		BASE:ARG:총명중 = (LOCAL+LOCAL:5/2+LOCAL:6/2+LOCAL:2/2) + CFLAG:ARG:총명중보정
;	ENDIF
	;총공격
;	IF TALENT:ARG:건슬링거 == 1
		BASE:ARG:총공격 = (LOCAL + LOCAL:2/2 + LOCAL:5/2) + CFLAG:ARG:총공격보정
;	ELSE
;		BASE:ARG:총공격 = (LOCAL/2 + LOCAL:2/4 + LOCAL:5/4) + CFLAG:ARG:총공격보정
;	ENDIF
	;---- EDIT 067 ADD END -------------------------
	;---- EDIT 068 ADD END -------------------------
	;---- EDIT 054 ADD START -------------------------
	;도구명중
	;레벨*2+（속도と3+레벨/4の高い方）*2.5＋（마력と3+레벨/4の高い方）
	BASE:ARG:도구명중 = (LOCAL*2+MAX(LOCAL:5, 3+LOCAL/4)*5/2+MAX(LOCAL:3, 3+LOCAL/4)) + MAX(CFLAG:ARG:명중보정, CFLAG:ARG:마법효과보정)
	;도구위력
	;레벨*2+（지혜と3+레벨/4の高い方）*2.5＋（운と3+레벨/4の高い方）
	BASE:ARG:도구위력 = (LOCAL*2+MAX(LOCAL:2, 3+LOCAL/4)*5/2+MAX(LOCAL:6, 3+LOCAL/4)) + MAX(CFLAG:ARG:공격보정, CFLAG:ARG:마법위력보정)
	;ソフトハーモナイザーで기본능력강화
	IF EQUIP:MASTER:하모나이저 && GET_SUMMONER_MLV() > 2 && CFLAG:ARG:PT플래그 > 0
		;공격
		BASE:ARG:(GET_BATTLESTATUS(0)) += (LOCAL*3/2+LOCAL:1*3/2+LOCAL:4*1/2) * GET_하모나이저출력() / 100
		;명중
		BASE:ARG:(GET_BATTLESTATUS(1)) += (LOCAL+LOCAL:5*3/2+LOCAL:6*1/2) * GET_하모나이저출력() / 100
		;방어
		BASE:ARG:(GET_BATTLESTATUS(2)) += (LOCAL+LOCAL:4*2+(LOCAL:1)/2) * GET_하모나이저출력() / 100
		;회피
		BASE:ARG:(GET_BATTLESTATUS(3)) += (LOCAL+LOCAL:5*3/2+LOCAL:6*1/2) * GET_하모나이저출력() / 100
		;마법위력
		BASE:ARG:(GET_BATTLESTATUS(4)) += (LOCAL*3/2+LOCAL:3*3/2+LOCAL:2*1/2) * GET_하모나이저출력() / 100
		;마법효과
		BASE:ARG:(GET_BATTLESTATUS(5)) += (LOCAL+LOCAL:2+LOCAL:6/2+LOCAL:3/2) * GET_하모나이저출력() / 100
		;총공격
;		IF TALENT:ARG:건슬링거 == 1
			BASE:ARG:총공격 += (LOCAL + LOCAL:2/2 + LOCAL:5/2) * GET_하모나이저출력() / 100
;		ELSE
;			BASE:ARG:총공격 += (LOCAL/2 + LOCAL:2/4 + LOCAL:5/4) * GET_하모나이저출력() / 100
;		ENDIF
		;총명중
;		IF TALENT:ARG:건슬링거 == 1
			BASE:ARG:총명중 += (LOCAL+LOCAL:5+LOCAL:6+LOCAL:2) * GET_하모나이저출력() / 100
;		ELSE
;			BASE:ARG:총명중 += (LOCAL+LOCAL:5/2+LOCAL:6/2+LOCAL:2/2) * GET_하모나이저출력() / 100
;		ENDIF
		;テスト用
		;PRINTVW GET_하모나이저출력()
		;도구명중
		BASE:ARG:도구명중 += (LOCAL*2+MAX(LOCAL:5, 3+LOCAL/4)*5/2+MAX(LOCAL:3, 3+LOCAL/4)) * GET_하모나이저출력() / 100
		;도구위력
		BASE:ARG:도구위력 += (LOCAL*2+MAX(LOCAL:2, 3+LOCAL/4)*5/2+MAX(LOCAL:6, 3+LOCAL/4)) * GET_하모나이저출력() / 100
	ENDIF
	;LVが80を超えている場合、장비部分に相当する보정を추가で与える
	IF BASE:ARG:LV > 80 && CFLAG:ARG:장비보정변경횟수 > 0 && EQUIP:ARG:검 != [[아이템:리빙ㆍ엣지]]
		;공격
		BASE:ARG:(GET_BATTLESTATUS(0)) += (BASE:ARG:LV - 80) * CFLAG:ARG:1040 / 4
		;명중
		BASE:ARG:(GET_BATTLESTATUS(1)) += (BASE:ARG:LV - 80) * CFLAG:ARG:1041 / 4
		;방어
		BASE:ARG:(GET_BATTLESTATUS(2)) += (BASE:ARG:LV - 80) * CFLAG:ARG:1042 / 4
		;회피
		BASE:ARG:(GET_BATTLESTATUS(3)) += (BASE:ARG:LV - 80) * CFLAG:ARG:1043 / 4
		;마법위력
		BASE:ARG:(GET_BATTLESTATUS(4)) += (BASE:ARG:LV - 80) * CFLAG:ARG:1044 / 4
		;마법효과
		BASE:ARG:(GET_BATTLESTATUS(5)) += (BASE:ARG:LV - 80) * CFLAG:ARG:1045 / 4
		;총공격
		BASE:ARG:총공격 += (BASE:ARG:LV - 80) * CFLAG:ARG:1046 / 4
		;총명중
		BASE:ARG:총명중 += (BASE:ARG:LV - 80) * CFLAG:ARG:1047 / 4
		;도구명중
		BASE:ARG:도구명중 += (BASE:ARG:LV - 80) * 7 / 4
		;도구위력
		BASE:ARG:도구위력 += (BASE:ARG:LV - 80) * 9 / 4
	ELSEIF BASE:ARG:LV > 80 && EQUIP:ARG:검 != [[아이템:리빙ㆍ엣지]]
		;공격
		BASE:ARG:(GET_BATTLESTATUS(0)) += (BASE:ARG:LV - 80) * 9 / 4
		;명중
		BASE:ARG:(GET_BATTLESTATUS(1)) += (BASE:ARG:LV - 80) * 7 / 4
		;방어
		BASE:ARG:(GET_BATTLESTATUS(2)) += (BASE:ARG:LV - 80) * 11 / 4
		;회피
		BASE:ARG:(GET_BATTLESTATUS(3)) += (BASE:ARG:LV - 80) * 7 / 4
		;마법위력
		BASE:ARG:(GET_BATTLESTATUS(4)) += (BASE:ARG:LV - 80) * 9 / 4
		;마법효과
		BASE:ARG:(GET_BATTLESTATUS(5)) +=(BASE:ARG:LV - 80) * 7 / 4
		;총명중
		BASE:ARG:총명중 += (BASE:ARG:LV - 80) * 7 / 4
		;총공격
		BASE:ARG:총공격 += (BASE:ARG:LV - 80) * 9 / 4
		;도구명중
		BASE:ARG:도구명중 += (BASE:ARG:LV - 80) * 7 / 4
		;도구위력
		BASE:ARG:도구위력 += (BASE:ARG:LV - 80) * 9 / 4
	ENDIF
	;장비보정を作る필요がでるまではここで決め打ち
	MAXBASE:ARG:도구명중 = BASE:ARG:도구명중
	MAXBASE:ARG:도구위력 = BASE:ARG:도구위력
	;---- EDIT 054 ADD END -------------------------

;---- EDIT 028 ADD START -------------------------
	SIF TALENT:ARG:페르소나구사자
		CALL 페르소나구사자전투스테이터스강화패치(ARG)
;---- EDIT 028 ADD END-- -------------------------

	;장비品の보정
	FOR LCOUNT,0,FLAG:전투능력수
		LEQUIP_FIXED_VALUE = 0
		FOR LCOUNT:1,0,7
			IF 마정장비(EQUIP:ARG:(GET_EQUIP(LCOUNT:1)))
				CALLFORM 전투능력수정_마정장비,LCOUNT,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
			ELSE
				CALLFORM 전투능력수정_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},LCOUNT,ARG
				CALL 장비강화_전개, ARG, EQUIP:ARG:GET_EQUIP(LCOUNT:1), "전투능력수정", GET_BATTLESTATUS(LCOUNT), RESULT
			ENDIF
			LFIXED_VALUE = RESULT
;---- EDIT 024 DEL START -------------------------
;			SIF HAVE_SKILL(ARG, 2443)
;				TIMES LFIXED_VALUE,1.25
;---- EDIT 024 DEL END-- -------------------------
			IF LCOUNT:1 == 0
				TRYCCALLFORM 검타입_{EQUIP:ARG:GET_EQUIP(LCOUNT:1)}
					IF RESULT > 0
						;---- EDIT 029 MOD
						SIF TALENT:ARG:(249 + RESULT) && LFIXED_VALUE > 0
							TIMES LFIXED_VALUE,1.10
						SIF TALENT:ARG:(249 + RESULT) && LFIXED_VALUE < 0
							TIMES LFIXED_VALUE,0.50
					ENDIF
				CATCH
				ENDCATCH
			ENDIF
			IF BASE:ARG:LV > 100
				TRYCCALLFORM 필요레벨_{EQUIP:ARG:GET_EQUIP(LCOUNT:1)}
					SIF RESULT > 69
						LFIXED_VALUE = LFIXED_VALUE * BASE:ARG:LV / 100
				CATCH
				ENDCATCH
			ENDIF
			LEQUIP_FIXED_VALUE += LFIXED_VALUE
		NEXT
		IF FLAG:인간전투스텟설정 == 3 && (TALENT:ARG:이능자 || TALENT:ARG:달인 || ABL:ARG:종족 == 0 || ABL:ARG:종족 == 36)
			IF SKILL_EQUIPTHEORY_IS_HAVE_SKILL(ARG)
				MAXBASE:ARG:(GET_BATTLESTATUS(LCOUNT)) = BASE:ARG:(GET_BATTLESTATUS(LCOUNT)) + SKILL_EQUIPTHEORY_EQUIP_STATUS(ARG, LEQUIP_FIXED_VALUE)
			ELSE
				MAXBASE:ARG:(GET_BATTLESTATUS(LCOUNT)) = BASE:ARG:(GET_BATTLESTATUS(LCOUNT)) + LEQUIP_FIXED_VALUE * (100 + (BASE:ARG:LV/2)) / 100
			ENDIF
		ELSE
			IF SKILL_EQUIPTHEORY_IS_HAVE_SKILL(ARG)
				MAXBASE:ARG:(GET_BATTLESTATUS(LCOUNT)) = BASE:ARG:(GET_BATTLESTATUS(LCOUNT)) + SKILL_EQUIPTHEORY_EQUIP_STATUS(ARG, LEQUIP_FIXED_VALUE)
			ELSE
				MAXBASE:ARG:(GET_BATTLESTATUS(LCOUNT)) = BASE:ARG:(GET_BATTLESTATUS(LCOUNT)) + LEQUIP_FIXED_VALUE
			ENDIF
		ENDIF
	NEXT

	FOR LCOUNT,0,FLAG:상성수
		SIF TALENT:ARG:비전투원 && LCOUNT != 10
			BASE:ARG:GET_TYPE(LCOUNT) = 100
		SIF TALENT:ARG:비전투원 && LCOUNT == 10
			BASE:ARG:GET_TYPE(LCOUNT) = 0
		;페르소나구사자はすでに내성変化を終えてるのでBREAK
		SIF TALENT:ARG:페르소나구사자
			BREAK
		;반마인は장비の影響を受けずに相性변경の影響を受ける
		IF ABL:ARG:종족 == 36
;---- EDIT 034 MOD START -------------------------
			;MAXBASE:ARG:GET_TYPE(LCOUNT)  = CFLAG:ARG:변경상성1 == LCOUNT + 1 ? CFLAG:ARG:변경상성치1 # BASE:ARG:GET_TYPE(LCOUNT)
			MAXBASE:ARG:GET_TYPE(LCOUNT) = BASE:ARG:GET_TYPE(LCOUNT)
			SIF CFLAG:ARG:변경상성1 == LCOUNT + 1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:ARG:변경상성치1
			SIF CFLAG:ARG:추가변경상성1 == LCOUNT + 1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:ARG:추가변경상성치1
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD START ----
			SIF CFLAG:ARG:추가변경상성2 == LCOUNT + 1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:ARG:추가변경상성치2
			SIF CFLAG:ARG:추가변경상성3 == LCOUNT + 1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:ARG:추가변경상성치3
			SIF CFLAG:ARG:추가변경상성4 == LCOUNT + 1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:ARG:추가변경상성치4
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD END   ----
			CONTINUE
			;---- EDIT 034 MOD END ---------------------------
		;Aion식 소환술은 장비의 영향을 받지 않으며 링크한 악마의 영향을 받는다
		ELSEIF TALENT:ARG:Aion식소환술 && CFLAG:ARG:링크악마 > 0 && FINDCHARA_ID(CFLAG:ARG:링크악마) > 0
			;변신先악마が居れば、その악마の相性をコピー
			MAXBASE:ARG:GET_TYPE(LCOUNT) = BASE:FINDCHARA_ID(CFLAG:ARG:링크악마):GET_TYPE(LCOUNT)
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):변경상성1 == LCOUNT+1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):변경상성치1
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성1 == LCOUNT+1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치1
			;---- EDIT 042 함락履歴により내성강화を更に추가で可能に ADD START ----
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성2 == LCOUNT+1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치2
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성3 == LCOUNT+1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치3
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성4 == LCOUNT+1
				MAXBASE:ARG:GET_TYPE(LCOUNT) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치4
			;---- EDIT 042 함락履歴により내성강화を更に추가で可能に ADD END   ----
			CONTINUE
		ENDIF
		VARSET T,-1
		FOR LCOUNT:1,0,7
			IF 마정장비(EQUIP:ARG:(GET_EQUIP(LCOUNT:1)))
				CALLFORM 방어상성_마정장비,LCOUNT,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
				T:(LCOUNT:1) = RESULT
			ELSE
				CALLFORM 방어상성_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},LCOUNT,ARG
				CALL 장비강화_전개, ARG, EQUIP:ARG:GET_EQUIP(LCOUNT:1), "방어상성", GET_TYPE(LCOUNT), RESULT
				T:(LCOUNT:1) = RESULT
			ENDIF
		NEXT
		T:7 = BASE:ARG:(GET_TYPE(LCOUNT))
		IF T:7 < 100 || T:7 == 999
			IF MINARRAY(T,0,7) < 100
				IF MAXARRAY(T,0,7) > 100
					MAXBASE:ARG:(GET_TYPE(LCOUNT)) = MINARRAY(T,0,7)
					SIF MAXBASE:ARG:(GET_TYPE(LCOUNT)) > -1 && MATCH(T,999,0,7)
						MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 999
				ELSE
					MAXBASE:ARG:(GET_TYPE(LCOUNT)) = MINARRAY(T,0,8)
					SIF MAXBASE:ARG:(GET_TYPE(LCOUNT)) > -1 && MATCH(T,999,0,8)
						MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 999
				ENDIF
			ELSEIF MAXARRAY(T,0,7) > 100
				MAXBASE:ARG:(GET_TYPE(LCOUNT)) = MAXARRAY(T,0,7)
				SIF MAXBASE:ARG:(GET_TYPE(LCOUNT)) > -1 && MATCH(T,999,0,7)
					MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 999

			ELSE
				MAXBASE:ARG:(GET_TYPE(LCOUNT)) = T:7
				SIF MAXBASE:ARG:(GET_TYPE(LCOUNT)) > -1 && MATCH(T,999,0,8)
					MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 999
			ENDIF
		ELSE
			MAXBASE:ARG:(GET_TYPE(LCOUNT)) = MINARRAY(T,0,8)
			IF MAXBASE:ARG:(GET_TYPE(LCOUNT)) < 100
			ELSE
				MAXBASE:ARG:(GET_TYPE(LCOUNT)) = MAXARRAY(T,0,8)
			ENDIF
			SIF MAXBASE:ARG:(GET_TYPE(LCOUNT)) > -1 && MATCH(T,999,0,8)
				MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 999
		ENDIF
	NEXT

	FOR LCOUNT,0,FLAG:상태이상수
		VARSET T,-1
		;該当조건を満たすと브레이크する
		;장비効果설정が통상の場合、P3型を除く페르소나구사자はバステ내성변경がない
		SIF (BATTLE_SETTING_IS_EQUIPTHEORY() && TALENT:ARG:페르소나구사자 == 1 && FLAG:페르소나구사자사양설정 < 2) || (BATTLE_SETTING_IS_EQUIPTHEORY() && TALENT:ARG:페르소나구사자 >= 1 && FLAG:페르소나구사자사양설정 == 1)
			BREAK
		;반마인は元々のバステ내성をみる
		IF ABL:ARG:종족 == 36
			MAXBASE:ARG:(GET_STATE(LCOUNT)) = BASE:ARG:(GET_STATE(LCOUNT))
			CONTINUE
		ENDIF
		FOR LCOUNT:1,0,7
			IF 마정장비(EQUIP:ARG:(GET_EQUIP(LCOUNT:1)))
				RESULT = 0
				TRYCALLFORM BS내성_마정장비,LCOUNT,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
				T:(LCOUNT:1) = RESULT
			ELSE
				RESULT = 0
				TRYCALLFORM BS내성_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},LCOUNT,ARG
				T:(LCOUNT:1) = RESULT
			ENDIF
		NEXT
		T:7 = BASE:ARG:(GET_STATE(LCOUNT))

		IF T:7 < 0
			IF MINARRAY(T,0,7) < 0
				IF MAXARRAY(T,0,7) > 0
					MAXBASE:ARG:(GET_STATE(LCOUNT)) = MINARRAY(T,0,7)
				ELSE
					MAXBASE:ARG:(GET_STATE(LCOUNT)) = MINARRAY(T,0,8)
				ENDIF
			ELSEIF MAXARRAY(T,0,7) > 0
				MAXBASE:ARG:(GET_STATE(LCOUNT)) = MAXARRAY(T,0,7)
			ELSE
				MAXBASE:ARG:(GET_STATE(LCOUNT)) = T:7
			ENDIF
		ELSE
			MAXBASE:ARG:(GET_STATE(LCOUNT)) = MINARRAY(T,0,8)
			IF MAXBASE:ARG:(GET_STATE(LCOUNT)) < 0
			ELSE
				MAXBASE:ARG:(GET_STATE(LCOUNT)) = MAXARRAY(T,0,8)
			ENDIF
		ENDIF
	NEXT



	IF 마정장비(EQUIP:ARG:검)
		CALLFORM 공격상성_마정장비,EQUIP:ARG:검-2450
		ABL:ARG:공격상성 = RESULT
		CALLFORM 사거리_마정장비,EQUIP:ARG:검-2450
		ABL:ARG:사거리 = RESULT > 0 ? RESULT # 1
		CALLFORM 최저공격횟수_마정장비,EQUIP:ARG:검-2450
		ABL:ARG:최저공격횟수 = RESULT
		CALLFORM 최대공격횟수_마정장비,EQUIP:ARG:검-2450
		ABL:ARG:최대공격횟수 = RESULT
		CALLFORM 공격범위_마정장비,EQUIP:ARG:검-2450
		ABL:ARG:공격범위 = RESULT > 0 ? RESULT # 1
		TRYCCALLFORM 추가효과_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:추가효과 = RESULT
			CALLFORM 추가효과상성_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:추가효과상성 = RESULT
			CALLFORM 추가효과명중률_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:추가효과명중률 = RESULT
			CALLFORM 추가효과최대명중률_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:추가효과최대명중률 = RESULT
		CATCH
			ABL:ARG:추가효과 = 0
			ABL:ARG:추가효과상성 = 0
			ABL:ARG:추가효과명중률 = 0
			ABL:ARG:추가효과최대명중률 = 0
		ENDCATCH
	ELSE
		CALLFORM 공격상성_{EQUIP:ARG:검},ARG
		ABL:ARG:공격상성 = RESULT
		CALLFORM 사거리_{EQUIP:ARG:검},ARG
		ABL:ARG:사거리 = RESULT > 0 ? RESULT # 1
		CALLFORM 최저공격횟수_{EQUIP:ARG:검},ARG
		ABL:ARG:최저공격횟수 = RESULT
		CALLFORM 최대공격횟수_{EQUIP:ARG:검},ARG
		ABL:ARG:최대공격횟수 = RESULT
		CALLFORM 공격범위_{EQUIP:ARG:검},ARG
		ABL:ARG:공격범위 = RESULT > 0 ? RESULT # 1
		TRYCCALLFORM 추가효과_{EQUIP:ARG:검},ARG
			IF GET_STATE(RESULT) == "GOOD" 
				CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "상태이상"
				IF GET_STATE(RESULT) != "GOOD"
					ABL:ARG:추가효과 = RESULT
					CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "효과상성"
					ABL:ARG:추가효과상성 = RESULT
					CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "기본명중"
					ABL:ARG:추가효과명중률 = RESULT
					CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "최대명중"
					ABL:ARG:추가효과최대명중률 = RESULT
				ELSE
					ABL:ARG:추가효과 = 0
					ABL:ARG:추가효과상성 = 0
					ABL:ARG:추가효과명중률 = 0
					ABL:ARG:추가효과최대명중률 = 0
				ENDIF
			ELSE
				ABL:ARG:추가효과 = RESULT
				CALLFORM 추가효과상성_{EQUIP:ARG:검},ARG
				ABL:ARG:추가효과상성 = RESULT
				CALLFORM 추가효과명중률_{EQUIP:ARG:검},ARG
				ABL:ARG:추가효과명중률 = RESULT
				CALLFORM 추가효과최대명중률_{EQUIP:ARG:검},ARG
				ABL:ARG:추가효과최대명중률 = RESULT
			ENDIF
		CATCH
			CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "상태이상"
			IF GET_STATE(RESULT) != "GOOD"
				ABL:ARG:추가효과 = RESULT
				CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "효과상성"
				ABL:ARG:추가효과상성 = RESULT
				CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "기본명중"
				ABL:ARG:추가효과명중률 = RESULT
				CALL 장비강화_전개, ARG, EQUIP:ARG:검, "추가효과", "최대명중"
				ABL:ARG:추가효과최대명중률 = RESULT
			ELSE
				ABL:ARG:추가효과 = 0
				ABL:ARG:추가효과상성 = 0
				ABL:ARG:추가효과명중률 = 0
				ABL:ARG:추가효과최대명중률 = 0
			ENDIF
		ENDCATCH
	ENDIF

	IF EQUIP:ARG:총 > 0
		IF 마정장비(EQUIP:ARG:총)
			CALLFORM 총명중_마정장비,EQUIP:ARG:총-2900
			MAXBASE:ARG:총명중 = BASE:ARG:총명중 + RESULT
			CALLFORM 총공격_마정장비,EQUIP:ARG:총-2900
			MAXBASE:ARG:총공격 = BASE:ARG:총공격 + RESULT
		ELSE
			LFIXED_VALUE = 100
			IF BASE:ARG:LV > 100
				TRYCCALLFORM 필요레벨_{EQUIP:ARG:총}
					SIF RESULT > 69
						LFIXED_VALUE = BASE:ARG:LV
				CATCH
				ENDCATCH
			ENDIF
			CALLFORM 총명중_{EQUIP:ARG:총},ARG
			CALL 장비강화_전개, ARG, EQUIP:ARG:총, "전투능력수정", "총명중", RESULT
			MAXBASE:ARG:총명중 = BASE:ARG:총명중 + (RESULT * LFIXED_VALUE/100)
			CALLFORM 총공격_{EQUIP:ARG:총},ARG
			CALL 장비강화_전개, ARG, EQUIP:ARG:총, "전투능력수정", "총공격", RESULT
			MAXBASE:ARG:총공격 = BASE:ARG:총공격 + (RESULT * LFIXED_VALUE/100)
		ENDIF

	ELSE
		MAXBASE:ARG:총명중 = 0
		MAXBASE:ARG:총공격 = 0
	ENDIF

	;조교効果をここに記述ㆍ전투能力
	IF ARG != MASTER && CFLAG:ARG:PT플래그 > 0
		;現状処理なし
	ENDIF

	;NEXT経験値
	;MAXBASE:ARG:ＥＸＰ  = 5*(BASE:ARG:LV)*(BASE:ARG:LV+1)*(BASE:ARG:LV+2)/3
	MAXBASE:ARG:ＥＸＰ = GET_NEXT_EXP(BASE:ARG:LV, ABL:ARG:종족 && !함락(ARG))
	BASE:ARG:ＥＸＰ = MAX(BASE:ARG:ＥＸＰ, GET_NEXT_EXP(BASE:ARG:LV - 1, ABL:ARG:종족 && !함락(ARG)))

	;ＭＡＧ
	IF ARG == MASTER
		;--- MOD 039 START---
		;片キンフラグあり
		IF GETBIT(이벤트플래그:93:11, 60)
			MAXBASE:ARG:ＭＡＧ  = (15)*(LOCAL)*(LOCAL+1)*(LOCAL+2)
		;なし（通常）
		ELSE
			MAXBASE:ARG:ＭＡＧ  = (75)*(LOCAL)*(LOCAL+1)*(LOCAL+2)
		ENDIF
		;--- MOD 039 END---
	ELSE
		MAXBASE:ARG:ＭＡＧ  = (15+함락(ARG)*3)*(LOCAL)*(LOCAL+1)*(LOCAL+2)
	ENDIF

	;抗体ポイント
	IF CSVBASE(NO:ARG,GETNUM(BASE,"CP"),0) != 0 && CFLAG:ARG:PT플래그 > 0
		LOCAL:1 = 15
		FOR LOCAL,0,FLAG:상성수 +1
			SELECTCASE MAXBASE:ARG:(GET_TYPE(LOCAL))
				CASE 999
					LOCAL:1 += 55
				CASE IS < 0
					LOCAL:1 += 55
				CASE 0
					LOCAL:1 += 40
				CASE IS > 199
					LOCAL:1 -= 25
				CASE IS > 100
					LOCAL:1 -= 15
				CASE IS <= 50
					LOCAL:1 += 25
				CASE IS < 100
					LOCAL:1 += 15
			ENDSELECT
		NEXT
		BASE:ARG:CP = MAX(1,LOCAL:1/2) + CFLAG:ARG:ＣＰ보정
		MAXBASE:ARG:CP = MAX(1,BASE:ARG:CP * MAXBASE:ARG:LV / 50 * (100-MIN(10000,BASE:ARG:충성도)*50/10000) / 100)
		MAXBASE:ARG:￥ = MAX(1,BASE:ARG:CP * MAXBASE:ARG:LV * (100-MIN(5000,BASE:ARG:충성도)*90/5000) / 100)
	ELSE
		MAXBASE:ARG:CP = BASE:ARG:CP * MAXBASE:ARG:LV / 50
		MAXBASE:ARG:￥ = 0
	ENDIF

;==============================
;마인学園専用技に関する処理
;==============================
;◯【菩薩眼】の場合ＭＰアップ、마법위력アップ、마법효과アップ
	SIF HAVE_PU_SKILL(ARG,"【菩薩眼】")
		TIMES MAXBASE:ARG:ＭＰ,1.30
		TIMES MAXBASE:ARG:마법위력,1.10
		TIMES MAXBASE:ARG:마법효과,1.10
;◯【宿星：義星】の場合회피アップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：義星】")
		TIMES MAXBASE:ARG:회피,1.10
;◯【宿星：白虎】の場合ＨＰアップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：白虎】")
		TIMES MAXBASE:ARG:ＨＰ,1.30
;◯【宿星：玄武】の場合ＨＰアップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：玄武】")
		TIMES MAXBASE:ARG:ＨＰ,1.30
;◯【宿星：青龍】の場合ＨＰアップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：青龍】")
		TIMES MAXBASE:ARG:ＨＰ,1.30
;◯【宿星：朱雀】の場合ＨＰアップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：朱雀】")
		TIMES MAXBASE:ARG:ＨＰ,1.30
;◯【宿星：悌星】の場合명중アップ、총명중アップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：悌星】")
		TIMES MAXBASE:ARG:명중,1.10
		TIMES MAXBASE:ARG:총명중,1.10
;◯【宿星：勇星】の場合방어アップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：勇星】")
		TIMES MAXBASE:ARG:방어,1.20
;◯【宿星：情星】の場合속도アップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：情星】")
		TIMES MAXBASE:ARG:속도,1.20
;◯【宿星：慈星】の場合회피アップ
	SIF HAVE_PU_SKILL(ARG,"【宿星：慈星】")
		TIMES MAXBASE:ARG:회피,1.20
;==============================
;마인学園専用技に関する処理ここまで
;==============================


ELSE
;악마の場合
	;--- MOD 069 START---
	FOR LCOUNT,1,FLAG:기본능력수
		;식노の스테이터스分配で0以下になってしまう場合があるので仕方なく1に修正;あくまで応急措置;本当は良くない;誰か負の値にならないように直して～
		IF MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) < 1 && TALENT:ARG:식노
	;		PRINTFORMW    %CALLNAME:ARG% %GET_BASESTATUS(LCOUNT),4% {MAXBASE:ARG:(GET_BASESTATUS(LCOUNT))}
			MAXBASE:ARG:(GET_BASESTATUS(LCOUNT)) = 1
		ENDIF
	NEXT
	;--- MOD 069 END---
	;HP
	MAXBASE:ARG:ＨＰ = (LOCAL+LOCAL:1*2+LOCAL:4*7+5)*(100+LOCAL*3)/100
	SIF CFLAG:ARG:PT플래그 == 0 && ! CFLAG:ARG:보스플래그
		MAXBASE:ARG:ＨＰ = (LOCAL*3+LOCAL:1*2+LOCAL:4*9/2+5)*(100+LOCAL*3)/100
	SIF CFLAG:ARG:보스플래그
		MAXBASE:ARG:ＨＰ *= 5+CFLAG:ARG:보스플래그
	SIF CFLAG:ARG:PT플래그 == 0 && FLAG:전투난이도 > 3
		TIMES MAXBASE:ARG:ＨＰ , 1.50
	;---- EDIT 065 ADD START  -------------------------
	SIF HAVE_PU_SKILL(ARG,"버서커")
		TIMES MAXBASE:ARG:ＨＰ,1.80
	;---- EDIT 065 ADD END  -------------------------
	;---- EDIT 066 MOD START -----------------------------
	SIF HAVE_PU_SKILL(ARG,"ルーラー")
		TIMES MAXBASE:ARG:ＨＰ,1.20
	;---- EDIT 066 MOD END -------------------------------
	IF HAVE_SKILL(ARG,[[스킬:무도의마음가짐]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.60
	ELSEIF HAVE_SKILL(ARG,[[스킬:네버기브업]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.30
	ELSEIF HAVE_SKILL(ARG,[[스킬:삼할의활천]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.30
	ELSEIF HAVE_SKILL(ARG,[[스킬:이할의활천]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.20
	ELSEIF HAVE_SKILL(ARG,[[스킬:일할의활천]]) > 0
		TIMES MAXBASE:ARG:ＨＰ,1.10
	ENDIF
	;---- EDIT 063 ADD START  -------------------------
	SIF AUTO_PU_SKILL_ラグナロク（ＡＮ）(ARG,"ＨＰ増加") > 0
		MAXBASE:ARG:ＨＰ = MAX(MAXBASE:ARG:ＨＰ + 5000,MAXBASE:ARG:ＨＰ * 2714 / 1000)
	;---- EDIT 063 ADD END    -------------------------
	;---- EDIT 077 ADD START  -------------------------
	CALL AUTO_PU_SKILL_キメラ(ARG,"최대ＨＰ↑")
	MAXBASE:ARG:ＨＰ = MAXBASE:ARG:ＨＰ * (RESULT + 100) / 100
	;---- EDIT 077 ADD END    -------------------------
	MAXBASE:ARG:ＨＰ += CFLAG:ARG:ＨＰ보정

	;MP
	MAXBASE:ARG:ＭＰ = ((LOCAL+LOCAL:2/2+(LOCAL:3*3/2))*2 + 5) * (100+LOCAL)/100
	SIF CFLAG:ARG:보스플래그
		MAXBASE:ARG:ＭＰ *= 5+CFLAG:ARG:보스플래그
	;---- EDIT 065 ADD START  -------------------------
	;---- EDIT 066 MOD START --------------------------
	SIF HAVE_PU_SKILL(ARG,"어새신") || HAVE_PU_SKILL(ARG,"캐스터")
		TIMES MAXBASE:ARG:ＭＰ,1.30
	;---- EDIT 066 MOD END ----------------------------
	;---- EDIT 065 ADD END  -------------------------
	IF HAVE_SKILL(ARG,[[스킬:마술의소양]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.60
	ELSEIF HAVE_SKILL(ARG,[[스킬:네버기브업]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.30
	ELSEIF HAVE_SKILL(ARG,[[스킬:삼할의마맥]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.30
	ELSEIF HAVE_SKILL(ARG,[[스킬:이할의마맥]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.20
	ELSEIF HAVE_SKILL(ARG,[[스킬:일할의마맥]]) > 0
		TIMES MAXBASE:ARG:ＭＰ,1.10
	ENDIF
	MAXBASE:ARG:ＭＰ += CFLAG:ARG:ＭＰ보정

	;공격
	BASE:ARG:(GET_BATTLESTATUS(0)) = (LOCAL*2+LOCAL:1*5/2+LOCAL:4) + CFLAG:ARG:공격보정
	;명중
	BASE:ARG:(GET_BATTLESTATUS(1)) = (LOCAL*2+LOCAL:5*5/2+LOCAL:6) + CFLAG:ARG:명중보정
	;방어
	BASE:ARG:(GET_BATTLESTATUS(2)) = (LOCAL*2+LOCAL:4*3+(LOCAL:1)/2) + CFLAG:ARG:방어보정
	;회피
	BASE:ARG:(GET_BATTLESTATUS(3)) = (LOCAL*2+LOCAL:5*5/2+LOCAL:6) + CFLAG:ARG:회피보정
	;마법위력
	BASE:ARG:(GET_BATTLESTATUS(4)) = (LOCAL*2+LOCAL:3*5/2+LOCAL:2) + CFLAG:ARG:마법위력보정
	;마법효과
	BASE:ARG:(GET_BATTLESTATUS(5)) = (LOCAL*2+LOCAL:2*2+LOCAL:6+LOCAL:3/2) + CFLAG:ARG:마법효과보정

	;---- EDIT 054 ADD START -------------------------
	;악마は道具能力低め。どうせ사용には아이템숙련いるし
	;도구명중
	;레벨*1.5+（속도と3+레벨/4の高い方）*2＋（마력と3+레벨/4の高い方）
	BASE:ARG:도구명중 = (LOCAL*3/2+MAX(LOCAL:5, 3+LOCAL/4)*2+MAX(LOCAL:3, 3+LOCAL/4)) + MAX(CFLAG:ARG:명중보정, CFLAG:ARG:마법효과보정)
	;道具威힘
	;레벨*1.5+（지혜と3+레벨/4の高い方）*2＋（운と3+레벨/4の高い方）
	BASE:ARG:도구위력 = (LOCAL*3/2+MAX(LOCAL:2, 3+LOCAL/4)*2+MAX(LOCAL:6, 3+LOCAL/4)) + MAX(CFLAG:ARG:공격보정, CFLAG:ARG:마법위력보정)
	
	;---- EDIT 072 ADD START -------------------------
	;인간で、シフター等の何らかの변신体であるば아이、ソフトハーモナイザーで기본능력강화。倍率は인간体の半分
	IF EQUIP:MASTER:하모나이저 && GET_SUMMONER_MLV() > 0 && CFLAG:ARG:PT플래그 > 0 && CFLAG:ARG:악마변신 && (ABL:ARG:종족 == 0 || ABL:ARG:종족 == 36) 
		;공격
		BASE:ARG:(GET_BATTLESTATUS(0)) += (LOCAL*3/2+LOCAL:1*3/2+LOCAL:4*1/2) * GET_하모나이저출력() / 200
		;명중
		BASE:ARG:(GET_BATTLESTATUS(1)) += (LOCAL+LOCAL:5*3/2+LOCAL:6*1/2) * GET_하모나이저출력() / 200
		;방어
		BASE:ARG:(GET_BATTLESTATUS(2)) += (LOCAL+LOCAL:4*2+(LOCAL:1)/2) * GET_하모나이저출력() / 200
		;회피
		BASE:ARG:(GET_BATTLESTATUS(3)) += (LOCAL+LOCAL:5*3/2+LOCAL:6*1/2) * GET_하모나이저출력() / 200
		;마법위력
		BASE:ARG:(GET_BATTLESTATUS(4)) += (LOCAL*3/2+LOCAL:3*3/2+LOCAL:2*1/2) * GET_하모나이저출력() / 200
		;마법효과
		BASE:ARG:(GET_BATTLESTATUS(5)) += (LOCAL+LOCAL:2+LOCAL:6/2+LOCAL:3/2) * GET_하모나이저출력() / 200
		;총공격
		BASE:ARG:총공격 += (LOCAL + LOCAL:2/2 + LOCAL:5/2) * GET_하모나이저출력() / 200
		BASE:ARG:총명중 += (LOCAL+LOCAL:5+LOCAL:6+LOCAL:2) * GET_하모나이저출력() / 200
		;テスト用
		;PRINTVW GET_하모나이저출력()
		;도구명중
		BASE:ARG:도구명중 += (LOCAL*2+MAX(LOCAL:5, 3+LOCAL/4)*5/2+MAX(LOCAL:3, 3+LOCAL/4)) * GET_하모나이저출력() / 200
		;道具威힘
		BASE:ARG:도구위력 += (LOCAL*2+MAX(LOCAL:2, 3+LOCAL/4)*5/2+MAX(LOCAL:6, 3+LOCAL/4)) * GET_하모나이저출력() / 200
		
	ENDIF
	
	;---- EDIT 072 ADD EMD -------------------------
	FOR LCOUNT, 0, 6
		MAXBASE:ARG:(GET_BATTLESTATUS(LCOUNT)) = BASE:ARG:(GET_BATTLESTATUS(LCOUNT))
	NEXT

	;---- EDIT 055 ADD START -------------------------
	IF EXTRA강화(11)
		;악마専用：함락보너스강화パッシブ스킬の適用
		SIF HAVE_SKILL(ARG,[[스킬:함락의악마]]) > 0
			CALL 陥落の悪魔適用(ARG)
		;악마専用：조건付き火힘上昇パッシブ스킬の適用
		SIF HAVE_SKILL(ARG,[[스킬:내추럴본]]) > 0
			CALL ナチュラルボーン適用(ARG)
		;악마専用：HP減少制約付き火힘上昇パッシブ스킬の適用
		SIF HAVE_SKILL(ARG,[[스킬:오토퍼지]]) > 0
			CALL オートファジー適用(ARG)
	ENDIF
	;---- EDIT 055 ADD END -------------------------

	;---- EDIT 072 DEL START -------------------------
	;도구명중ㆍ道具威힘の基礎値算出処理はハーモナイザー適応前（070 ADD STAR　より前）に移動
	;---- EDIT 072 DEL END -------------------------

	;장비지식스킬持ちならここで処理
	IF SKILL_EQUIPTHEORY_IS_HAVE_SKILL(ARG)
		;---- EDIT 067 ADD START -------------------------
		;---- EDIT 068 ADD START -------------------------
		;총명중
;		IF TALENT:ARG:건슬링거 == 1
			BASE:ARG:총명중 = (LOCAL+LOCAL:5+LOCAL:6+LOCAL:2) + CFLAG:ARG:총명중보정
;		ELSE
;			BASE:ARG:총명중 = (LOCAL+LOCAL:5/2+LOCAL:6/2+LOCAL:2/2) + CFLAG:ARG:총명중보정
;		ENDIF
		;총공격
;		IF TALENT:ARG:건슬링거 == 1
			BASE:ARG:총공격 = (LOCAL + LOCAL:2/2 + LOCAL:5/2) + CFLAG:ARG:총공격보정
;		ELSE
;			BASE:ARG:총공격 = (LOCAL/2 + LOCAL:2/4 + LOCAL:5/4) + CFLAG:ARG:총공격보정
;		ENDIF
	;---- EDIT 067 ADD END -------------------------
	;---- EDIT 068 ADD END -------------------------
		;LVが80を超えている場合、장비部分に相当する보정を추가で与える
		IF BASE:ARG:LV > 80
			;장비効果설정が通常の場合影響あり
			IF BATTLE_SETTING_IS_EQUIPTHEORY() == 0
				;공격
				BASE:ARG:(GET_BATTLESTATUS(0)) += (BASE:ARG:LV - 80) * 9 / 4
				;명중
				BASE:ARG:(GET_BATTLESTATUS(1)) += (BASE:ARG:LV - 80) * 7 / 4
				;방어
				BASE:ARG:(GET_BATTLESTATUS(2)) += (BASE:ARG:LV - 80) * 11 / 4
				;회피
				BASE:ARG:(GET_BATTLESTATUS(3)) += (BASE:ARG:LV - 80) * 7 / 4
				;마법위력
				BASE:ARG:(GET_BATTLESTATUS(4)) += (BASE:ARG:LV - 80) * 9 / 4
				;마법효과
				BASE:ARG:(GET_BATTLESTATUS(5)) +=(BASE:ARG:LV - 80) * 7 / 4
				;도구명중
				BASE:ARG:도구명중 += (BASE:ARG:LV - 80) * 7 / 4
				;도구위력
				BASE:ARG:도구위력 += (BASE:ARG:LV - 80) * 9 / 4
			ENDIF
			;총명중
			BASE:ARG:총명중 += (BASE:ARG:LV - 80) * 7 / 4
			;총공격
			BASE:ARG:총공격 += (BASE:ARG:LV - 80) * 9 / 4
		ENDIF

		;장비品の보정
		;장비効果설정が通常
		IF BATTLE_SETTING_IS_EQUIPTHEORY() == 0
			FOR LCOUNT,0,FLAG:전투능력수
				LEQUIP_FIXED_VALUE = 0
				FOR LCOUNT:1,0,7
					IF 마정장비(EQUIP:ARG:(GET_EQUIP(LCOUNT:1)))
						CALLFORM 전투능력수정_마정장비,LCOUNT,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
					ELSE
						CALLFORM 전투능력수정_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},LCOUNT,ARG
					ENDIF
					LEQUIP_FIXED_VALUE += RESULT
				NEXT
				MAXBASE:ARG:(GET_BATTLESTATUS(LCOUNT)) = BASE:ARG:(GET_BATTLESTATUS(LCOUNT)) + SKILL_EQUIPTHEORY_EQUIP_STATUS(ARG, LEQUIP_FIXED_VALUE)
			NEXT

		;장비効果설정が변경あり
		;---- EDIT 024 DEL START -------------------------
		;ELSE
		;	FOR LCOUNT,FLAG:전투능력수-2,FLAG:전투능력수
		;		LEQUIP_FIXED_VALUE = 0
		;		FOR LCOUNT:1,0,7
		;			IF 마정장비(EQUIP:ARG:(GET_EQUIP(LCOUNT:1)))
		;				CALLFORM 전투능력수정_마정장비,LCOUNT,EQUIP:ARG:(GET_EQUIP(LCOUNT:1)) - 2450 -450*LCOUNT:1
		;			ELSE
		;				CALLFORM 전투능력수정_{EQUIP:ARG:(GET_EQUIP(LCOUNT:1))},LCOUNT,ARG
		;			ENDIF
		;			LEQUIP_FIXED_VALUE += RESULT
		;		NEXT
		;		MAXBASE:ARG:(GET_BATTLESTATUS(LCOUNT)) = BASE:ARG:(GET_BATTLESTATUS(LCOUNT)) + SKILL_EQUIPTHEORY_EQUIP_STATUS(ARG, LEQUIP_FIXED_VALUE)
		;	NEXT
		;---- EDIT 024 DEL END ---------------------------
		ENDIF

		;검장비の処理
		IF 마정장비(EQUIP:ARG:검)
			CALLFORM 공격상성_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:공격상성 = RESULT
			CALLFORM 사거리_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:사거리 = RESULT > 0 ? RESULT # 1
			CALLFORM 최저공격횟수_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:최저공격횟수 = RESULT
			CALLFORM 최대공격횟수_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:최대공격횟수 = RESULT
			CALLFORM 공격범위_마정장비,EQUIP:ARG:검-2450
			ABL:ARG:공격범위 = RESULT > 0 ? RESULT # 1
			TRYCCALLFORM 추가효과_마정장비,EQUIP:ARG:검-2450
				ABL:ARG:추가효과 = RESULT
				CALLFORM 추가효과상성_마정장비,EQUIP:ARG:검-2450
				ABL:ARG:추가효과상성 = RESULT
				CALLFORM 추가효과명중률_마정장비,EQUIP:ARG:검-2450
				ABL:ARG:추가효과명중률 = RESULT
				CALLFORM 추가효과최대명중률_마정장비,EQUIP:ARG:검-2450
				ABL:ARG:추가효과최대명중률 = RESULT
			CATCH
				ABL:ARG:추가효과 = 0
				ABL:ARG:추가효과상성 = 0
				ABL:ARG:추가효과명중률 = 0
				ABL:ARG:추가효과최대명중률 = 0
			ENDCATCH
		ELSE
			CALLFORM 공격상성_{EQUIP:ARG:검},ARG
			ABL:ARG:공격상성 = RESULT
			CALLFORM 사거리_{EQUIP:ARG:검},ARG
			ABL:ARG:사거리 = RESULT > 0 ? RESULT # 1
			CALLFORM 최저공격횟수_{EQUIP:ARG:검},ARG
			ABL:ARG:최저공격횟수 = RESULT
			CALLFORM 최대공격횟수_{EQUIP:ARG:검},ARG
			ABL:ARG:최대공격횟수 = RESULT
			CALLFORM 공격범위_{EQUIP:ARG:검},ARG
			ABL:ARG:공격범위 = RESULT > 0 ? RESULT # 1
			TRYCCALLFORM 추가효과_{EQUIP:ARG:검},ARG
				ABL:ARG:추가효과 = RESULT
				CALLFORM 추가효과상성_{EQUIP:ARG:검},ARG
				ABL:ARG:추가효과상성 = RESULT
				CALLFORM 추가효과명중률_{EQUIP:ARG:검},ARG
				ABL:ARG:추가효과명중률 = RESULT
				CALLFORM 추가효과최대명중률_{EQUIP:ARG:검},ARG
				ABL:ARG:추가효과최대명중률 = RESULT
			CATCH
				ABL:ARG:추가효과 = 0
				ABL:ARG:추가효과상성 = 0
				ABL:ARG:추가효과명중률 = 0
				ABL:ARG:추가효과최대명중률 = 0
			ENDCATCH
		ENDIF

		;총장비の処理
		IF EQUIP:ARG:총 > 0
			IF 마정장비(EQUIP:ARG:총)
				CALLFORM 총명중_마정장비,EQUIP:ARG:총-2900
				MAXBASE:ARG:총명중 = BASE:ARG:총명중 + SKILL_EQUIPTHEORY_EQUIP_HIT(ARG, RESULT)
				CALLFORM 총공격_마정장비,EQUIP:ARG:총-2900
				MAXBASE:ARG:총공격 = BASE:ARG:총공격 + SKILL_EQUIPTHEORY_EQUIP_STATUS(ARG, RESULT)
			ELSE
				CALLFORM 총명중_{EQUIP:ARG:총},ARG
				MAXBASE:ARG:총명중 = BASE:ARG:총명중 + SKILL_EQUIPTHEORY_EQUIP_HIT(ARG, RESULT)
				CALLFORM 총공격_{EQUIP:ARG:총},ARG
				MAXBASE:ARG:총공격 = BASE:ARG:총공격 + SKILL_EQUIPTHEORY_EQUIP_STATUS(ARG, RESULT)
			ENDIF

		ELSE
			MAXBASE:ARG:총명중 = 0
			MAXBASE:ARG:총공격 = 0
		ENDIF
	ENDIF

	;장비보정を作る필요がでるまではここで決め打ち
	MAXBASE:ARG:도구명중 = BASE:ARG:도구명중
	MAXBASE:ARG:도구위력 = BASE:ARG:도구위력
	;---- EDIT 054 ADD END -------------------------


	;조교効果をここに記述ㆍ전투能力
	IF ARG != MASTER && CFLAG:ARG:PT플래그 > 0
		;現状処理なし
	ENDIF

	;相性関係
	FOR LOCAL:1,0,FLAG:상성수 +1
		;변신하고 있지 않다
		IF CFLAG:ARG:악마변신 == 0
			MAXBASE:ARG:GET_TYPE(LOCAL:1) = BASE:ARG:GET_TYPE(LOCAL:1)
			SIF CFLAG:ARG:변경상성1 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:변경상성치1
			SIF CFLAG:ARG:추가변경상성1 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치1
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD START ----
			SIF CFLAG:ARG:추가변경상성2 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치2
			SIF CFLAG:ARG:추가변경상성3 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치3
			SIF CFLAG:ARG:추가변경상성4 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치4
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD END   ----
			;플러그인（악세서리）を見る
			CALLFORM 방어상성_{EQUIP:ARG:악세서리},LOCAL:1,ARG
			IF RESULT != 100
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = RESULT
			ENDIF
		ELSEIF CFLAG:ARG:링크악마 > 0 && FINDCHARA_ID(CFLAG:ARG:링크악마) > 0
			;변신先악마が居れば、その악마の相性をコピー
			MAXBASE:ARG:GET_TYPE(LOCAL:1) = BASE:FINDCHARA_ID(CFLAG:ARG:링크악마):GET_TYPE(LOCAL:1)
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):변경상성1 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):변경상성치1
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성1 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치1
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD START ----
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성2 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치2
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성3 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치3
			SIF CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성4 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:FINDCHARA_ID(CFLAG:ARG:링크악마):추가변경상성치4
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD END   ----
		ELSE
			;디폴트악마の場合は相性コピー＋相性변경は自分のを사용する
			MAXBASE:ARG:GET_TYPE(LOCAL:1) = CSVBASE((CFLAG:ARG:초기링크악마), GETNUM(BASE , GET_TYPE(LOCAL:1)),0)
			SIF CFLAG:ARG:변경상성1 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:변경상성치1
			SIF CFLAG:ARG:추가변경상성1 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치1
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD START ----
			SIF CFLAG:ARG:추가변경상성2 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치2
			SIF CFLAG:ARG:추가변경상성3 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치3
			SIF CFLAG:ARG:추가변경상성4 == LOCAL:1+1
				MAXBASE:ARG:GET_TYPE(LOCAL:1) = CFLAG:ARG:추가변경상성치4
;---- EDIT 042 함락내역により내성강화を更に추가で可能に ADD END   ----
		ENDIF
	NEXT

	FOR LOCAL:1,0,FLAG:상태이상수
		IF CFLAG:ARG:악마변신 == 0
			MAXBASE:ARG:GET_STATE(LOCAL:1) = BASE:ARG:GET_STATE(LOCAL:1)
			;プラグイン（악세서리）を見る
			RESULT = 0
			TRYCALLFORM BS내성_{EQUIP:ARG:악세서리},LOCAL:1,ARG
			IF RESULT < 0
				MAXBASE:ARG:GET_STATE(LOCAL:1) = RESULT
			ENDIF
			;---- EDIT 065 ADD START  -------------------------
			SIF HAVE_PU_SKILL(ARG,"オルトリアクター")
				MAXBASE:ARG:GET_STATE(LOCAL:1) = -20
			;---- EDIT 065 ADD END  -------------------------
		ELSEIF FINDCHARA_ID(CFLAG:ARG:링크악마) > 0
			;변신先악마が居れば、その악마の相性をコピー
			MAXBASE:ARG:GET_STATE(LOCAL:1) = BASE:FINDCHARA_ID(CFLAG:ARG:링크악마):GET_STATE(LOCAL:1)
		ELSE
			;디폴트악마の場合は相性コピー＋相性변경は自分のを사용する
			MAXBASE:ARG:GET_STATE(LOCAL:1) = CSVBASE((CFLAG:ARG:초기링크악마), GETNUM(BASE , GET_STATE(LOCAL:1)),0)
		ENDIF
	NEXT

	IF CFLAG:ARG:악마변신
		IF FINDCHARA_ID(CFLAG:ARG:링크악마) > 0
			ABL:ARG:공격상성 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):공격상성
			ABL:ARG:사거리 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):사거리 > 0 ? ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):사거리 # 1
			ABL:ARG:최저공격횟수 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):최저공격횟수
			ABL:ARG:최대공격횟수 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):최대공격횟수
			ABL:ARG:공격범위 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):공격범위 > 0 ? ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):공격범위 # 1
			ABL:ARG:추가효과 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):추가효과
			ABL:ARG:추가효과상성 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):추가효과상성
			ABL:ARG:추가효과명중률 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):추가효과명중률
			ABL:ARG:추가효과최대명중률 = ABL:FINDCHARA_ID(CFLAG:ARG:링크악마):추가효과최대명중률
		ELSE
			ABL:ARG:공격상성 = ABL:ARG:초기링크악마공격상성
			ABL:ARG:사거리 = ABL:ARG:초기링크악마사거리 > 0 ? ABL:ARG:초기링크악마사거리 # 1
			ABL:ARG:최저공격횟수 = ABL:ARG:초기링크악마최저공격횟수
			ABL:ARG:최대공격횟수 = ABL:ARG:초기링크악마최대공격횟수
			ABL:ARG:공격범위 = ABL:ARG:초기링크악마공격범위 > 0 ? ABL:ARG:초기링크악마공격범위 # 1
			ABL:ARG:추가효과 = ABL:ARG:초기링크악마추가효과
			ABL:ARG:추가효과상성 = ABL:ARG:초기링크악마추가효과상성
			ABL:ARG:추가효과명중률 = ABL:ARG:초기링크악마추가효과명중률
			ABL:ARG:추가효과최대명중률 = ABL:ARG:초기링크악마추가효과최대명중률
		ENDIF
	ENDIF

	;NEXT経験値
	MAXBASE:ARG:ＥＸＰ  = 5*(BASE:ARG:LV)*(BASE:ARG:LV+1)*(BASE:ARG:LV+2)/3
	SIF ABL:ARG:종족 != 0 && !함락(ARG)
		TIMES MAXBASE:ARG:ＥＸＰ , 1.25
	;ＭＡＧキャパシティ
	IF ARG == MASTER
		;--- MOD 035 START---
		;片キンフラグあり
		IF GETBIT(이벤트플래그:93:11, 60)
			MAXBASE:ARG:ＭＡＧ  = (15)*(LOCAL)*(LOCAL+1)*(LOCAL+2)
		;なし（通常）
		ELSE
			MAXBASE:ARG:ＭＡＧ  = (75)*(LOCAL)*(LOCAL+1)*(LOCAL+2)
		ENDIF
		;--- MOD 035 END---
	ELSE
		MAXBASE:ARG:ＭＡＧ  = (15+함락(ARG)*3)*(MAXBASE:ARG:LV)*(MAXBASE:ARG:LV+1)*(MAXBASE:ARG:LV+2)
		SIF ABL:ARG:종족 == 45
			MAXBASE:ARG:ＭＡＧ *= 5
	ENDIF
	;抗体ポイント
	IF CSVBASE(NO:ARG,GETNUM(BASE,"CP"),0) != 0 && CFLAG:ARG:PT플래그 > 0
		LOCAL:1 = 15
		FOR LOCAL,0,FLAG:상성수 +1
			SELECTCASE MAXBASE:ARG:(GET_TYPE(LOCAL))
				CASE 999
					LOCAL:1 += 55
				CASE IS < 0
					LOCAL:1 += 55
				CASE 0
					LOCAL:1 += 40
				CASE IS > 199
					LOCAL:1 -= 25
				CASE IS > 100
					LOCAL:1 -= 15
				CASE IS <= 50
					LOCAL:1 += 25
				CASE IS < 100
					LOCAL:1 += 15
			ENDSELECT
		NEXT
		BASE:ARG:CP = MAX(1,LOCAL:1/2) + CFLAG:ARG:ＣＰ보정
		TRYCCALLFORM 증가CP_{EQUIP:ARG:악세서리}
			RESULT += 100
		CATCH
			RESULT = 100
		ENDCATCH
		MAXBASE:ARG:CP = MAX(1,BASE:ARG:CP * MAXBASE:ARG:LV / 50 * (100-MIN(10000,BASE:ARG:충성도)*50/10000) / 100 * RESULT / 100)
		MAXBASE:ARG:￥ = MAX(1,BASE:ARG:CP * MAXBASE:ARG:LV * (100-MIN(5000,BASE:ARG:충성도)*90/5000) / 100)
	ELSE
		MAXBASE:ARG:CP = BASE:ARG:CP * MAXBASE:ARG:LV / 50
		MAXBASE:ARG:￥ = 0
	ENDIF
ENDIF

;主人の場合、속성が変動する。
;主人以外も変化するようにしてみる
;IF ARG == MASTER
	;LD
SELECTCASE CFLAG:ARG:선악치
	CASE IS > 170
		ABL:ARG:속성LD = 1
	CASE IS > 84
		ABL:ARG:속성LD = 2
	CASEELSE
		ABL:ARG:속성LD = 3
ENDSELECT
SELECTCASE CFLAG:ARG:질혼치
	CASE IS > 170
		ABL:ARG:속성LC = 1
	CASE IS > 84
		ABL:ARG:속성LC = 2
	CASEELSE
		ABL:ARG:속성LC = 3
ENDSELECT
;ENDIF

;---- EDIT 028 MOD START -------------------------
;蠅상태で내성변경
IF GET_STATE(CFLAG:ARG:상태이상) == "FLY"
	FOR LCOUNT,0,FLAG:상성수 + 1
		MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 100
		SIF LCOUNT == 4 || LCOUNT == 7 || LCOUNT == 14 || LCOUNT == 16
			MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 400
	NEXT
ENDIF
;---- EDIT 028 MOD END ---------------------------
;분노의○○を사용すると弱点が増える
FOR LCOUNT,0,FLAG:상성수 + 1
	SIF GETBIT(CFLAG:ARG:분노약점부여,LCOUNT)
		MAXBASE:ARG:(GET_TYPE(LCOUNT)) = 150
NEXT
;아이템사용関係
;---- EDIT 054 MOD START ---------------------------
LOCAL = MIN(HAVE_SKILL_OVERLAP(ARG,[[스킬:아이템숙련]]),(3-!계약(ARG)))
CFLAG:ARG:아이템사용능력 = TALENT:ARG:도구지식 + TALENT:ARG:아이템숙련 + LOCAL
CFLAG:ARG:아이템사용강화 = TALENT:ARG:아이템숙련 * 2 + MIN(LOCAL, 2)
;---- EDIT 054 MOD END ---------------------------

;임신している場合、一部の能力にボーナス？
;現状では최대ＨＰとＭＰが2割上昇
IF TALENT:ARG:임신
	;ふたごちゃんパッチオンの場合：5人以上のわりとヤバい임신数だとさすがに스테이터스が下がる
	IF FLAG:쌍둥이플래그 > 0 && CFLAG:ARG:이번수태인수 > 4
		TIMES MAXBASE:ARG:ＨＰ , 0.80
		TIMES MAXBASE:ARG:ＭＰ , 0.80
	ELSEIF FLAG:쌍둥이플래그 > 0 && CFLAG:ARG:이번수태인수 > 1
		;2～4だと보정無し
	ELSE
		TIMES MAXBASE:ARG:ＨＰ , 1.20
		TIMES MAXBASE:ARG:ＭＰ , 1.20
	ENDIF
ENDIF
;붕괴している場合、ＨＰとＭＰが7割に
IF TALENT:ARG:붕괴
	TIMES MAXBASE:ARG:ＨＰ , 0.70
	TIMES MAXBASE:ARG:ＭＰ , 0.70
ENDIF

;ガチャモードがONで、아군なら{(종족악마and全書소환불가でない)or(조마である)}andガチャ素質が無い　なら色々반감
IF FLAG:악마가챠모드 > 1 && CFLAG:ARG:PT플래그 > 0
	IF ((ABL:ARG:종족 > 0 && ABL:ARG:종족 < 45 && CFLAG:ARG:전서소환불가 == 0) || (ABL:ARG:종족 == 45)) && TALENT:ARG:ガチャ < 1
		TIMES MAXBASE:ARG:ＨＰ , 0.50
		TIMES MAXBASE:ARG:ＭＰ , 0.50
		TIMES BASE:ARG:공격 , 0.50
		TIMES BASE:ARG:명중 , 0.50
		TIMES BASE:ARG:방어 , 0.50
		TIMES BASE:ARG:회피 , 0.50
		TIMES BASE:ARG:마법위력 , 0.50
		TIMES BASE:ARG:마법효과 , 0.50
		TIMES BASE:ARG:총공격 , 0.50
		TIMES BASE:ARG:총명중 , 0.50
	ENDIF
ENDIF

SIF MAXBASE:ARG:ＭＡＧ < 1
	MAXBASE:ARG:ＭＡＧ = 1

;페르소나구사자の場合、스테이터스の変動にあわせて現HP/MPも変動する
IF TALENT:ARG:페르소나구사자
	IF MIN(BASE:ARG:ＨＰ,LOCAL:7) != 0
		BASE:ARG:ＨＰ *= MAXBASE:ARG:ＨＰ
		BASE:ARG:ＨＰ /= LOCAL:7
	ENDIF
	IF MIN(BASE:ARG:ＭＰ,LOCAL:8) != 0
		BASE:ARG:ＭＰ *= MAXBASE:ARG:ＭＰ
		BASE:ARG:ＭＰ /= LOCAL:8
	ENDIF
ENDIF
;=================================================================
;仲魔として加入
;ARG:NO
;ARG:1 충성도
;ARG:2 이벤트플래그(通常の他-1のとき、合体時の一時표시に作成された악마であることを示す)
;ARG:3 마코토(페르소나5):全書利用時に一時的に仲魔に加える処理であることを示す。소지数警告や加入キャンセルを無効にする
;ARG:4 마코토(페르소나5):加入後、인간化する場合に사용。これ使わないと、容量MAX時に加入させた時、인간なのにストレージにいる扱いになります
;ARG:5 마코토(페르소나5):加入後、Lvを任意に설정する場合に사용。指定しない場合は通常の초기LVが適応されます
;RESULT 마코토(페르소나5):キャラが作成されたことを示す。偽:既に同一キャラがいた場合や人数制限にかかった場合などでキャラが作成されなかった場合
;RRSULT:1 作成したキャラの登録番号を返す
;
;★샘플です。わかります★
;CALL ADD_NEW_COMPANION,[[캐릭터:기린]],충성도,이벤트플래그2,一時的に仲魔に3,인간化4,Lv指定5
;CALL ADD_NEW_COMPANION,[[캐릭터:기린]],114514,0,0,0,99
;충성도114514、이벤트가입、全書표시用、特別な인간化なし、LV99で加入
;=================================================================
;---- EDIT 048 ADD START ----
;@ADD_NEW_COMPANION, ARG, ARG:1, ARG:2 = 0, ARG:3 = 0, ARG:4 = 0
@ADD_NEW_COMPANION, ARG, ARG:1, ARG:2 = 0, ARG:3 = 0, ARG:4 = 0, ARG:5 = 0
#DIMS 이상경험명 , 64
#DIMS 초기호감도치 , 60
#DIM LCOUNT
#DIM 레벨상승치,1
#DIM ボーナスポイント,1
#DIM 레벨업횟수
#DIM 마리아주성립
;인간or메어리かつ既に仲魔に居るならスルー
;랜덤キャラはスルーしない
;引継ぎ당신または랜덤な다크서머너(Noが4998)もスルーしない
;IF (ARG < 4901 || ARG > 4910) && (ARG != 0 && ARG != 4999)
IF (ARG < 4901 || ARG > 4912) && (ARG != 4998)
	IF (CSVABL(ARG,GETNUM(ABL,"종족"),0) == 0 || ARG == 4509) && GETCHARA(ARG) > -1
		CFLAG:GETCHARA(ARG):이자리에없는플래그 = 0
		CALLF FINDCHARA_B(ARG)
		RETURN 0
	ELSEIF ARG:2 > 0 && FINDCHARA_B(ARG,ARG:2) >= 0
		;RESULT:1には既に番号が返されてるはず
		RETURN 0
	ELSEIF CSVCFLAG(ARG,GETNUM(CFLAG,"１체만"),0) > 0 && FLAG:SHOP커맨드 != [[SHOP:사교의관]] && FINDCHARA_B(ARG,ARG:2) >= 0
		;RESULT:1には既に番号が返されてるはず
		RETURN 0
	ENDIF
ENDIF
FOR LOCAL:2, 0, MAX_PLAYER_CHARA
	SIF !CMATCH(CFLAG:캐릭터고유번호, LOCAL:2)
		BREAK
	IF !ARG:3
		IF LOCAL:2 == MAX_PLAYER_CHARA-5
			PRINTFORMW ※소지하고 있는 캐릭터가 {MAX_PLAYER_CHARA-5}체에 도달했습니다
			PRINTFORMW 　{MAX_PLAYER_CHARA}체가 넘으면、가입처리가 취소되므로 주의해주세요
		ENDIF
		IF LOCAL:2 == MAX_PLAYER_CHARA-1
			PRINTW 캐릭터수가 한계에 도달했습니다
			PRINTW 캐릭터의 가입처리를 취소합니다
			RETURN 0
		ENDIF
	ENDIF
NEXT
;抜けた段階で+1されるので調整
LOCAL:2 -= 1
;	;RESULT配列に使われてる固有の番号を全部書きだす
;	VARSET RESULT, -1
;	FOR LOCAL:2, 0 , CHARANUM
;		SIF CFLAG:(LOCAL:2):캐릭터고유번호 > 0
;			RESULT:(CFLAG:(LOCAL:2):캐릭터고유번호) = LOCAL:2
;	NEXT
;	;主人は0固定のはずなので、0にする
;	RESULT = 0
;	;書きだしたリストから、開いている一番若い番号を探しす
;	FOR LOCAL:2, 0 , 201
;		SIF RESULT:(LOCAL:2) >= 0
;			CONTINUE
;		BREAK
;	NEXT
;	IF LOCAL:2 == 201
;		PRINTW キャラクター数が上限に達しています
;		PRINTW キャラクター加入処理をキャンセルします
;		RETURN 0
;	ELSEIF LOCAL:2 >= 195
;		PRINTW ※소지しているキャラが195体に達しています
;		PRINTW 　200体を超えると、加入処理がキャンセルされますので注意してください
;	ENDIF
LOCAL = CHARANUM
LOCAL:1 = TARGET
ADDCHARA ARG
;---- EDIT 034 MOD START -------------------------
SIF ARG:4
	ABL:LOCAL:종족 = 0
;---- EDIT 034 MOD END -------------------------
TARGET = LOCAL:1
CFLAG:LOCAL:PT플래그 = 1
CFLAG:LOCAL:캐릭터고유번호 = LOCAL:2
;一応RESULTを破壊しておく
VARSET RESULT
;위험일を설정する
ENCODETOUNI %NAME:LOCAL%
LOCAL:1 = RESULT+1
IF ABL:LOCAL:종족 == 0 || ABL:LOCAL:종족 == 45
	CFLAG:LOCAL:위험일 = (SUMARRAY(RESULT , 1 , LOCAL:1) + DAY*4 + TIME)%16
ELSE
	CFLAG:LOCAL:위험일 = (SUMARRAY(RESULT , 1 , LOCAL:1) + DAY*4 + TIME)%15
	SIF CFLAG:LOCAL:위험일 >= 8
		CFLAG:LOCAL:위험일 += 1
ENDIF

CALL 자궁최대용량초기설정,(LOCAL)

VARSET RESULT
CFLAG:LOCAL:조교메뉴표시설정 = GLOBAL:9
;経験値、マグネタイト、충성도の초기화、仲魔フラグ
LOCAL:2 = MAXBASE:LOCAL:(GET_BASESTATUS(0))
BASE:LOCAL:ＥＸＰ = 5*(LOCAL:2-1)*(LOCAL:2+1)*(LOCAL:2)/3
SIF ABL:LOCAL:종족 != 0
	TIMES BASE:LOCAL:ＥＸＰ , 1.25

SIF ABL:LOCAL:종족 == 45
	BASE:LOCAL:ＥＸＰ = 0
BASE:LOCAL:ＭＡＧ = 0
BASE:LOCAL:충성도 = ARG:1
MAXBASE:LOCAL:충성도 = 0
;ＭＡＧ자기소비フラグをＯＦＦ
CFLAG:LOCAL:ＭＡＧ자기소비 = 0
;인간ならば전투참가不能
SIF (ABL:LOCAL:종족 > 45 || ABL:LOCAL:종족 == 0) && LOCAL != MASTER
	CFLAG:LOCAL:전투참가불가능 = 1
;선악치ㆍ질혼치未설정の場合、설정
CALL ADJUST_CHARA_ALI,LOCAL
;적専用스킬を削除
FOR LOCAL:3,1,FLAG:스킬수+1
	LOCALS = 스킬{LOCAL:3}
	TRYCCALLFORM 적전용_{ABL:LOCAL:LOCALS}
		SIF RESULT == 1
			ABL:LOCAL:LOCALS = 0
	CATCH
	ENDCATCH
NEXT

;던전や의뢰ごとの修正
SELECTCASE FLAG:SHOP커맨드
	CASE [[SHOP:탐색]]
		TRYCALLFORM SET_COMPANION_DUNGEON_{FLAG:현던전} , LOCAL
	CASE [[SHOP:콜로세움참가]]
		TRYCALLFORM SET_COMPANION_COLOSSEUM_{FLAG:진행중콜로세움} , LOCAL
	CASE [[SHOP:이벤트]]
		TRYCALLFORM SET_COMPANION_EVENT_{FLAG:진행중이벤트} , LOCAL
	CASE [[SHOP:의뢰청부]]
		TRYCALLFORM SET_COMPANION_REQUEST_{FLAG:진행중의뢰} , LOCAL
ENDSELECT

;착의状況をセット
LOCAL:1 = 1
FOR LCOUNT, 0, 12
	CFLAG:LOCAL:(60+LCOUNT) = CFLAG:LOCAL:GET_CLOTHESNAME(LCOUNT)
	SIF CFLAG:LOCAL:GET_CLOTHESNAME(LCOUNT)
		CFLAG:LOCAL:23 |= LOCAL:1
	LOCAL:1 *= 2
NEXT
CFLAG:LOCAL:24 = CFLAG:LOCAL:23

CFLAG:LOCAL:피링크플래그 = -1
CFLAG:LOCAL:링크악마 = -1

;초기マスター만트라
IF TALENT:LOCAL:식노
	FOR LOCAL:1, 1, 9
		SIF ABL:LOCAL:@"스킬{LOCAL:1}"
			CDFLAG:LOCAL:만트라:(ABL:LOCAL:@"스킬{LOCAL:1}") = 10000
		ABL:LOCAL:@"스킬{LOCAL:1}" = 0
	NEXT
ENDIF

;초기레벨を保存
CFLAG:LOCAL:초기LV = BASE:LOCAL:LV

;PRINTFORMW ナオヤ「刮눈するがいい。これがバランス調整を放棄した바ㆍ벨	に搭載しようと思ったが、ナオヤ兄貴ウレションさせてもしょうがないので諦めて新ソフトにしたなんかすげー힘だっ！！」
;포지션1-6に存在する아군全員の上位함락소질を확인する

;IF FLAG:SHOP커맨드 == [[SHOP:탐색]]
;	FOR LOCAL:2, 1, 7
;		;空き포지션は勘定外
;		SIF POS(LOCAL:2) < 0
;			CONTINUE
;		IF TALENT:(POS(LOCAL:2)):친애 || TALENT:(POS(LOCAL:2)):창부 || TALENT:(POS(LOCAL:2)):예속 || TALENT:(POS(LOCAL:2)):동료
;			IF BASE:(POS(LOCAL:2)):LV > 마리아주성립
;				;上位함락で最もLVの高い子のＬＶを격납
;				마리아주성립 = BASE:(POS(LOCAL:2)):LV
;			ENDIF
;		ENDIF
;	NEXT
;ELSE
;	FOR LOCAL:2, 0, CHARANUM
;		SIF CFLAG:(LOCAL:2):이자리에없는플래그 == 1
;			CONTINUE
;		IF TALENT:(LOCAL:2):친애 || TALENT:(LOCAL:2):창부 || TALENT:(LOCAL:2):예속 || TALENT:(LOCAL:2):동료
;			IF BASE:(LOCAL:2):LV > 마리아주성립
;				;上位함락で最もLVの高い子のＬＶを격납
;				마리아주성립 = BASE:(LOCAL:2):LV
;			ENDIF
;		ENDIF
;	NEXT
;ENDIF

;IF ARG:5 > 0 || (ARG:5 == 0 && EQUIP:MASTER:마리アージュ == 1 && 마리아주성립 > 0)
;	;;인간이외は마리アージュをイン스톨していると（당신+ＰＴか전체の中でもっともLVの高い上位함락者の平均LV）で加入される
;	SIF ARG:5 == 0 && EQUIP:MASTER:마리アージュ == 1 && 마리아주성립 > 0 && ABL:LOCAL:종족 != 0 && ABL:ARG:종족 != 36
;		ARG:5 = ((BASE:MASTER:LV + 마리아주성립) / 2)
;	ARRAYREMOVE ボーナスポイント,0,0
;	IF BASE:LOCAL:LV < ARG:5
;		;もう用済みなので元Lvは殺す
;		BASE:LOCAL:LV = ARG:5
;		
;		;能力値ボーナスポイント
;		FOR 레벨상승치, BASE:LOCAL:LV, ARG:5
;			SIF (레벨상승치) % 2 == 1
;				ボーナスポイント += 1
;			ボーナスポイント += 1
;		NEXT
;	
;		PRINTFORMW %NAME:LOCAL%の스테이터스を振り直してください。
;	
;		;레벨업に伴う能力値ボーナス
;		CALL STATUS_BONUS(LOCAL,ボーナスポイント)
;	
;		;元々비전투원なので장비できないはずなのでコメントアウト
;		;인스톨소프트ㆍ악세서리等の特殊ボーナス
;		CALL LVUP_BOOSTER(LOCAL,ボーナスポイント)
;		CALL LVUP_BOOSTER_MAGATAMA(LOCAL,ボーナスポイント)
;		
;		;스킬を깨달음え直していただきます！！
;		CALLFORM EVENT_LEVELUP,LOCAL
;		TRYCALLFORM EVENT_LEVELUP_{NO:LOCAL}
;		
;		;스테이터스再計算の時間です！！
;		CALL SYNC_STATUS,LOCAL
;		;ついでに全회복しておきましょうか！！
;		CALL HEALTH_CHARA,LOCAL
;	ENDIF
;ENDIF
;;---- EDIT 048 ADD END   ----

CFLAG:LOCAL:이벤트가입 = ARG:2

;초기이상경험分を加算
IF CSTR:LOCAL:초기이상경험 != ""
	VARSET 이상경험명
	SPLIT CSTR:LOCAL:초기이상경험 , "_" , 이상경험명
	FOR LOCAL:1 , 0 , STRCOUNT(CSTR:LOCAL:초기이상경험 , "_") + 1
		SETBIT CFLAG:LOCAL:이상경험기록 , NUM_ABNORMAL_EXP(이상경험명:(LOCAL:1))
		EXP:LOCAL:이상경험 += RANK_ABNORMAL_EXP(이상경험명:(LOCAL:1))
	NEXT
ENDIF
CFLAG:LOCAL:초기이상경험 = EXP:LOCAL:이상경험

CFLAG:LOCAL:딸의부친고유번호딸 = -1
CFLAG:LOCAL:딸의친부모고유번호딸 = -1

;초기호감도
;加入キャラに호감도と被호감도の데이터を両方持たせておき、加入時点で相손をサーチして両方上書きする
;배우자ㆍ近親はデフォで초기호감도を持つ
VARSET 초기호감도치
SPLIT CSTR:LOCAL:초기호감도, "_", 초기호감도치
FOR LOCAL:1, 0, CHARANUM
	LOCAL:2 = FINDELEMENT(초기호감도치, CSVCALLNAME(NO:(LOCAL:1), 0), , , 1)
	IF LOCAL:2 > 0
		CDFLAG:LOCAL:캐릭터간호감도:(CFLAG:(LOCAL:1):캐릭터고유번호 + 100) = TOINT(초기호감도치:(LOCAL:2 + 1))
		CDFLAG:(LOCAL:1):캐릭터간호감도:(CFLAG:LOCAL:캐릭터고유번호 + 100) = TOINT(초기호감도치:(LOCAL:2 + 2))
	ELSEIF CSV배우자(LOCAL, LOCAL:1)
		CDFLAG:LOCAL:캐릭터간호감도:(CFLAG:(LOCAL:1):캐릭터고유번호 + 100) = 2000
		CDFLAG:(LOCAL:1):캐릭터간호감도:(CFLAG:LOCAL:캐릭터고유번호 + 100) = 2000
	ELSEIF 근친체크(LOCAL, LOCAL:1)
		CDFLAG:LOCAL:캐릭터간호감도:(CFLAG:(LOCAL:1):캐릭터고유번호 + 100) = 500
		CDFLAG:(LOCAL:1):캐릭터간호감도:(CFLAG:LOCAL:캐릭터고유번호 + 100) = 500
	ENDIF
NEXT

;---- EDIT 045 ADD START -------------------------
FOR LOCAL:1,1750,1780
	IF CFLAG:LOCAL:(LOCAL:1) > 0 && GETCHARA(CFLAG:LOCAL:(LOCAL:1)) >= -1
		CALL 특수우정추가,LOCAL,GETCHARA(CFLAG:LOCAL:(LOCAL:1))
	ENDIF
NEXT
FOR LOCAL:1,0,FLAG:상태이상수
	BASE:LOCAL:GET_STATE(LOCAL:1) = 0
NEXT
;---- EDIT 045 ADD END -------------------------

;캐릭터상성の초기치は-1(不在)
FOR LOCAL:1, 1, 21
	CFLAG:LOCAL:@"캐릭터상성{LOCAL:1}" = -1
NEXT

;이인칭の変換
IF STRFIND(CSTR:LOCAL:이인칭 , "NAME:MASTER") > -1
	IF NAME:MASTER == "당신" || CALLNAME:MASTER == "당신"
		CSTR:LOCAL:이인칭 = 당신
	ELSEIF STRFIND(CSTR:LOCAL:이인칭 , "CALLNAME:MASTER") > -1
		CSTR:LOCAL:이인칭 = %CALLNAME:MASTER + SUBSTRING(CSTR:LOCAL:이인칭 , 17)%
	ELSE
		CSTR:LOCAL:이인칭 = %NAME:MASTER + SUBSTRING(CSTR:LOCAL:이인칭 , 13)%
	ENDIF
ENDIF
CALL CONVERT_SECOND_PERSON, LOCAL

;---- EDIT 026 MOD START -------------------------
;---- EDIT 025 ADD START -------------------------
;악마が容量を超えて仲魔になった場合、ＤＤＭ사용中ならその기능で자택서버ーに転送することを説明
IF ＣＯＭＰ빈용량() == -1 && SOFT_ON("ＤＤＭ") && FLAG:합체예정악마1 == -1 && ABL:LOCAL:종족 != 0
	CFLAG:LOCAL:소속ＣＯＭＰ = -1
	PRINTFORMW ＣＯＭＰ에 빈 용량이 없으므로、ＤＤＭ으로 자택서버에 전송했습니다
ENDIF

;ＤＤＭ不사용時に容量を超えて仲魔になった場合のため、元の処理も残しておく
;---- EDIT 025 ADD END ---------------------------
;容量を超えて仲魔になった場合、자택서버ーに転送
IF ＣＯＭＰ빈용량() == -1 && FLAG:합체예정악마1 == -1
	CFLAG:LOCAL:소속ＣＯＭＰ = -1
ENDIF
;---- EDIT 026 MOD END -------------------------

;설정された性別の場合、요바이を불허가に
IF (FLAG:요바이불허가성별 & 2 && TALENT:LOCAL:오토코노코)
	CFLAG:LOCAL:요바이불허가 = 1
ELSEIF (FLAG:요바이불허가성별 & 1 && TALENT:LOCAL:남자 && TALENT:LOCAL:오토코노코 == 0)
	CFLAG:LOCAL:요바이불허가 = 1
ELSEIF (FLAG:요바이불허가성별 & 4 && TALENT:LOCAL:남자 == 0)
	CFLAG:LOCAL:요바이불허가 = 1
ENDIF

;全コマンド系統필터ＯＮ
FOR LOCAL:1 , 0 , 13
	CFLAG:LOCAL:(170+LOCAL:1) = 1
NEXT

;스킬ロック
CALL AUTO_SKILL_ROCK,LOCAL
SIF 스킬변경가능확인(LOCAL) > 1
	CALL AUTO_SKILL_ROCK,LOCAL,1

CALL SYNC_STATUS,LOCAL
CALL HEALTH_CHARA,LOCAL
RESULT:1 = LOCAL
RETURN 1


;=======================================
;적キャラクターの消滅
;=======================================
@DELENEMY
SIF FLAG:디버그전투플래그
	RETURN 0
FOR LOCAL,CHARANUM,0,-1
	IF CFLAG:(LOCAL-1):PT플래그 == 0
		SIF CFLAG:(LOCAL-1):포지션 > 0
			CALL REMOVE_POSITION,CFLAG:(LOCAL-1):포지션
		DELCHARA (LOCAL-1)
	ENDIF
NEXT
;===============================
;キャラクター全쾌
;===============================
@HEALTH_CHARA,ARG
BASE:ARG:ＨＰ = MAXBASE:ARG:ＨＰ
BASE:ARG:ＭＰ = MAXBASE:ARG:ＭＰ
CFLAG:ARG:상태이상 = 0
CFLAG:ARG:상태이상경과턴수 = 0


;=======================================================
;스킬실행시의 기본적인 동작
;=======================================================

;HPの増減処理
@VAR_HP,ARG,ARG:1,ARG:2 = -1
;---- EDIT 043 ADD START -------------------------
;ARG:2　-1 自動選出 0통상の데미지orマッスルドリンコ的회복　1이악물기有効　2불굴의투지有効　3통상の회복　4아르카나시프트　5네버기브업有効
IF ARG:2 == -1
	ARG:2 = 0
	IF ARG:1 < 0 && CFLAG:ARG:이악물기플래그 == 0
		SIF HAVE_SKILL(ARG, [[스킬:이악물기]])
			ARG:2 = 1
		SIF HAVE_SKILL(ARG, [[스킬:불굴의투지]]) || (EQUIP:ARG:바ㆍ벨 && FLAG:벨신격파 & 8);061
			ARG:2 = 2
		SIF HAVE_SKILL(ARG, [[스킬:네버기브업]])
			ARG:2 = 5
		;---- EDIT 058 ADD START -------------------------
		SIF HAVE_SKILL(ARG, [[스킬:SONG OF DIVA]])
			ARG:2 = 6
		;---- EDIT 058 ADD END   -------------------------
		;---- EDIT 062 ADD START -------------------------
		SIF HAVE_SKILL(ARG, (PU_SKILLNUM_GET(ARG,"四枝の浅瀬")))
			ARG:2 = 7
		;---- EDIT 062 ADD END   -------------------------
		;---- EDIT 077 ADD START -------------------------
		;---- EDIT 071 ADD START -------------------------
		;---- EDIT 063 ADD START -------------------------
		SIF HAVE_PU_SKILL(ARG,"劫火の余燼")
			ARG:2 = 8
		;---- EDIT 063 ADD END -------------------------
		;---- EDIT 071 ADD END -------------------------
		;---- EDIT 077 ADD END -------------------------
	ELSEIF ARG:1 > 0
		ARG:2 = 3
	ENDIF
ENDIF
;---- EDIT 043 ADD END -------------------------
SIF GET_STATE(CFLAG:(ARG):상태이상) == "DYING" && ARG:1 < 0
	RETURN 0
;---- EDIT 063 ADD START  -------------------------
IF AUTO_PU_SKILL_ラグナロク（ＡＮ）(ARG,"회복阻害") > 0
	SIF ARG:1 > 0 && ARG:2 == 3
		ARG:1 /= 10
ENDIF
;---- EDIT 063 ADD END  -------------------------
BASE:ARG:ＨＰ += ARG:1

;---- EDIT 020 ADD START -------------------------
IF FLAG:무후후전개 && EQUIP:MASTER:엑스링케이지
	;受けた데미지量の최대HPに対する割合に、욕망と마조끼をかけて던전내발정용욕정치が増加
	CFLAG:ARG:던전내발정용욕정치 += ARG:1 * (ABL:ARG:욕망 + ABL:ARG:마조끼) / MAXBASE:ARG:ＨＰ
ENDIF
;---- EDIT 020 ADD END -------------------------
;---- EDIT 071 ADD START -------------------------
IF TALENT:ARG:페르소나구사자 >= 1 && CFLAG:ARG:잠재능력발동횟수 < 4
	;페르소나구사자で尚且つ잠재능력발동횟수が4未満なら潜在フラグを立てる（現時点では潜在반격、잠재특수での사용を想定している）
	CALL SENZAI_FLAG,ARG,"登録",ARG:1
ENDIF
;---- EDIT 071 ADD END   -------------------------
IF BASE:ARG:ＨＰ < 1
	IF CFLAG:ARG:불사신플래그
		IF CFLAG:ARG:불사신플래그 > 1
			PRINTL
			PRINTFORM \@ CFLAG:ARG:불사신플래그 == 2 ? %CALLNAME:ARG%는 이를 악물었다！ # %CALLNAME:ARG%는 일어섰다！ \@
		ENDIF
		BASE:ARG:ＨＰ = (CFLAG:ARG:불사신플래그 == 3 ? MAXBASE:ARG:ＨＰ # 1)
		CFLAG:ARG:이악물기플래그 = 1
		;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5;052
	ELSEIF ARG:2 == 1
		BASE:ARG:ＨＰ = 1
		PRINTL
		PRINTFORM %조사처리(CALLNAME:ARG,"는")% 이를 악물었다！
;---- EDIT 043 ADD -------------------------
		CFLAG:ARG:이악물기플래그 = 1
		;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5;052
	ELSEIF ARG:2 == 2
		BASE:ARG:ＨＰ = MAXBASE:ARG:5
		PRINTL
		PRINTFORM %조사처리(CALLNAME:ARG,"는")% 일어섰다！
;---- EDIT 043 ADD -------------------------
		CFLAG:ARG:이악물기플래그 = 1
		;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5;052
	ELSEIF ARG:2 == 5
		BASE:ARG:ＨＰ = MAXBASE:ARG:5
		PRINTL
		PRINTFORM %조사처리(CALLNAME:ARG,"는")% 아직 싸울 생각이다！
;---- EDIT 043 ADD START -------------------------
		CFLAG:ARG:이악물기플래그 = 1
		;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5;052
		IF HAVE_SKILL(ARG, [[스킬:데빌트리거]]) && SKILLGAGE_F_GET(ARG, [[스킬:데빌트리거]]) > 19
			CALL SKILLGAGE_D_SET,ARG,[[스킬:데빌트리거]],SKILLGAGE_F_GET(ARG, [[스킬:데빌트리거]])/20
			CALL SKILLGAGE_F_SET,ARG,[[스킬:데빌트리거]],0
			PRINTFORM {SKILLGAGE_D_GET(ARG, [[스킬:데빌트리거]])}ターン魔인간화상태！
		ENDIF
	;---- EDIT 043 ADD END -------------------------
	;---- EDIT 058 ADD START -------------------------
	ELSEIF ARG:2 == 6
		;既にモードㆍアウェイクニングになってたらダメ（そんなことないと起きないと思うけど）
		IF HAVE_SKILL(ARG, [[스킬:SONG OF DIVA]]) && SKILLGAGE_H_GET(ARG, [[스킬:SONG OF DIVA]]) == 0
			BASE:ARG:ＨＰ = MAXBASE:ARG:5
			PRINTL
			CFLAG:ARG:이악물기플래그 = 1
			;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5
			CALL SKILLGAGE_H_SET, ARG, [[스킬:SONG OF DIVA]], 1
			CALL ACTION_3626, ARG, ARG:1
		ENDIF
	;---- EDIT 058 ADD END -------------------------
	;---- EDIT 061 ADD START -------------------------
	ELSEIF ARG:2 == 7
		BASE:ARG:ＨＰ = 1
		PRINTL
		PRINTFORM %CALLNAME:ARG%はまだまだやる気だ！
		SELECTCASE SKILLGAGE_H_GET(ARG,(PU_SKILLNUM_GET(ARG,"四枝の浅瀬")))
			CASE 0
				CALL SKILLGAGE_H_SET,ARG,(PU_SKILLNUM_GET(ARG,"四枝の浅瀬")),1
			CASE 1
				CALL SKILLGAGE_H_SET,ARG,(PU_SKILLNUM_GET(ARG,"四枝の浅瀬")),2
			CASEELSE
				CALL SKILLGAGE_H_SET,ARG,(PU_SKILLNUM_GET(ARG,"四枝の浅瀬")),3
				CFLAG:ARG:이악물기플래그 = 1
		ENDSELECT
		;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5;052
	;---- EDIT 061 ADD END ---------------------------
	;---- EDIT 063 ADD START ---------------------------
	ELSEIF ARG:2 == 8
		BASE:ARG:ＨＰ = 1
		IF SKILLGAGE_H_GET(ARG,(PU_SKILLNUM_GET(ARG,"劫火の余燼"))) < 1
			CFLAG:ARG:회복불능플래그 = 1
			PRINTL
			PRINTFORML %CALLNAME:ARG%は自身の余燼を燃やし、身体を奮い立たせた！
			CALL SKILLGAGE_H_SET,ARG,(PU_SKILLNUM_GET(ARG,"劫火の余燼")),1
			IF CSTR:ARG:104 != ""
				CALL SKILLGAGE_D_SET,ARG,(PU_SKILLNUM_GET(ARG,"劫火の余燼")),2
			ELSE
				CALL SKILLGAGE_D_SET,ARG,(PU_SKILLNUM_GET(ARG,"劫火の余燼")),1
			ENDIF
		ELSE
			PRINTL
			PRINTFORML %CALLNAME:ARG%の燃える余燼が、身体を奮い立たせる！
		ENDIF
		;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5;052
	;---- EDIT 063 ADD END ---------------------------
	;잠재능력
	;페르소나구사자であり潜在復活ㆍ特殊を持つ時発動
	ELSEIF TALENT:(ARG):페르소나구사자 >= 1 && ABL:ARG:잠재능력 == 3 && CFLAG:ARG:PT플래그
		;潜在復活
		IF ABL:ARG:잠재능력 == 3 && !CFLAG:ARG:잠재능력발동횟수
			;相性☆
			IF GET_P_FITNESS(ARG, 0) >= 3
				PRINTL
				SETCOLOR 0x66FFFF
				PRINT 　　잠재부활 
				RESETCOLOR
				BASE:ARG:ＨＰ = MAXBASE:ARG:ＨＰ
				PRINTFORM %조사처리(CALLNAME:ARG,"는")% 일어섰다！
			;相性◎
			ELSEIF GET_P_FITNESS(ARG, 0) == 2
				PRINTL
				SETCOLOR 0x66FFFF
				PRINT 　　잠재부활 
				RESETCOLOR
				BASE:ARG:ＨＰ = MAXBASE:ARG:ＨＰ / 4
				PRINTFORM %조사처리(CALLNAME:ARG,"는")% 일어섰다！
			ENDIF
			CFLAG:ARG:잠재능력발동횟수 = 4
			;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 5;052
		ENDIF
		;---- EDIT 071 START -------------------------
		;IF RAND:2 == 0 && CFLAG:ARG:잠재능력발동횟수 < 4
		;	;잠재특수
		;	IF ABL:ARG:잠재능력 == 4
		;		;相性☆
		;		IF GET_P_FITNESS(ARG, 0) >= 3
		;			PRINTL
		;			SETCOLOR 0x66FFFF
		;			PRINTFORML 　　%CALLNAME:ARG% 잠재특수공격
		;			RESETCOLOR
		;			CALLFORM ACTION_2010, ARG, 22
		;		;相性◎
		;		ELSEIF GET_P_FITNESS(ARG, 0) == 2
		;			PRINTL
		;			SETCOLOR 0x66FFFF
		;			PRINTFORML 　　%CALLNAME:ARG% 잠재특수공격
		;			RESETCOLOR
		;			CALLFORM ACTION_2010, ARG, 22
		;		ENDIF
		;		CFLAG:ARG:잠재능력발동횟수 ++
		;	ENDIF
		;ELSEIF BASE:ARG:ＨＰ < 1
		;	CALL DEAD_CHARA,ARG
		;ENDIF
		IF BASE:ARG:ＨＰ < 1
			CALL DEAD_CHARA,ARG
		ENDIF
		;---- EDIT 071 END   -------------------------
	ELSE
		CALL DEAD_CHARA,ARG
	ENDIF
ELSEIF BASE:ARG:ＨＰ > MAXBASE:ARG:ＨＰ && ARG:2 == 3
	BASE:ARG:ＨＰ = MAXBASE:ARG:ＨＰ
ENDIF


;MPの増減処理
@VAR_MP,ARG,ARG:1,ARG:2
;ARG:2　0通常の데미지orマッスルドリンコ的회복　1이악물기有効　2불굴의투지有効　3通常の회복　4아르카나시프트　5ネヴァーギブアップ有効
BASE:ARG:ＭＰ += ARG:1
IF BASE:ARG:ＭＰ < 1
	IF ARG:2 == 1
		BASE:ARG:ＭＰ = 1
	ELSEIF ARG:2 == 2
		BASE:ARG:ＭＰ = MAXBASE:ARG:ＭＰ
	ELSEIF ARG:2 == 5
		BASE:ARG:ＭＰ = MAXBASE:ARG:ＭＰ
	ELSE
		BASE:ARG:ＭＰ = 0
	ENDIF
ELSEIF BASE:ARG:ＭＰ > MAXBASE:ARG:ＭＰ && ARG:2 == 3
	BASE:ARG:ＭＰ = MAXBASE:ARG:ＭＰ
ENDIF

;기본的な물리명중판정の処理
;---- EDIT 037 ADD ---------------------------
@JUDG_HIT_1,ARG,ARG:1,ARG:2
#LOCALSIZE 1
#DIM L_추가명중강화
#DIM L_추가회피강화
#DIM 스킬相性

L_추가명중강화 = 0
L_추가회피강화 = 0

;ARG 공격者
;ARG:1 被공격者
;ARG:2 스킬명중率
;LOCAL 능력差による기본명중率

LOCAL = 80 - (MAXBASE:(ARG:1):(GET_BATTLESTATUS(3))) + (MAXBASE:ARG:(GET_BATTLESTATUS(1)))
;---- EDIT 054 ADD START -------------------------
IF BATTLE_SETTING_IS_ITEM_HITRATE() && ARG == FLAG:행동순1 && INRANGE(CFLAG:ARG:입력행동,3001, 3500)
	DEBUGPRINTFORML [%CALLNAME:ARG%]%SKILL_NAME_F(CFLAG:ARG:입력행동)%=>[%CALLNAME:(ARG:1)%] 道具威힘で판정します
	LOCAL -= MAXBASE:ARG:(GET_BATTLESTATUS(1))
	LOCAL += MAXBASE:ARG:도구명중
ENDIF
;---- EDIT 054 ADD END -------------------------

;---- 추가명중강화 ----
;백발백중、천발천중、간파の명중강화
L_추가명중강화 += HAVE_SKILL(ARG,2447)*4 + HAVE_SKILL(ARG,2448)*8 + HAVE_SKILL(ARG,2449)*4
;---- EDIT 066 MOD START --------------------------
;◯ゲッシュ소지かつ、誓いを守れているかで보정が発生
	IF HAVE_PU_SKILL(ARG,"ゲッシュ")
		;誓い（Fゲージ）0=プラス보정、-1=마이ナス보정
		IF SKILLGAGE_F_GET(ARG,PU_SKILLNUM_GET(ARG,"ゲッシュ")) == -1
			L_추가명중강화 -= 16
		ELSE
			L_추가명중강화 += 8
		ENDIF
	ENDIF

;---- EDIT 066 MOD END ----------------------------

;---- 추가회피강화 ----
;---- EDIT 044 MOD ADD -------------------------
;---- EDIT 065 MOD ADD -------------------------
;---- EDIT 068 MOD ADD -------------------------
;エアトリック/에어하이크/クラス:어새신/ダッジで物理회피강화
L_추가회피강화 += HAVE_SKILL(ARG:1,3605)*4 + HAVE_SKILL(ARG:1,3608)*4 + HAVE_PU_SKILL(ARG:1,"어새신")*4 + HAVE_SKILL(ARG:1,2486)*4

;------------------
;---- EDIT 068 MOD END ----------------------------
;---- EDIT 070 ADD START ---------------------------
;---- EDIT 058 ADD START -------------------------
IF SKILLGAGE_H_GET(ARG:1, [[스킬:SONG OF DIVA]]) || SKILLGAGE_F_GET(ARG:1, [[스킬:SONG OF DIVA]])
	;ダークネストリガー未사용(0)ㆍ強制해제後(2)なら
	SIF SKILLGAGE_H_GET(ARG:1, [[스킬:DARKNESS TRIGGER]]) != 1
		L_추가회피강화 += 4
ENDIF
;---- EDIT 058 ADD END -------------------------
;---- EDIT 066 MOD START --------------------------
;◯ゲッシュ소지かつ、誓いを守れているかで보정が発生
	IF HAVE_PU_SKILL(ARG:1,"ゲッシュ")
		;誓い（Fゲージ）0=プラス보정、-1=마이ナス보정
		IF SKILLGAGE_F_GET(ARG:1,PU_SKILLNUM_GET(ARG:1,"ゲッシュ")) == -1
			L_추가회피강화 -= 16
		ELSE
			L_추가회피강화 += 8
		ENDIF
	ENDIF

;---- EDIT 061 ADD START ---------------------------
;◯矢避けの加護보정分　비구のみ회피率大幅上昇
	TRYCALLFORM SKILL_TYPE_{CFLAG:(FLAG:행동순1):입력행동},FLAG:행동순1
	스킬相性 = RESULT
	;PRINTFORMW  스킬相性{스킬相性}
	IF 스킬相性 == GET_TYPE_NUM("비구")
		;PRINTFORMW  비구に회피보정発生中
		L_추가회피강화 += HAVE_PU_SKILL(ARG:1,"矢避けの加護")*8
	ENDIF
;---- EDIT 066 MOD END ----------------------------
;---- EDIT 061 ADD END -----------------------------
;---- EDIT 073 MOD ADD -------------------------
CALL AUTO_PU_SKILL_バイㆍバイㆍライジング,ARG,"物理회피판정↑",ARG:1
L_추가회피강화 += RESULT
;---- EDIT 073 MOD END ----------------------------
;---- EDIT 077 MOD START ----------------------------
;전술영창γ 기동중에는 강화를 얻는다
;AUTO_PU_SKILL계는 공격자, 변화내용, 방어자 순으로 引数를 주고 있습니다
CALL AUTO_PU_SKILL_戦術詠唱γ,ARG,"物理회피판정↑",ARG:1
L_추가회피강화 += RESULT
;---- EDIT 077 MOD END   ----------------------------

LOCAL *= (32 + CFLAG:ARG:명중강화 + L_추가명중강화)
LOCAL /= (32 + CFLAG:(ARG:1):회피강화 + L_추가회피강화)

;バステ影響설정有効
IF BATTLE_SETTING_IS_BAD_STATUS()
	SELECTCASE GET_STATE(CFLAG:(ARG:1):상태이상)
		CASE "STONE","PALYZE","BIND","FREEZE","SHOCK","SLEEP","PANIC","CHARM","HEAT","SLIP"
			RETURN 1
	ENDSELECT
ENDIF
;---- EDIT 065 ADD START  -------------------------
IF (RAND:100 < ARG:2 * LOCAL / 100) || CFLAG:ARG:베어내기플래그 || HAVE_SKILL(ARG,[[스킬:프린키피아]]) || HAVE_SKILL(ARG:1,[[스킬:프린키피아]]) || HIT_CONTINUE_黒龍双剋勝利剣(ARG,ARG:1) || HIT_CONTINUE_無銘勝利剣(ARG,ARG:1)
;---- EDIT 065 ADD END  -------------------------
	RETURN 1
ELSE
	RETURN 0
ENDIF

;기본的な魔法명중판정の処理
@JUDG_HIT_2,ARG,ARG:1,ARG:2
#LOCALSIZE 1
#DIM L_추가명중강화
#DIM L_추가회피강화
L_추가명중강화 = 0
L_추가회피강화 = 0
;ARG 공격者
;ARG:1 被공격者
;ARG:2 스킬명중率
;LOCAL 능력差による기본명중率
LOCAL = 100 - ((MAXBASE:(ARG:1):(GET_BATTLESTATUS(5)) + MAXBASE:(ARG:1):(GET_BATTLESTATUS(3))) / 2) + (MAXBASE:ARG:(GET_BATTLESTATUS(5)) + MAXBASE:ARG:(GET_BATTLESTATUS(1)) / 2)
;---- EDIT 054 ADD START -------------------------
IF BATTLE_SETTING_IS_ITEM_HITRATE() && ARG == FLAG:행동순1 && INRANGE(CFLAG:ARG:입력행동,3001, 3500)
	DEBUGPRINTFORML [%CALLNAME:ARG%]%SKILL_NAME_F(CFLAG:ARG:입력행동)%=>[%CALLNAME:(ARG:1)%] 도구명중で판정します
	LOCAL -= (MAXBASE:ARG:(GET_BATTLESTATUS(5)) + MAXBASE:ARG:(GET_BATTLESTATUS(1)) / 2)
	LOCAL += MAXBASE:ARG:도구명중
ENDIF
;---- EDIT 054 ADD END -------------------------

;---- 추가명중강화 ----
;백발백중、천발천중の명중강화
L_추가명중강화 += HAVE_SKILL(ARG,2447)*4 + HAVE_SKILL(ARG,2448)*8
;---- EDIT 066 MOD START --------------------------
;◯ゲッシュ소지かつ、誓いを守れているかで보정が発生
	IF HAVE_PU_SKILL(ARG,"ゲッシュ")
		;誓い（Fゲージ）0=プラス보정、-1=마이ナス보정
		IF SKILLGAGE_F_GET(ARG,PU_SKILLNUM_GET(ARG,"ゲッシュ")) == -1
			L_추가명중강화 -= 16
		ELSE
			L_추가명중강화 += 8
		ENDIF
	ENDIF

;---- EDIT 066 MOD END ----------------------------
;---- EDIT 077 MOD START ----------------------------
;전술영창γ 기동중에는 강화를 얻는다
;AUTO_PU_SKILL계는 공격자, 변화내용, 방어자 순으로 引数를 주고 있습니다
CALL AUTO_PU_SKILL_戦術詠唱γ,ARG,"魔法명중판정↑",ARG:1
L_추가명중강화 += RESULT
;---- EDIT 077 MOD END   ----------------------------

;---- 추가회피강화 ----
;L_추가회피강화 += HAVE_SKILL(ARG:1,XXXX)*4

;------------------
;---- EDIT 058 ADD START -------------------------
IF SKILLGAGE_H_GET(ARG:1, [[스킬:SONG OF DIVA]]) || SKILLGAGE_F_GET(ARG:1, [[스킬:SONG OF DIVA]])
	;ダークネストリガー未사용(0)ㆍ強制해제後(2)なら
	SIF SKILLGAGE_H_GET(ARG:1, [[스킬:DARKNESS TRIGGER]]) != 1
		L_추가회피강화 += 4
ENDIF
;---- EDIT 058 ADD END -------------------------
;---- EDIT 066 MOD START --------------------------
;◯ゲッシュ소지かつ、誓いを守れているかで보정が発生
	IF HAVE_PU_SKILL(ARG:1,"ゲッシュ")
		;誓い（Fゲージ）0=プラス보정、-1=마이ナス보정
		IF SKILLGAGE_F_GET(ARG:1,PU_SKILLNUM_GET(ARG:1,"ゲッシュ")) == -1
			L_추가회피강화 -= 16
		ELSE
			L_추가회피강화 += 8
		ENDIF
	ENDIF

;---- EDIT 066 MOD END ----------------------------
;---- EDIT 070 MOD END ----------------------------
;---- EDIT 073 MOD ADD -------------------------
CALL AUTO_PU_SKILL_バイㆍバイㆍライジング,ARG,"魔法회피판정↑",ARG:1
L_추가회피강화 += RESULT
;---- EDIT 073 MOD END ----------------------------
;---- EDIT 077 MOD START ----------------------------
;戦術詠唱γ、影霄ㆍ奔夜起動中は강화を得る
;AUTO_PU_SKILL계는 공격자, 변화내용, 방어자 순으로 引数를 주고 있습니다
CALL AUTO_PU_SKILL_戦術詠唱γ,ARG,"魔法회피판정↑",ARG:1
L_추가회피강화 += RESULT
CALL AUTO_PU_SKILL_影霄ㆍ奔夜,ARG,"魔法회피판정↑",ARG:1
L_추가회피강화 += RESULT
;---- EDIT 077 MOD END   ----------------------------

LOCAL *= (32 + CFLAG:ARG:명중강화 + L_추가명중강화)
LOCAL /= (32 + CFLAG:(ARG:1):회피강화 + L_추가회피강화)


;バステ影響설정有効
IF BATTLE_SETTING_IS_BAD_STATUS()
	SELECTCASE GET_STATE(CFLAG:(ARG:1):상태이상)
		CASE "STONE","PALYZE","BIND","FREEZE","SHOCK","SLEEP","PANIC","CHARM","HEAT","SLIP"
			RETURN 1
	ENDSELECT
ENDIF
IF RAND:100 < ARG:2 * LOCAL / 100 || HAVE_SKILL(ARG,[[스킬:프린키피아]]) || HAVE_SKILL(ARG:1,[[스킬:프린키피아]])
	RETURN 1
ELSE
	RETURN 0
ENDIF


@ATTACK_BADSTATE,ARG,ARG:1,ARG:2,ARG:3,ARG:4,ARG:5
;ARG 공격者
;ARG:1 被공격者
;ARG:2 バッド스테이터스の종류
;ARG:3 相性
;ARG:4 기본부여확률
;ARG:5 확률上限

#DIM L_성공율
#DIM L_성공플래그
#DIM L_디버프내성관통플래그
;---- EDIT 051 MOD -------------------------
CALL RECEIVE_BADSTATE,ARG:1,ARG:2
;-----------------------------
;- 초기処理
;-----------------------------
L_성공율 = ARG:4
L_성공플래그 = 0
L_디버프내성관통플래그 = 0
;-----------------------------
;- ブロック판정
;-----------------------------

;壁系스킬でバステを防ぐ
;バステ에 대해 壁系스킬でバステを防ぐ
LOCALS = %GET_STATE(ARG:2)%무효화횟수
IF CFLAG:(ARG:1):LOCALS
	PRINT BLOCK
	CFLAG:(ARG:1):(GET_STATE(ARG:2) + "피탄") = 1
	RETURN 0
ENDIF

;相性に対する壁系統の스킬でバステを防ぐ
LOCALS = %GET_TYPE(ARG:3)%무효화횟수
IF CFLAG:(ARG:1):LOCALS
	PRINT BLOCK
	CFLAG:(ARG:1):(GET_TYPE(ARG:3) + "피탄") = 1
	RETURN 0
ENDIF
;후리후리월をバステで防ぐ
LOCALS = BS무효화횟수
IF CFLAG:(ARG:1):LOCALS
	PRINT BLOCK
	CFLAG:(ARG:1):BS피탄 = 1
	RETURN 0
ENDIF

;방어中はバッド스테이터스にかからない
IF CFLAG:(ARG:1):방어플래그 == 1
	PRINT GUARD
	RETURN 0
ENDIF

;バステ내성でブロック（ややこしいね)	
;IF  MAXBASE:(ARG:1):GET_STATE(ARG:2) <= -100
;	PRINTL BLOCK
;	RETURN 0
;;가드킬されていないなら방어상성でブロック
;ELSE
IF ( MAXBASE:(ARG:1):(GET_TYPE(ARG:3)) <= 0 || MAXBASE:(ARG:1):(GET_TYPE(ARG:3)) == 999 ) && !CFLAG:(ARG:1):(GET_TYPE(ARG:3)+"가드킬")
	PRINT BLOCK
	RETURN 0
;カーン系でブロック
ELSEIF ( CFLAG:(ARG:1):물리반사플래그 && ARG:3 < 4 ) || (CFLAG:(ARG:1):마법반사플래그 && (ARG:3 > 3 && ARG:3 != 17))
	PRINT BLOCK
	RETURN 0
;수호의방패でブロック　バステブロック時は縦が消えない
ELSEIF (CFLAG:(ARG:1):무효플래그 && ARG:3 != 17)
	PRINT BLOCK
	RETURN 0
;対応する相性の웨이트스킬発動中の場合、무효	
ELSEIF CFLAG:(ARG:1):(GET_TYPE(ARG:3) + "웨이트")
	PRINT BLOCK
	RETURN 0
;BS무효플래그が立っている적の場合、ブロック
ELSEIF CFLAG:(ARG:1):PT플래그 < 1 && CFLAG:(ARG:1):BS무효플래그
	PRINT BLOCK
	RETURN 0
;보스플래그が立っている적の場合、石化と即死をブロック 
ELSEIF CFLAG:(ARG:1):PT플래그 < 1 && CFLAG:(ARG:1):보스플래그 && (GET_STATE(ARG:2) == "STONE" || GET_STATE(ARG:2) == "DYING")
	PRINT BLOCK
	RETURN 0
;적側は蠅化を무효にする
ELSEIF CFLAG:(ARG:1):PT플래그 < 1 && GET_STATE(ARG:2) == "FLY"
	PRINT BLOCK
	RETURN 0
;相손が벨ㆍ데르ならブロック
ELSEIF NO:(ARG:1) == [[캐릭터:벨ㆍ데르]]
	PRINT BLOCK
	RETURN 0
ELSEIF AUTO_PU_SKILL_劫火の余燼(ARG,"상태이상無効") > 0 && (GET_STATE(ARG:2) == "STONE" || GET_STATE(ARG:2) == "DYING")
	PRINT BLOCK
	RETURN 0
ENDIF
;-----------------------------
;- 성공판정
;-----------------------------
;LOCAL = ARG:4 * (MAXBASE:ARG:(GET_BATTLESTATUS(5)) + MAXBASE:ARG:(GET_BASESTATUS(6)) * 2) / (MAXBASE:(ARG:1):(GET_BATTLESTATUS(5)) + MAXBASE:(ARG:1):(GET_BASESTATUS(6)))
L_성공율 *=MAX(1,(100 - MAXBASE:(ARG:1):(GET_BATTLESTATUS(5)) - MAXBASE:(ARG:1):(GET_BASESTATUS(6)) + MAXBASE:ARG:(GET_BATTLESTATUS(5))+ MAXBASE:ARG:(GET_BASESTATUS(6)))) 
L_성공율 /= 100

;마법효과강화による보정　
L_성공율 -= CFLAG:(ARG:1):마법효과강화
L_성공율 += CFLAG:ARG:마법효과강화
L_성공율 = MAX(0,L_성공율) ;성공率が負だった場合は0に

;呪い、낙인だと即死しやすい 即死내성관통
IF (CFLAG:(ARG:1):상태이상 == GET_STATE_NUM("CURSE") || CFLAG:(ARG:1):상태이상 == GET_STATE_NUM("BRAND")) && ARG:2 == GET_STATE_NUM("DYING")
	L_성공율 += 50
	L_디버프내성관통플래그 = 1
ENDIF

;ボスには効きづらい
SIF CFLAG:(ARG:1):보스플래그 && CFLAG:(ARG:1):PT플래그 < 1
	L_성공율 /= 4

;스킬소질の전투への影響がONになっていたら스킬소질で보정
IF  BATTLE_SETTING_IS_TALENT()
	;사용者が스킬소질持ちなら성공率が1.5倍
	CALL 상성소질체크, ARG, ARG:3, 1
	SIF RESULT == 1 && BATTLE_SETTING_IS_TALENT()
		L_성공율 = L_성공율 * 3/2
ENDIF
	
;방어상성による倍率보정、가드킬상태の場合、내성이상の相性보정を無視
IF !CFLAG:(ARG:1):(GET_TYPE(ARG:3)+"가드킬") || (MAXBASE:(ARG:1):(GET_TYPE(ARG:3)) > 100 && MAXBASE:(ARG:1):(GET_TYPE(ARG:3)) != 999)
	L_성공율 *= MAXBASE:(ARG:1):(GET_TYPE(ARG:3))
	L_성공율 /= 100
ENDIF

;バステ내성による보정
IF L_디버프내성관통플래그 == 0
;---- EDIT 040 MOD START ---- 
	IF  MAXBASE:(ARG:1):GET_STATE(ARG:2) <= -100
		PRINT BLOCK
		RETURN 0
	ENDIF
;---- EDIT 040 MOD END ---- 
	;バステ내성による보정
	L_성공율 *= (100+MAXBASE:(ARG:1):GET_STATE(ARG:2))
	L_성공율 /= 100
ENDIF

;확률が上限超えていたら확률上限値に
L_성공율 = MIN(ARG:5,L_성공율)

;BS부착률강화による보정
;---- EDIT 065 ADD START  -------------------------
L_성공율 *= (CFLAG:(ARG:1):BS부착률강화+4) + HAVE_PU_SKILL(ARG,"어새신")
;---- EDIT 065 ADD END  -------------------------
L_성공율	 /= 4
SIF RAND:100 < L_성공율
	L_성공플래그 = 1	


;상태이상の優先順位処理
IF BADSTATE_PRIORITY(CFLAG:(ARG:1):상태이상) > BADSTATE_PRIORITY(ARG:3);052
	;BRAND상태では即死が通る
	IF L_디버프내성관통플래그 == 0
		L_성공플래그 = 0
	ENDIF
	
ENDIF

;L_성공플래그が立ってない場合　処理を종료
IF L_성공플래그 == 0
	PRINTFORM \@ (CFLAG:(ARG:1):(GET_TYPE(ARG:3)+"가드킬") || ( MAXBASE:(ARG:1):(GET_TYPE(ARG:3)) != 999 && MAXBASE:(ARG:1):(GET_TYPE(ARG:3)) >= 0))  ? Miss # BLOCK \@
	RETURN 0
ELSE
;-----------------------------
;- 배드스테이터스부여処理
;-----------------------------
;---- EDIT 051 MOD -------------------------
	CALL RECEIVE_BADSTATE,ARG:1,ARG:2,1
	;---- EDIT 028 MOD START -------------------------
	IF CFLAG:(ARG:1):상태이상 == GET_STATE_NUM("FLY")
		CFLAG:(ARG:1):상태이상 = 0
		CALL SYNC_STATUS,ARG:1
	ENDIF
	;---- EDIT 028 MOD END ---------------------------
	CFLAG:(ARG:1):상태이상 = ARG:2
	CFLAG:(ARG:1):상태이상경과턴수 = 0
	CALL ACTIONABLE_CHARA,ARG:1
	SIF RESULT == 0
		CFLAG:(ARG:1):입력행동 = -1
	PRINTFORM %GET_STATE(ARG:2)%
	SIF GET_STATE(ARG:2) == "DYING"
		CALL DEAD_CHARA,ARG:1
	;---- EDIT 028 MOD START -------------------------
	SIF GET_STATE(ARG:2) == "FLY"
		CALL SYNC_STATUS,ARG:1
	;---- EDIT 028 MOD END ---------------------------
	;---- EDIT 052 MOD START -------------------------
	IF GET_STATE(CFLAG:(ARG:1):상태이상) == "DYING"
		CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 9999, 1
	ELSE
		;CALL BATTLE_EVENT_ATTACK, ARG , ARG:1, 0, 4
	ENDIF
	;---- EDIT 052 MOD END ---------------------------
	RETURN 1
ENDIF

;---- EDIT 052 MOD START -------------------------
;======================================================================
;バステ優先度
;======================================================================
@BADSTATE_PRIORITY,ARG
#FUNCTION
SELECTCASE ARG
CASE 0
	RETURNF 0
;幸福
CASE 1
	RETURNF 1
;感電
CASE 2
	RETURNF 2
;混乱
CASE 3
	RETURNF 3
;睡眠
CASE 4
	RETURNF 4
;凍結
CASE 5
	RETURNF 5
;金縛
CASE 6
	RETURNF 7
;沈黙
CASE 7
	RETURNF 8
;猛毒
CASE 8
	RETURNF 9
;爆弾
CASE 9
	RETURNF 10
;魅了
CASE 10
	RETURNF 19
;麻痺
CASE 11
	RETURNF 20
;呪い
CASE 12
	RETURNF 12
;蠅化
CASE 13
	RETURNF 90
;石化
CASE 14
	RETURNF 98
;死亡
CASE 15
	RETURNF 99
;ORGY
CASE 16
	RETURNF 96
;HEAT
CASE 17
	RETURNF 97
;炎上
CASE 18
	RETURNF 11
;転倒
CASE 19
	RETURNF 6
;낙인
CASE 20
	RETURNF 13
CASEELSE
	RETURNF 0
ENDSELECT
;---- EDIT 052 MOD END ---------------------------

;======================================================================
;전투不能処理
;======================================================================
@DEAD_CHARA,ARG
#DIM num
#LOCALSIZE 3
VARSET num,0
BASE:ARG:ＨＰ = 0
CFLAG:ARG:상태이상 = GET_STATE_NUM("DYING")
;---- EDIT 028 MOD START -------------------------
CALL SYNC_STATUS,ARG
;---- EDIT 028 MOD END ---------------------------
IF CFLAG:ARG:PT플래그 == 0
	PRINTL
	;仲魔に居る악마を倒すと混沌に傾く ストレージ内は考慮しないように변경
;	SIF CFLAG:(FINDCHARA(NO,NO:ARG)):PT플래그 > 0
	FOR LOCAL,0,CHARANUM
		IF NO:LOCAL == NO:ARG && (CFLAG:LOCAL:PT플래그 == 2 || (CFLAG:LOCAL:PT플래그 == 1 && CFLAG:LOCAL:소속ＣＯＭＰ != -1))
			CALL INCREASE_LC,-1
			BREAK
		ENDIF
	NEXT
	PRINTFORMW %조사처리(CALLNAME:ARG,"를")% 쓰러트렸다
	;악마解析度が5上昇
	IF FLAG:악마해석률상승불가플래그 == 0
		;解析可能な場合
		CALL INCREASE_ANALYZE,NO:ARG,5
	ENDIF
	SIF CFLAG:ARG:시체잔존 == 0
		CALL REMOVE_POSITION,CFLAG:ARG:포지션
	CFLAG:ARG:입력행동 = -1
ELSE
	IF ARG == MASTER
		CFLAG:ARG:입력행동 = -1
		PRINTL
		PRINTFORMW %조사처리(CALLNAME:ARG,"는")% 힘이 다했다
		SIF TFLAG:킬링리액트
			num = num + 1
	;---- EDIT KR_01 MOD START -------------------------------
	ELSEIF ABL:ARG:종족 == 0 || ABL:ARG:종족 == 39 || NO:ARG == 4509 || CFLAG:ARG:소속ＣＯＭＰ == -1 || NO:ARG == 8528 || NO:ARG == 8529 || NO:ARG == 8531 || NO:ARG == 8532 || NO:ARG == 8533 || NO:ARG == 8534 || NO:ARG == 8535 || NO:ARG == 8537 || NO:ARG == 8543 || NO:ARG == 8545 || NO:ARG == 8546 || NO:ARG == 8547 || NO:ARG == 8548 || NO:ARG == 8549 || NO:ARG == 8550 || NO:ARG == 8551
	;---- EDIT KR_01 MOD END ---------------------------------	
		CFLAG:ARG:입력행동 = -1
		PRINTL
		PRINTFORMW %조사처리(CALLNAME:ARG,"는")% 힘이 다했다
		SIF TFLAG:킬링리액트
			num = num + 1
	;---- EDIT KR_01 ADD START -------------------------------
	ELSEIF NO:ARG == 8525
		CFLAG:ARG:입력행동 = -1
		PRINTL
		PRINTL
		PRINTFORMW 인류의 마지막 희망 [사령관의 아바타]가 쓰러졌다……
		PRINTW …
		PRINTW …
		PRINTW …
		CALL ENDING_COMMANDERS_AVATAR_DEAD ;사령관의 아바타 사망 엔딩
	;---- EDIT KR_01 ADD END ---------------------------------
	ELSE
		IF FLAG:SHOP커맨드 != [[SHOP:콜로세움참가]] && CPOS(ARG) > 0 && CFLAG:ARG:소속ＣＯＭＰ != -1
			CALL REMOVE_POSITION,CFLAG:ARG:포지션
			CFLAG:ARG:입력행동 = -1
			PRINTL
			PRINTFORMW %조사처리(CALLNAME:ARG,"는")% 힘이 다해 ＣＯＭＰ로 돌아갔다
			SIF TFLAG:킬링리액트
				num = num + 1
		ELSE
			CFLAG:ARG:입력행동 = -1
			PRINTL
			PRINTFORMW %조사처리(CALLNAME:ARG,"는")% 힘이 다했다
			SIF TFLAG:킬링리액트
				num = num + 1
		ENDIF
	ENDIF
	;瀕死になった場合はCFLAG:던전내발정용욕정치が半分になり、発情상태が해제される
	IF FLAG:무후후전개 && CFLAG:ARG:던전내발정용욕정치
		CFLAG:ARG:던전내발정용욕정치 /= 2
		CFLAG:ARG:던전내발정 = 0
	ENDIF
	;---- EDIT 077 DEL START -------------------------
	;;---- EDIT 063 MOD ADD -------------------------
	;SIF AUTO_PU_SKILL_ラグナロク（ＡＮ）(ARG,"Hゲージリセット")
	;	CALL SKILLGAGE_H_SET,ARG,RESULT,0
	;;---- EDIT 063 MOD END -------------------------
	;---- EDIT 077 DEL END   -------------------------
ENDIF
IF num > 0
	FOR LOCAL:1, 7, 17
		SIF POS(LOCAL:1) == -1 || CFLAG:POS(LOCAL:1):상태이상 == GET_STATE_NUM("DYING")
			CONTINUE
		SIF NO:(POS(LOCAL:1)) == [[캐릭터:니알라]]
			CALL SPECIAL_ACTION_3571,LOCAL:1
	NEXT
ENDIF


;===============================
;善悪操作
;==============================
@INCREASE_LD,ARG
CFLAG:MASTER:선악치 += ARG
SIF CFLAG:MASTER:선악치 > 255
	CFLAG:MASTER:선악치 = 255
SIF CFLAG:MASTER:선악치 < 0
	CFLAG:MASTER:선악치 = 0
SELECTCASE FLAG:속성고정LD
	CASE 1
		CFLAG:MASTER:선악치 = 255
	CASE 2
		CFLAG:MASTER:선악치 = 127
	CASE 3
		CFLAG:MASTER:선악치 = 0
ENDSELECT

@CHANGE_CHARA_LD,ARG,ARG:1,ARG:2
;ARGのキャラが、ARG:1に、ARG:2だけ近づく
IF CFLAG:ARG:선악치 >= ARG:1
	CFLAG:ARG:선악치 -= ARG:2
	SIF CFLAG:ARG:선악치 < ARG:1
		CFLAG:ARG:선악치 = ARG:1
ELSE
	CFLAG:ARG:선악치 += ARG:2
	SIF CFLAG:ARG:선악치 > ARG:1
		CFLAG:ARG:선악치 = ARG:1
ENDIF
SIF CFLAG:ARG:선악치 > 255
	CFLAG:ARG:선악치 = 255
SIF CFLAG:ARG:선악치 < 0
	CFLAG:ARG:선악치 = 0
IF ARG == MASTER || ARG:1 == MASTER
	SELECTCASE FLAG:속성고정LD
		CASE 1
			CFLAG:MASTER:선악치 = 255
		CASE 2
			CFLAG:MASTER:선악치 = 127
		CASE 3
			CFLAG:MASTER:선악치 = 0
	ENDSELECT
ENDIF

;===========================
;秩混操作
;==============================
@INCREASE_LC,ARG
CFLAG:MASTER:질혼치 += ARG
SIF CFLAG:MASTER:질혼치 > 255
	CFLAG:MASTER:질혼치 = 255
SIF CFLAG:MASTER:질혼치 < 0
	CFLAG:MASTER:질혼치 = 0
SELECTCASE FLAG:속성고정LC
	CASE 1
		CFLAG:MASTER:질혼치 = 255
	CASE 2
		CFLAG:MASTER:질혼치 = 127
	CASE 3
		CFLAG:MASTER:질혼치 = 0
ENDSELECT

@CHANGE_CHARA_LC,ARG,ARG:1,ARG:2
;ARGのキャラが、ARG:1に、ARG:2だけ近づく
IF CFLAG:ARG:질혼치 >= ARG:1
	CFLAG:ARG:질혼치 -= ARG:2
	SIF CFLAG:ARG:질혼치 < ARG:1
		CFLAG:ARG:질혼치 = ARG:1
ELSE
	CFLAG:ARG:질혼치 += ARG:2
	SIF CFLAG:ARG:질혼치 > ARG:1
		CFLAG:ARG:질혼치 = ARG:1
ENDIF
SIF CFLAG:ARG:질혼치 > 255
	CFLAG:ARG:질혼치 = 255
SIF CFLAG:ARG:질혼치 < 0
	CFLAG:ARG:질혼치 = 0
IF ARG == MASTER || ARG:1 == MASTER
	SELECTCASE FLAG:속성고정LC
		CASE 1
			CFLAG:MASTER:질혼치 = 255
		CASE 2
			CFLAG:MASTER:질혼치 = 127
		CASE 3
			CFLAG:MASTER:질혼치 = 0
	ENDSELECT
ENDIF

@ADJUST_CHARA_ALI,ARG
;いわゆる초기설정
IF CFLAG:ARG:선악치 == 0
	IF ABL:ARG:속성LD == 1
		CFLAG:ARG:선악치 = 255
	ELSEIF ABL:ARG:속성LD == 2
		CFLAG:ARG:선악치 = 128
	ENDIF
ENDIF
IF CFLAG:ARG:질혼치 == 0
	IF ABL:ARG:속성LC == 1
		CFLAG:ARG:질혼치 = 255
	ELSEIF ABL:ARG:속성LC == 2
		CFLAG:ARG:질혼치 = 128
	ENDIF
ENDIF


;===============================
;MAG操作
;==============================
@CONTROL_MAG,ARG,ARG:1
IF BASE:ARG:ＭＡＧ + ARG:1 > MAXBASE:ARG:ＭＡＧ
	ARG:1 = MAXBASE:ARG:ＭＡＧ - BASE:ARG:ＭＡＧ
ELSEIF BASE:ARG:ＭＡＧ + ARG:1 < 0
	ARG:1 = -BASE:ARG:ＭＡＧ
ENDIF
BASE:ARG:ＭＡＧ += ARG:1
TCVAR:ARG:획득ＭＡＧ += ARG:1
;SIF BASE:ARG:ＭＡＧ > MAXBASE:ARG:ＭＡＧ
;	BASE:ARG:ＭＡＧ = MAXBASE:ARG:ＭＡＧ
;SIF BASE:ARG:ＭＡＧ < 0
;	BASE:ARG:ＭＡＧ = 0

;===============================
;MAG흡수
;==============================
@DRAIN_MAG,ARG,ARG:1,ARG:2
ARG:1 *= 2
IF TALENT:(ARG:2):영매체질 && TEQUIP:25 == 0
	ARG:1 *= 5
	SIF !TALENT:(ARG:2):비전투원
		ARG:1 /= 2
ENDIF

;相손のMAGが満タンの場合は経験値になる（割五鈷杵彫りの반지장비時のみ）
;1EXP = 10MAG、一回の最高値は次の레벨に필요な総経験地の20％
;『당신』の레벨の半分までしか上げられない
IF MAXBASE:(ARG:2):ＭＡＧ == BASE:(ARG:2):ＭＡＧ && (CFLAG:ARG:그외 == 1130 || CFLAG:ARG:그외2 == 1130 || CFLAG:ARG:그외3 == 1130)&&  BASE:(ARG:2):LV < BASE:ARG:LV / 2
	IF BASE:ARG:ＭＡＧ >= ARG:1
		BASE:(ARG:2):ＥＸＰ += LIMIT(ARG:1 / 10 , 0 , MAXBASE:(ARG:2):ＥＸＰ / 5)
		BASE:ARG:ＭＡＧ -= LIMIT(ARG:1 / 10 , 0 , MAXBASE:(ARG:2):ＥＸＰ / 5) * 10
	ELSEIF BASE:ARG:ＭＡＧ < ARG:1
		BASE:(ARG:2):ＥＸＰ += LIMIT(BASE:ARG:ＭＡＧ / 10 , 0 , MAXBASE:(ARG:2):ＥＸＰ / 5)
		BASE:ARG:ＭＡＧ = 0
	ENDIF
ENDIF

;MAGが溢れる事を防ぐ
SIF ARG:1 > (MAXBASE:(ARG:2):ＭＡＧ - BASE:(ARG:2):ＭＡＧ) && (TEQUIP:25 == 0 || FLAG:촉수신사각성 == 0)
	ARG:1 = (MAXBASE:(ARG:2):ＭＡＧ - BASE:(ARG:2):ＭＡＧ)
SIF BASE:ARG:ＭＡＧ < ARG:1
	ARG:1 = BASE:ARG:ＭＡＧ
IF TEQUIP:25 && FLAG:촉수신사각성
	CALL CONTROL_MAG,ARG,-ARG:1
	FLAG:촉수에너지 += ARG:1 * (10 + ABL:ARG:촉수중독 * 9) / 100
	SIF FLAG:촉수에너지 > MAXBASE:MASTER:ＭＡＧ
		FLAG:촉수에너지 = MAXBASE:MASTER:ＭＡＧ
	;PRINTFORML 촉수에너지 +{(ARG:1 * (10 + ABL:ARG:촉수중독 * 9) / 100)}
	;PRINTFORML %NAME:ARG%:ＭＡＧ -{ARG:1}
	RETURN ARG:1
ELSE
	CALL CONTROL_MAG,ARG,-ARG:1
	CALL CONTROL_MAG,ARG:2,ARG:1
	;PRINTFORML %NAME:(ARG:2)%:ＭＡＧ +{ARG:1}
	;PRINTFORML %NAME:ARG%:ＭＡＧ -{ARG:1}
	RETURN ARG:1
ENDIF


;====================================================
;DEVIL_COOP
;====================================================
@DEVIL_COOP,ARG
#LOCALSIZE 11
;COOPを行う필요があるかの판정
;LOCAL:5 = 受ける人数
LOCAL:5 = 0

IF CFLAG:ARG:PT플래그 == 0
	LOCAL:7 = 1
	LOCAL:8 = 7
ELSE
	LOCAL:7 = 7
	LOCAL:8 = 17
ENDIF


FOR LOCAL,LOCAL:7,LOCAL:8
	LOCALS = 포지션{LOCAL}
	SIF FLAG:LOCALS > -1 && GET_STATE(CFLAG:(FLAG:LOCALS):상태이상) != "DYING" && CFLAG:(FLAG:LOCALS):ＣＯＯＰ플래그
		LOCAL:5 += 1
NEXT

SIF LOCAL:5 == 0
	RETURN 0


;ARG = 発動させたキャラ
LOCAL:2 = 0
;LOCAL:2 = 참가人数
;LOCAL:3 = COOP위력
LOCAL:3 = 50
;LOCAL:4 = COOP공격힘
LOCAL:4 = 0
;LOCAL:5 = 공격側の平均ＬＶ　＊再利用
;LOCAL:6 = 데미지値
;참가人数を割り出す
IF CFLAG:ARG:PT플래그 == 0
	LOCAL:7 = 7
	LOCAL:8 = 17
ELSE
	LOCAL:7 = 1
	LOCAL:8 = 7
ENDIF
FOR LOCAL,LOCAL:7,LOCAL:8
	LOCALS = 포지션{LOCAL}
	IF FLAG:LOCALS > -1
		CALL COOPABLE_CHARA,FLAG:LOCALS
		SIF RESULT == 0
			CONTINUE
		IF FLAG:LOCALS == ARG && CFLAG:ARG:보스플래그 == 0
			LOCAL:2 += 1
			LOCAL:4 += MAX(MAXBASE:(FLAG:LOCALS):공격 , MAXBASE:(FLAG:LOCALS):마법위력)
			LOCAL:5 += MAXBASE:(FLAG:LOCALS):LV
			CFLAG:(FLAG:LOCALS):ＣＯＯＰ참가플래그 = 1
			CONTINUE
		ENDIF
		;LOCAL:9 = 個別のCOOP위력加算値
		;기본COOP加算 110%
		IF (ABL:(FLAG:LOCALS):속성LD == ABL:ARG:속성LD && ABL:(FLAG:LOCALS):속성LC == ABL:ARG:속성LC) || (EQUIP:MASTER:ＣＯ－ＯＰ강화C && GET_SUMMONER_MLV() > 2 && CAPITULATION_CHECK(FLAG:LOCALS, ARG)) || 특수우정확인(ARG,FLAG:LOCALS);052
			;페르소나EXPの加算
			CALL INCREASE_PERSONA_EXP, FLAG:LOCALS, 1, 30
			LOCAL:2 += 1
			LOCAL:9 = 110
			IF FLAG:LOCALS == ARG && CFLAG:ARG:보스플래그
				LOCAL:2 += 1
				LOCAL:9 += 40
			ENDIF
			LOCAL:4 += MAX(MAXBASE:(FLAG:LOCALS):공격 , MAXBASE:(FLAG:LOCALS):마법위력)
			LOCAL:5 += MAXBASE:(FLAG:LOCALS):LV
			CFLAG:(FLAG:LOCALS):ＣＯＯＰ참가플래그 = 1
		;기본COOP위력加算 60%
		ELSEIF ABL:(FLAG:LOCALS):속성LD == ABL:ARG:속성LD || ABL:(FLAG:LOCALS):속성LC == ABL:ARG:속성LC
			;페르소나EXPの加算
			CALL INCREASE_PERSONA_EXP, FLAG:LOCALS, 1, 30
			LOCAL:9 = 60
			SIF EQUIP:MASTER:ＣＯ－ＯＰ강화W && GET_SUMMONER_MLV() > 2
				LOCAL:9 += 50
			LOCAL:2 += 1
			LOCAL:4 += MAX(MAXBASE:(FLAG:LOCALS):공격 , MAXBASE:(FLAG:LOCALS):마법위력)
			LOCAL:5 += MAXBASE:(FLAG:LOCALS):LV
			CFLAG:(FLAG:LOCALS):ＣＯＯＰ참가플래그 = 1
		;기본COOP위력加算 60%
		ELSEIF EQUIP:MASTER:ＣＯ－ＯＰ강화C && GET_SUMMONER_MLV() > 2 && CAPITULATION_CHECK(FLAG:LOCALS, ARG);052
			;페르소나EXPの加算
			CALL INCREASE_PERSONA_EXP, FLAG:LOCALS, 1, 30
			LOCAL:9 = 60
			LOCAL:2 += 1
			LOCAL:4 += MAX(MAXBASE:(FLAG:LOCALS):공격 , MAXBASE:(FLAG:LOCALS):마법위력)
			LOCAL:5 += MAXBASE:(FLAG:LOCALS):LV
			CFLAG:(FLAG:LOCALS):ＣＯＯＰ참가플래그 = 1
		ELSE
			CONTINUE
		ENDIF
		;추격의심득持ちは위력が1.5倍
		SIF HAVE_SKILL(FLAG:LOCALS,[[스킬:추격의심득]])
			TIMES LOCAL:9, 1.50
		;ALI보정を抜いた相性と함락によって1%～150%の보정が発生する
		LOCAL:10 = GET_RELATION(FLAG:LOCALS, ARG , 0)
		IF 함락(FLAG:LOCALS, ARG) == 1
			LOCAL:10 += 10
		ELSE
			LOCAL:10 += 함락(FLAG:LOCALS, ARG) * 25
		ENDIF
		LOCAL:10 = LIMIT(LOCAL:10, 1, 200)
		LOCAL:10 = LOCAL:10 > 100 ? (LOCAL:10 - 100) / 2 + 100 # LOCAL:10
		LOCAL:9 = LOCAL:9 * LOCAL:10 / 100
		;합계COOP위력に個別COOP위력を加算
		LOCAL:3 += LOCAL:9
	ENDIF
NEXT
SIF LOCAL:2 < 2
	RETURN 0
;LOCAL:3 += (LOCAL:2 - 1) * 60
LOCAL:4 /= LOCAL:2
LOCAL:5 /= LOCAL:2
;DEVIL_COOP発動
;ＣＯＯＰを引き起こした페르소나구사자の페르소나経験値を人数分増加
;ただし、自分참가で1点入るのでここでは1引いとく
SIF CFLAG:ARG:PT플래그 > 0
	CALL INCREASE_PERSONA_EXP, ARG, LOCAL:2 - 1, 31
IF CFLAG:ARG:PT플래그 == 0
	SETCOLOR 0xff0033
ELSE
	SETCOLOR 0x33ffcc
ENDIF
IF FLAG:RPG구상 == 0
	;구상用にTARGET保存
	LOCAL:9 = TARGET
	TARGET = ARG
	;COOP発動時구상
	TFLAG:전투이벤트 = 1
	IF CFLAG:ARG:PT플래그 == 0
		CALL 구상호출 , "ENEMY_BATTLE_EVENT" , ARG , ARG
	ELSE
		CALL 구상호출 , "BATTLE_EVENT" , ARG , ARG
	ENDIF
	TARGET = LOCAL:9
ENDIF
;참가者の표시ㆍ新記述版
ALIGNMENT CENTER
PRINTFORML ┏━━━━━━━━━━━━━━━━━┓
PRINTFORML ┃   ＤＥＶＩＬ ＣＯ－ＯＰ 발동！   ┃
PRINTFORML ┗━━━━━━━━━━━━━━━━━┛
FOR LOCAL,0,2
	FOR LOCAL:10,LOCAL:7,(LOCAL:8 - LOCAL:7) / 2 + 1
		IF POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10) > -1 && (CFLAG:POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10):ＣＯＯＰ참가플래그 || POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10) == ARG)
			PRINTFORM ┏━━━━━━━━━━┓
		ELSE
			SETCOLOR 0x404040
			PRINTFORM ┏━━━━━━━━━━┓
			IF CFLAG:ARG:PT플래그 == 0
				SETCOLOR 0xff0033
			ELSE
				SETCOLOR 0x33ffcc
			ENDIF
		ENDIF
		SIF LOCAL:10 != (LOCAL:8 - LOCAL:7)/2
			PRINTFORM 　
	NEXT
	PRINTL
	FOR LOCAL:10,LOCAL:7,(LOCAL:8 - LOCAL:7) / 2 + 1
		IF POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10) > -1 && (CFLAG:POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10):ＣＯＯＰ참가플래그 || POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10) == ARG)
			PRINTFORM ┃%CALLNAME:POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10),20,LEFT%┃
		ELSE
			SETCOLOR 0x404040
			PRINTFORM ┃\@ POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10) > -1 ? %CALLNAME:POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10),20,LEFT% # %"ＥＭＰＴＹ",20,LEFT%\@┃
			IF CFLAG:ARG:PT플래그 == 0
				SETCOLOR 0xff0033
			ELSE
				SETCOLOR 0x33ffcc
			ENDIF
		ENDIF
		SIF LOCAL:10 != (LOCAL:8 - LOCAL:7)/2
			PRINTFORM 　
	NEXT
	PRINTL
	FOR LOCAL:10,LOCAL:7,(LOCAL:8 - LOCAL:7) / 2 + 1
		IF POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10) > -1 && (CFLAG:POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10):ＣＯＯＰ참가플래그 || POS(LOCAL*(LOCAL:8 - LOCAL:7) / 2+LOCAL:10) == ARG)
			PRINTFORM ┗━━━━━━━━━━┛
		ELSE
			SETCOLOR 0x404040
			PRINTFORM ┗━━━━━━━━━━┛
			IF CFLAG:ARG:PT플래그 == 0
				SETCOLOR 0xff0033
			ELSE
				SETCOLOR 0x33ffcc
			ENDIF
		ENDIF
		SIF LOCAL:10 != (LOCAL:8 - LOCAL:7)/2
			PRINTFORM 　
	NEXT
	PRINTL
NEXT
PRINTFORML ┏━━━━━━━━┓
PRINTFORML ┃ＰＯＷＥＲ:{LOCAL:3 * 100 / 600,3}％┃
PRINTFORML ┗━━━━━━━━┛
ALIGNMENT LEFT
;新記述版ここまで
FOR LOCAL,LOCAL:7,LOCAL:8
	LOCALS = 포지션{LOCAL}
	IF FLAG:LOCALS > -1
		SIF CFLAG:(FLAG:LOCALS):ＣＯＯＰ참가플래그 == 0
			CONTINUE
		SIF FLAG:LOCALS != MASTER
			TCVAR:(FLAG:LOCALS):획득충성도 += 20
			;BASE:(FLAG:LOCALS):충성도 += 20
		;---- EDIT 020 ADD START -------------------------
		IF FLAG:무후후전개 && EQUIP:MASTER:엑스링케이지
			;ＣＯＯＰ참가した仲間の던전내발정용욕정치が욕정と새드끼に応じて増加
			CFLAG:(FLAG:LOCALS):던전내발정용욕정치 += 25 * (ABL:(FLAG:LOCALS):욕망 + ABL:(FLAG:LOCALS):새드끼 ) + 250
		ENDIF
		;---- EDIT 020 ADD START -------------------------
		;ＣＯＯＰ참가した악마の解析度+20
		IF CFLAG:(FLAG:LOCALS):PT플래그 > 0
			IF FLAG:악마해석률상승불가플래그 == 0
				;解析可能な場合
				CALL INCREASE_ANALYZE,NO:(FLAG:LOCALS),20
			ENDIF
		ENDIF
		TFLAG:전투이벤트 = 0
		;참가者표시：旧記述版
;		PRINTFORML ┏━━━━━━━━━━━━━┓　┏━━━━━━━━━━━━━━━━━━━━┓
;		PRINTFORML ┃[{CFLAG:(FLAG:LOCALS):포지션,2}] %CALLNAME:(FLAG:LOCALS),21,LEFT%┃　┃        데빌ＣＯ－ＯＰ 발동！         ┃
;		PRINTFORML ┗━━━━━━━━━━━━━┛　┗━━━━━━━━━━━━━━━━━━━━┛
		IF FLAG:RPG구상 == 0 && FLAG:LOCALS != ARG
			TFLAG:전투이벤트 = 2
			LOCAL:9 = TARGET
			TARGET = FLAG:LOCALS
			IF CFLAG:ARG:PT플래그 == 0
				CALL 구상호출 , "ENEMY_BATTLE_EVENT" , FLAG:LOCALS , FLAG:LOCALS
			ELSE
				CALL 구상호출 , "BATTLE_EVENT" , FLAG:LOCALS , FLAG:LOCALS
			ENDIF
			TARGET = LOCAL:9
			TFLAG:전투이벤트 = 0
		ENDIF
	ENDIF
NEXT
RESETCOLOR
WAIT


IF CFLAG:ARG:PT플래그 == 0
	LOCAL:7 = 1
	LOCAL:8 = 7
ELSE
	LOCAL:7 = 7
	LOCAL:8 = 17
ENDIF

FOR LOCAL,LOCAL:7,LOCAL:8
	LOCALS = 포지션{LOCAL}
	IF FLAG:LOCALS > -1
		SIF CFLAG:(FLAG:LOCALS):ＣＯＯＰ플래그 == 0
			CONTINUE
		IF CFLAG:(FLAG:LOCALS):PT플래그 == 0
			IF FLAG:악마해석률상승불가플래그 == 0
				;解析可能な場合
				CALL INCREASE_ANALYZE,NO:(FLAG:LOCALS),LIMIT((LOCAL:3 * 10 / 6),20,100)
			ENDIF
		ENDIF
		PRINTFORM 　　TARGET:[{CPOS(FLAG:LOCALS),2}] %CALLNAME:(FLAG:LOCALS),20,LEFT%　>>>>>>　

;		LOCAL:6 = CFLAG:(FLAG:LOCALS):ＣＯＯＰ플래그 * LOCAL:3 * LOCAL:4 * (LOCAL:4/4+4) / ((MAXBASE:(FLAG:LOCALS):방어 + MAXBASE:(FLAG:LOCALS):마법효과) * 50) * 3 / 2 / 100
		LOCAL:6 = (50 + LOCAL:5*5/2)+CFLAG:(FLAG:LOCALS):ＣＯＯＰ플래그
		LOCAL:6 *= (100+LOCAL:5)*(LOCAL:4)*(10+LOCAL:4/12) * LOCAL:3
		LOCAL:6 /= ((MAXBASE:(FLAG:LOCALS):방어 + MAXBASE:(FLAG:LOCALS):마법효과)/2) * 100 * 100 * 300


		LOCAL:6 *= (32 + CFLAG:ARG:공격강화) + (32 + CFLAG:ARG:마법위력강화)
		LOCAL:6 /= 64
		LOCAL:6 *= (32 - CFLAG:(FLAG:LOCALS):방어강화) + (32 - CFLAG:(FLAG:LOCALS):마법효과강화)
		LOCAL:6 /= 64
		;乱数
		LOCAL:6 *= (9500+RAND:1000)
		LOCAL:6 /= 10000

		;방어中のキャラには데미지減少
		SIF CFLAG:(FLAG:LOCALS):방어플래그
			LOCAL:6 /= 2
		;後列のキャラへの데미지減少はない
		;受ける側が아군の場合難易度修正
		IF CFLAG:(FLAG:LOCALS):PT플래그 > 0
			SELECTCASE FLAG:4
				CASE 1
					TIMES LOCAL:6,0.75
				CASE 3
					TIMES LOCAL:6,1.5
			ENDSELECT
		ENDIF
		IF CFLAG:(FLAG:LOCALS):PT플래그 > 0
			SELECTCASE FLAG:전투난이도
				CASE 1
					TIMES LOCAL:6 , 0.75
				CASE 3,4
					TIMES LOCAL:6 , 1.5
				CASE 5
					TIMES LOCAL:6 , 2
				CASE 6
					TIMES LOCAL:6 , 3
			ENDSELECT
		ENDIF
		;眠っていたら데미지大
		SIF CFLAG:(FLAG:LOCALS):상태이상 == GET_STATE_NUM("SLEEP")
			TIMES LOCAL:6,1.5
		;特殊보정
		LOCAL:6 = LOCAL:6 * (CFLAG:(FLAG:LOCALS):COOP피데미지보정 +100) / 100
		;ハント스킬보정
		TRYCCALLFORM 헌트스킬_{CFLAG:ARG:입력행동}
			LOCAL:6 = LOCAL:6 * RESULT / 100
		CATCH
		ENDCATCH
		;特殊보정2
		;---- EDIT 034 MOD -------------------------
		SIF CFLAG:(FLAG:LOCALS):COOP피데미지제한 > 0 && CFLAG:(FLAG:LOCALS):COOP피데미지제한 > LOCAL:6
			LOCAL:6 = CFLAG:(FLAG:LOCALS):COOP피데미지제한
		
		;---- EDIT 064 MOD -------------------------
		PRINTFORM {LOCAL:6}데미지
		CALL VAR_HP,FLAG:LOCALS,-LOCAL:6,-1
		;---- EDIT 064 MOD -------------------------
		SIF FLAG:LOCALS > -1 && CFLAG:(FLAG:LOCALS):상태이상 == GET_STATE_NUM("SLEEP")
			CFLAG:(FLAG:LOCALS):상태이상 = 0
		;데미지を受け、死亡しており、ハント스킬を使われていた場合は피헌트フラグを立てておく
		IF FLAG:LOCALS > -1 && LOCAL:6 > 0 && CFLAG:(FLAG:LOCALS):상태이상 == GET_STATE_NUM("DYING")
			TRYCCALLFORM 헌트스킬_{CFLAG:ARG:입력행동}
				CFLAG:(FLAG:LOCALS):피헌트 = ARG + 1
			CATCH
			ENDCATCH
		ENDIF
		PRINTL
	ENDIF
NEXT
WAIT

;=======================================================
;追撃可能かの판정
;====================================================
@COOPABLE_CHARA,ARG
SELECTCASE GET_STATE(CFLAG:ARG:상태이상)
	CASE "DYING","STONE","PALYZE","BIND","FREEZE","SHOCK","SLEEP","PANIC","CHARM","HEAT","SLIP"
	;死んでると駄눈
	;石になってると駄눈
	;麻痺してると駄눈
	;金縛りだと駄눈
	;凍ってると駄눈
	;感電してると駄눈
	;眠ってるとダメ
	;魅了されてるとダメ
	;混乱してるとダメ
	;オーバー히트でダメ
	;転倒してると駄눈
		RETURN 0
ENDSELECT

RETURN 1

;---- EDIT 052 MOD START -------------------------
;=======================================================
;ＣＯ－ＯＰ강화Cの強度체크
;====================================================
@CAPITULATION_CHECK,ARG,ARG:1
#FUNCTION
SIF ARG < 0 || ARG >= CHARANUM
	RETURNF 0
SIF ARG:1 < 0 || ARG:1 >= CHARANUM
	RETURNF 0
IF 함락(ARG, ARG:1)
	IF RESULTS == "음란"
		IF TALENT:ARG:ＮＴＲ == 2 && CFLAG:ARG:함락캐릭터 == CFLAG:(ARG:1):캐릭터고유번호
			RETURNF RESULT
		ELSEIF TALENT:ARG:ＮＴＲ == 0 && ARG:1 == MASTER
			RETURNF RESULT
		ENDIF
	ELSE
		RETURNF RESULT
	ENDIF
ENDIF
IF 함락(ARG:1, ARG)
	IF RESULTS == "음란"
		IF TALENT:(ARG:1):ＮＴＲ == 2 && CFLAG:(ARG:1):함락캐릭터 == CFLAG:ARG:캐릭터고유번호
			RETURNF RESULT
		ELSEIF TALENT:(ARG:1):ＮＴＲ == 0 && ARG == MASTER
			RETURNF RESULT
		ENDIF
	ELSE
		RETURNF RESULT
	ENDIF
ENDIF
RETURNF 0
;---- EDIT 052 MOD END -------------------------

;=======================================================
;특수우정확인
;대상者 	ARG
;대상者2	ARG:1
;====================================================
@특수우정확인,ARG,ARG:1,ARG:2 = 0
#FUNCTION
SIF ARG < 1 || ARG >= CHARANUM
	RETURNF 0
SIF ARG:1 < 1 || ARG:1 >= CHARANUM
	RETURNF 0
SIF !(ABL:ARG:종족 == 0 || ABL:ARG:종족 == 36)
	RETURNF 0
SIF !(ABL:(ARG:1):종족 == 0 || ABL:(ARG:1):종족 == 36)
	RETURNF 0
;---- EDIT 045 ADD START -------------------------
SIF CDFLAG:ARG:캐릭터간특수우정:(CFLAG:(ARG:1):캐릭터고유번호) && ARG:2 != 2
	RETURNF 1
SIF CDFLAG:(ARG:1):캐릭터간특수우정:(CFLAG:ARG:캐릭터고유번호) && ARG:2 != 1
	RETURNF 1
FOR LOCAL,1750,1780
	SIF CFLAG:ARG:LOCAL == NO:(ARG:1) && ARG:2 != 2
		RETURNF 1
	SIF CFLAG:(ARG:1):LOCAL == NO:ARG && ARG:2 != 1
		RETURNF 1
NEXT
;---- EDIT 045 ADD END -------------------------
RETURNF 0
;=======================================================
;특수우정추가
;대상者 	ARG
;대상者2	ARG:1
;====================================================
@특수우정추가,ARG,ARG:1
SIF ARG < 1 || ARG >= CHARANUM
	RETURN
SIF ARG:1 < 1 || ARG:1 >= CHARANUM
	RETURN
SIF !(ABL:ARG:종족 == 0 || ABL:ARG:종족 == 36)
	RETURN
SIF !(ABL:(ARG:1):종족 == 0 || ABL:(ARG:1):종족 == 36)
	RETURN
;---- EDIT 045 ADD START -------------------------
SIF !특수우정확인(ARG,ARG:1,1)
	CDFLAG:ARG:캐릭터간특수우정:(CFLAG:(ARG:1):캐릭터고유번호) = 1
SIF !특수우정확인(ARG,ARG:1,2)
	CDFLAG:(ARG:1):캐릭터간특수우정:(CFLAG:ARG:캐릭터고유번호) = 1
;---- EDIT 045 ADD END -------------------------

