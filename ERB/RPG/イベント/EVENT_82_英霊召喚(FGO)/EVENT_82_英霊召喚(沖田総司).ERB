;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:EVENT_82_英霊召喚(沖田総司).ERB
;	Facility	:
;
;	Licence		:ライセンスフリー
;
;	Modification Data:
;
;	Edit	Date			Author		Reason
;	000		20XX/XX/XX		----		テンプレ
;	001		2022/07/12		沖田ファン	作成
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;이벤트플래그:82:5の50番台を使用しています

;====================
;召喚イベント条件
;====================
@FGO_SUMMON_CHECK_5
#DIM 生贄

;■召喚可否条件をここに記載することで読み込んでくれます■
;※召喚は이벤트플래그:82:1が必ず4以上から。
LOCAL = GETCHARA(4402)
IF 이벤트플래그:82:1 > 3
	IF GETCHARA([[キャラ:오키타소지]]) > 0
		RESULTS = 병약 여검객(오키타 소지)
		RESULTS:1 = 필요 촉매：LV50이상의 남자가 아닌 조마　가입완료
		RETURN 0
	ELSEIF GETCHARA(4402) > 0
		IF IS_MALE(LOCAL) == 0 && BASE:LOCAL:LV > 49 && ITEM:카슈ㆍ키요미츠 > 0
			RESULTS = 병약 여검객(오키타 소지)
			RESULTS:1 = 필요 촉매：LV50이상의 남자가 아닌 조마+카슈ㆍ키요미츠　오키타 소지 미가입
			RETURN 1
		ELSE
			RESULTS = 병약 여검객(오키타 소지)
			RESULTS:1 = 필요 촉매：LV50이상의 남자가 아닌 조마+카슈ㆍ키요미츠　조건 미달성
			RETURN 0
		ENDIF
	ELSE
		RESULTS = 병약 여검객(오키타 소지)
		RESULTS:1 = 필요 촉매：LV50이상의 남자가 아닌 조마+카슈ㆍ키요미츠　미소지
		RETURN 0
	ENDIF
ELSE
	;そもこれが出ることはないはずだけど、確認用に一応記載
	RESULTS = 최초 소환 이벤트 미소화
	RETURN 0
ENDIF

;※RETURN 1　で서번트리스트のBITがオンになるようにしているため、必ずRETURNを記入してください

;====================
;沖田召喚
;====================
@FGO_SUMMON_5
#DIM 対象
#DIM L_COUNT

;■イベント本文を記載■

	対象 = [[キャラ:오키타소지]]
	;バトルイベント識別のために이벤트플래그を特定値に設定
	이벤트플래그:82:5 = 50
	PRINTFORML  「자、소환술은 다음 스테이지로
	PRINTFORMW  　――우리들의 연구 성과를 보시죠」
	PRINTFORML  
	PRINT  「자、준비해라
	PRINTFORM \@ TALENT:MASTER:서머너 > 0 ? 서머너 # 전사 \@ %CALLNAME:MASTER%。
	PRINTFORMW  　이것이 새로운 소환기술、그 발전이다――――아앗」
	;キャラリストの下から順にキャラ検索
	;該当するキャラを発見した場合、それを削除する
	FOR L_COUNT,CHARANUM,-1,-1
		IF L_COUNT == GETCHARA(4402)
			SIF TALENT:L_COUNT:남자 == 1
				CONTINUE
			SIF BASE:L_COUNT:LV < 50
				CONTINUE
			CALL 캐릭터삭제, L_COUNT
			BREAK
		ENDIF
	NEXT
	ITEM:카슈ㆍ키요미츠 -= 1
	CALL 疑似的画面クリア
	TWAIT 500,1
	PRINTFORML  
	PRINTFORML  
	;■以下、召喚イベント本文をどうぞ■
	PRINTFORMW  ＞소환진이 무지개빛으로 빛나고 빛이 소용돌이치며、쏟아져 나오던 마력이 서서히 가라앉기 시작한다
	PRINTFORML  　빛이 잦아들자 그곳에는 벚꽃색 기모노를 입고、칼을 내린 소녀가 있었다。
	PRINTFORML  　색이 바랜 듯한 옅은 복숭아색 머리와 흰 피부를 가진 소녀는、가볍게 주위를 살필 뒤에야 나섰다。
	PRINTFORML 
	PRINTFORML  「――신센구미 1번대 대장　오키타 소지 등장！　당신이 나의 소환자입니까？」
	PRINTFORML 
	PRINTFORMW  ＞오키타 소지……。　그렇다면 아마도 세이버 클래스의 서번트 일것이다。
	PRINTFORML  　하지만……
	PRINTFORML 

	$INPUT_LOOP1
	PRINTFORML [0] 단다라 하오리는？
	PRINTFORML [1] 그래。
	INPUT
	SELECTCASE RESULT
		CASE 0
			PRINTFORML  말하는 순간、소녀의 표정은 흐물흐물 무너졌다。
			PRINTFORML  「으……그게 어디론가 가버려서……。　그 주변에 없나요」
			PRINTFORML  ＞그런 것이 섞여 있을 리가 없다。　그러자 소녀는 포기한 듯 고개를 저었다。
			PRINTFORML  「역시 그렇습니까……。　뭐 언젠가는 나올 수도 있겠지요」
		CASE 1
			PRINTFORML  
		CASEELSE
			GOTO INPUT_LOOP1
	ENDSELECT
	PRINTFORMW 　＞소녀는 이쪽을 확인하듯 눈을 가늘게 뜨더니
	PRINTFORML 「……일단 딱딱하지는 않은 것 같네요。　뭐 하시는 분인지는 모르겠지만……」
	PRINTFORML 「제 희망은 하나입니다。　저를 끝까지 싸우게 하는 것。　그것만 약속하신다면」
	PRINTFORMW 　＞계약자의 선악은 짜지지 않는다、라。
	PRINTFORML 　매우 말이 빠르다고 할까、이해심이 너무 좋을 정도이지만、그것으로 좋다고 한다면 불평은 없다。
	PRINTFORML 　원래、그 때문에 소환한 거니까。
	PRINTFORML 「……됐습니다。　여기 계약은 끝났습니다。　그럼 잘 부탁드립니다」
	PRINTFORMW 　＞자、당장 그녀는 무엇을 할 수 있을까？
	PRINTFORML 「제가 할 수 있는 일인가요？　베라고 하면 베는거죠。그뿐입니다」
	PRINTFORML 「뭐、적이라는 것을 알고 있다면、지시를 기다리지는 않겠습니다만」
	PRINTFORMW 　＞온화한 표정 그대로 험악한 말을 하고、소녀는 가볍게 기침을 했다。
	PRINTFORML 　아무래도、전승의 일환으로 그녀의 병약함은、세이버 오키타 쇼지에게도 계속되고 있는 것 같다。
	PRINTFORML 「……검에 대해선 의심의 여지가 없습니다。　의심스럽다면、시도해보시겠습니까？」
	PRINTFORML 
	PRINTFORMW  ＞이제、어떻게 할까……
	PRINTFORML  
	$INPUT_LOOP2
	PRINTFORML [0] 전투 테스트를 수행한다
	PRINTFORML [1] 역시 그만둔다
	INPUT
	SELECTCASE RESULT
		CASE 0
			PRINTFORML  
			PRINTFORML  「네、제 칼날의 날카로움을 시험해보고 싶으시면
			PRINTFORMW  　뵙기까지의 일입니다」
			PRINTFORML
			PRINTFORML 
			PRINTFORMW  ＞영령　오키타 소지는、입가에 묻은 붉은 것을 닦고 칼을 들었다。 
			PRINTFORML 

			FLAG:도주불가플래그 = 1
			FLAG:회화불능플래그 = 1
			FLAG:선제기습취소 = 1
			CALL SET_ENEMY,9,[[キャラ:오키타소지]],50,1,3
			CFLAG:(CHARANUM-1):행동횟수 = 1
			CFLAG:(CHARANUM-1):ＨＰ보정 = (MAXBASE:(CHARANUM-1):ＨＰ / 2)
			CFLAG:(CHARANUM-1):ＭＰ보정 += 99999
	
			BASE:(CHARANUM-1):힘 += 4
			BASE:(CHARANUM-1):속도 += 6
	
			ABL:(CHARANUM-1):스킬3 = 0
			ABL:(CHARANUM-1):스킬9 = 3909
			CSTR:(CHARANUM-1):전용기6 = 絶刀
	
			CSTR:(CHARANUM-1):사고패턴 = 病弱女剣士
	
			CALL SYNC_STATUS,(CHARANUM-1)
			CALL HEALTH_CHARA,(CHARANUM-1)
			CALL BATTLE_START

			PRINTFORML  
			PRINTFORML  「이 정도면……」
			PRINTFORML  
			PRINTFORMW  ＞칼을 지팡이 대신 들고 일어서려는 오키타를 막는다。
			PRINTFORML  　이건 어디까지나 테스트다。　그렇게까지 할 필요는 없다。
			PRINTFORML 
			PRINTFORML  「알겠습니다。　뛰어난 마스터에게 불려졌다고 생각하니、나도 든든합니다。
			PRINTFORML  　다시 한번 이름을 밝히겠습니다。세이버인 서번트、오키타 소지
			PRINTFORML  　이제부터、당신의 검이 되겠습니다」
			PRINTFORML 
			PRINTFORML  「그래서、마스터는 구체적으로 어떤 일을 하시나요？
			PRINTFORML  　악마 퇴치、암살、정도。　그런 일이라면 오키타씨가 도움이 될 거예요～。
			PRINTFORML  　…………에、식당？　아니、오키타씨 요리같은건 좀……。
			PRINTFORML  　창관경영？　창관이라고 하면 히지카타씨가 자주 다니던……？
			PRINTFORML  　잠깐、잠깐～그런 건 오키타씨는 도움이 될 것 같지 않고……。
			PRINTFORML  　저、듣고 있어요？　마스터？　마스터！？」

			PRINTFORML 
			PRINTFORML 
			PRINTFORMW  ＞ 영령 오키타 소지 가 중마가 되었다！
			PRINTFORML  
			CALL ADD_NEW_COMPANION, [[キャラ:오키타소지]], 1000
			;バトルイベント識別に使った이벤트플래그を片付け
			이벤트플래그:82:5 = 0
		CASE 1
			PRINTFORML  
			PRINTFORML  「그렇습니까？　뭐、제 칼날의 날카로움을 알고 싶다면、전쟁터에 내놓으시면 마음껏」
			PRINTFORML  　
			PRINTFORMW  ＞오키타는、입가에 묻은 붉은 물체를 닦고 칼에서 손을 뗐다。
			PRINTFORML 
			PRINTFORML  「그럼、다시 한번 이름을 밝히겠습니다。세이버인 서번트、오키타 소지。
			PRINTFORML  　이제부터、당신의 검이 되겠습니다」
			PRINTFORML 
			PRINTFORML  「그래서、마스터는 구체적으로 어떤 일을 하시나요？
			PRINTFORML  　악마 퇴치、암살、정도。　그런 일이라면 오키타씨가 도움이 될 거예요～。
			PRINTFORML  　…………에、식당？　아니、오키타씨 요리같은건 좀……。
			PRINTFORML  　창관경영？　창관이라고 하면 히지카타씨가 자주 다니던……？
			PRINTFORML  　잠깐、잠깐～그런 건 오키타씨는 도움이 될 것 같지 않고……。
			PRINTFORML  　저、듣고 있어요？　마스터？　마스터！？」

			PRINTFORML 
			PRINTFORML 
			PRINTFORMW  ＞ 영령 오키타 소지 가 중마가 되었다！
			PRINTFORML  
			PRINTFORML  
			CALL ADD_NEW_COMPANION, [[キャラ:오키타소지]], 1000
			;バトルイベント識別に使った이벤트플래그を片付け
			이벤트플래그:82:5 = 0
		CASEELSE
			GOTO INPUT_LOOP2
	ENDSELECT
	PRINTFORML  

	
;--------------------
;バトル設定
;--------------------
;戦闘開始時のイベント発生
;サンプル：初手ノウブルㆍファンタズムゲージMAX、気合フラグオン
@EVENT_BATTLE_START_EVENT82_5
#DIM SKILL_NUM
SKILL_NUM = PU_SKILLNUM_GET((CHARANUM-1),"ノウブルㆍファンタズム")

IF 이벤트플래그:82:5 == 50
	PRINTFORML  
	CUSTOMDRAWLINE =
	PRINTFORML  
	SETCOLOR COLOR("YELLOW")
	PRINTFORMW  ＞  역할을 다한 마법진에서 마그네타이트가 쏟아져、영령에게 공급되어 간다！
	RESETCOLOR
	PRINTFORML  
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃어？　뭐예요、이건……　　　　　　　　　　　　　　┃
	PRINTL ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	PRINTW
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃신기할 정도로 몸이 가볍다。　　　　　　　　　　　　　　　　　┃
	PRINTL ┃뭔지 모르겠지만、지금 당장 카타를 칠게요！　　　　　┃
	PRINTL ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	PRINTW
	;魔力放出状態に強制移行
	CALL SKILLGAGE_F_SET,(CHARANUM-1),SKILL_NUM,100
	SETCOLOR 0xff0033
	PRINTFORML ┏>CHARA━━━━━━━━━━┓　┏>ACT━━━━━━━━━━━━━━━━━━┓
	PRINTFORM ┃[{CPOS((CHARANUM-1)),2}] %CALLNAME:(CHARANUM-1),21,LEFT%┃　┃
	CALLFORM SKILL_NAME_ノウブルㆍファンタズム,(CHARANUM-1)
	PRINTFORML %RESULTS,40,LEFT%┃
	PRINTFORMW ┗━━━━━━━━━━━━━┛　┗━━━━━━━━━━━━━━━━━━━━┛
	RESETCOLOR
	CALL ACTION_ノウブルㆍファンタズム,(CHARANUM-1)
	CFLAG:(CHARANUM-1):기합플래그 = 1
	이벤트플래그:82:5 = 51
ENDIF

;---------------------------------------------------
@EVENT_BATTLE_TURNEND_EVENT82_5
;---------------------------------------------------
#DIM SKILL_NUM

SKILL_NUM = PU_SKILLNUM_GET((CHARANUM-1),"ノウブルㆍファンタズム")

IF 이벤트플래그:82:5 == 52 && 현HP비율(CHARANUM-1) < 50
	CUSTOMDRAWLINE =
	PRINTL 
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃――――쿨럭……！？　　　　　　　　　　　　　　　　　　┃
	PRINTL ┃쿨럭、쿨럭……　　　　　　　　　　　　　　　　　　　　┃
	PRINTL ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	PRINTW
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃후……。　아직입니다、아직 몸은 움직입니다。　움직이는 동안에……　　　┃
	PRINTL ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	PRINTL
	PRINTW ＞ 오키타는 손에 든 칼을 다시 잡았다。
	PRINTL 
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃제 비검의 반짝임을 보여드리겠습니다！　　　　　　　　　　　　┃
	PRINTL ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	PRINTW
	ABL:(CHARANUM-1):스킬3 = 3906
	CSTR:(CHARANUM-1):전용기3 = 無明三段突き
	CALL VAR_HP,(CHARANUM-1),MAX(MAXBASE:(CHARANUM-1):ＨＰ,1),3
	CALL HEALTH_CHARA,(CHARANUM-1)
	CALL SKILLGAGE_D_SET,(CHARANUM-1),SKILL_NUM,5
	이벤트플래그:82:5 = 53
ELSEIF 이벤트플래그:82:5 == 51 && 현HP비율(CHARANUM-1) < 80
	CUSTOMDRAWLINE =
	PRINTL 
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃쿨럭……！？　　　　　　　　　　　　　　　　　　　　　　┃
	PRINTL ┃……오래 끌면 역시 힘든、가。　　　　　　　　　　　　┃
	PRINTL ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	PRINTW
	CFLAG:(CHARANUM-1):행동횟수 = 2
	이벤트플래그:82:5 = 52
ELSE
ENDIF

;--------------------
;思考パターン設定
;--------------------
@SET_ACTION_病弱女剣士, ARG
#DIM SKILL_NUM,2

SKILL_NUM:0 = PU_SKILLNUM_GET((CHARANUM-1),"ノウブルㆍファンタズム")
SKILL_NUM:1 = PU_SKILLNUM_GET((CHARANUM-1),"無明三段突き")

SELECTCASE 이벤트플래그:82:5
	CASE 53
		IF CFLAG:(CHARANUM-1):행동한횟수 == 1
			CALL CHECK_ACTIONABLE_AND_SET, (CHARANUM-1), (SKILL_NUM:1)
		ELSE
			CALL CHECK_ACTIONABLE_AND_SET, (CHARANUM-1), 3907
		ENDIF
	CASEELSE
		SELECTCASE RAND:3
			CASE 0
				CALL CHECK_ACTIONABLE_AND_SET, (CHARANUM-1), 37
			CASE 1
				CALL CHECK_ACTIONABLE_AND_SET, (CHARANUM-1), 40
			CASE 2
				CALL CHECK_ACTIONABLE_AND_SET, (CHARANUM-1), 53
		ENDSELECT
ENDSELECT



